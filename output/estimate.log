----------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/koren/Documents/workspace/expat/output/estimate.log
  log type:  text
 opened on:   8 Nov 2018, 11:57:47

. 
. use temp/analysis_sample

. 
. local sample_baseline expat!=.&greenfield!=1

. local sample_manufacturing `sample_baseline' & manufacturing==1

. local sample_acquisitions `sample_baseline' & ever_foreign==1

. 
. local samples baseline manufacturing acquisitions

. 
. xtset id year
       panel variable:  id (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. foreach sample in `samples' {
  2.         foreach X of var lnL lnQ lnK lnQL lnKL exporter inv {
  3.                 xtreg `X' foreign new fnew fnew_expat fold_expat i.ind_year i
> .age_cat if `sample_`sample'', i(id ) fe vce(cluster id)
  4.                 local r2_w = `e(r2_w)'
  5.                 do regram output/regression/`sample' `X' `X' R2_within "`r2_w
> '"
  6.         }
  7. }

Fixed-effects (within) regression               Number of obs     =    203,468
Group variable: id                              Number of groups  =     18,592

R-sq:                                           Obs per group:
     within  = 0.1196                                         min =          1
     between = 0.0232                                         avg =       10.9
     overall = 0.0518                                         max =         25

                                                F(59,18591)       =      78.15
corr(u_i, Xb)  = -0.3024                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,592 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0130448   .0372276     0.35   0.726    -.0599247    .0860143
         new |  -.0707848   .0101798    -6.95   0.000    -.0907382   -.0508315
        fnew |   .0516482   .0390493     1.32   0.186     -.024892    .1281883
  fnew_expat |    .012912   .0557215     0.23   0.817    -.0963073    .1221313
  fold_expat |   .0146249    .072873     0.20   0.841    -.1282129    .1574627
             |
    ind_year |
          2  |  -.2055379   .0137892   -14.91   0.000     -.232566   -.1785098
          3  |  -.3816449   .0185591   -20.56   0.000    -.4180225   -.3452673
          4  |  -.5249154   .0209513   -25.05   0.000    -.5659819   -.4838488
          5  |  -.6225696   .0233035   -26.72   0.000    -.6682467   -.5768925
          6  |  -.7361014   .0251901   -29.22   0.000    -.7854763   -.6867264
          7  |  -.8068052   .0271935   -29.67   0.000    -.8601068   -.7535035
          8  |  -.8806668   .0288967   -30.48   0.000     -.937307   -.8240266
          9  |   -.966635   .0311987   -30.98   0.000    -1.027787   -.9054827
         10  |  -1.025411   .0331218   -30.96   0.000    -1.090333   -.9604892
         11  |  -1.093333   .0345269   -31.67   0.000    -1.161009   -1.025657
         12  |  -1.113466   .0355602   -31.31   0.000    -1.183168   -1.043765
         13  |  -1.126642   .0364287   -30.93   0.000    -1.198045   -1.055238
         14  |  -1.158717   .0374448   -30.94   0.000    -1.232112   -1.085322
         15  |  -1.172967   .0383097   -30.62   0.000    -1.248057   -1.097876
         16  |  -1.195488   .0390068   -30.65   0.000    -1.271944   -1.119031
         17  |  -1.221277   .0397547   -30.72   0.000      -1.2992   -1.143354
         18  |  -1.285861   .0403231   -31.89   0.000    -1.364898   -1.206824
         19  |  -1.318038   .0408757   -32.25   0.000    -1.398158   -1.237918
         20  |  -1.351742   .0411926   -32.82   0.000    -1.432483   -1.271001
         21  |  -1.396736   .0419035   -33.33   0.000     -1.47887   -1.314601
         22  |  -1.429832   .0425008   -33.64   0.000    -1.513137   -1.346526
         23  |  -1.447686   .0429558   -33.70   0.000    -1.531883   -1.363489
         24  |  -1.472973   .0436934   -33.71   0.000    -1.558616    -1.38733
         25  |  -1.480072   .0441374   -33.53   0.000    -1.566585   -1.393559
         26  |   .2814024   .0590808     4.76   0.000     .1655986    .3972062
         27  |    .119387   .0572388     2.09   0.037     .0071938    .2315803
         28  |  -.0012885   .0552879    -0.02   0.981    -.1096578    .1070808
         29  |  -.1139384   .0542659    -2.10   0.036    -.2203045   -.0075722
         30  |  -.2183897   .0533087    -4.10   0.000    -.3228797   -.1138998
         31  |  -.2894326   .0526541    -5.50   0.000    -.3926394   -.1862258
         32  |  -.3449784   .0511243    -6.75   0.000    -.4451867   -.2447702
         33  |  -.4326953   .0509708    -8.49   0.000    -.5326027   -.3327879
         34  |  -.4931253   .0507211    -9.72   0.000    -.5925432   -.3937074
         35  |  -.5563603   .0509955   -10.91   0.000    -.6563161   -.4564044
         36  |  -.6162142    .051296   -12.01   0.000    -.7167591   -.5156694
         37  |  -.6682347   .0511297   -13.07   0.000    -.7684536   -.5680158
         38  |  -.7163521   .0513368   -13.95   0.000    -.8169769   -.6157273
         39  |  -.7546832   .0515951   -14.63   0.000    -.8558142   -.6535521
         40  |   -.775449   .0519088   -14.94   0.000     -.877195   -.6737031
         41  |  -.7897938   .0522288   -15.12   0.000     -.892167   -.6874206
         42  |  -.8176259   .0527407   -15.50   0.000    -.9210025   -.7142493
         43  |  -.9274787   .0535122   -17.33   0.000    -1.032367   -.8225899
         44  |  -.9436088   .0542537   -17.39   0.000    -1.049951   -.8372666
         45  |  -.9383752   .0547322   -17.14   0.000    -1.045655    -.831095
         46  |  -.9527381   .0552819   -17.23   0.000    -1.061096   -.8443806
         47  |   -.966667   .0556899   -17.36   0.000    -1.075824   -.8575097
         48  |  -.9656185   .0561323   -17.20   0.000    -1.075643   -.8555942
         49  |  -.9735616   .0569708   -17.09   0.000     -1.08523   -.8618936
         50  |  -.9860247    .057124   -17.26   0.000    -1.097993   -.8740564
             |
     age_cat |
          2  |   .4189094   .0129822    32.27   0.000      .393463    .4443558
          3  |    .693647   .0154971    44.76   0.000     .6632713    .7240227
          4  |   1.056723   .0185571    56.94   0.000      1.02035    1.093097
          5  |   1.419383   .0230889    61.47   0.000     1.374127     1.46464
          6  |   1.747285   .0288808    60.50   0.000     1.690676    1.803894
             |
       _cons |   3.223971   .0299036   107.81   0.000     3.165357    3.282585
-------------+----------------------------------------------------------------
     sigma_u |   1.000036
     sigma_e |  .77355372
         rho |  .62564821   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1195921873404757

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    203,468
Group variable: id                              Number of groups  =     18,592

R-sq:                                           Obs per group:
     within  = 0.1196                                         min =          1
     between = 0.0232                                         avg =       10.9
     overall = 0.0518                                         max =         25

                                                F(59,18591)       =      78.15
corr(u_i, Xb)  = -0.3024                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,592 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0130448   .0372276     0.35   0.726    -.0599247    .0860143
         new |  -.0707848   .0101798    -6.95   0.000    -.0907382   -.0508315
        fnew |   .0516482   .0390493     1.32   0.186     -.024892    .1281883
  fnew_expat |    .012912   .0557215     0.23   0.817    -.0963073    .1221313
  fold_expat |   .0146249    .072873     0.20   0.841    -.1282129    .1574627
             |
    ind_year |
          2  |  -.2055379   .0137892   -14.91   0.000     -.232566   -.1785098
          3  |  -.3816449   .0185591   -20.56   0.000    -.4180225   -.3452673
          4  |  -.5249154   .0209513   -25.05   0.000    -.5659819   -.4838488
          5  |  -.6225696   .0233035   -26.72   0.000    -.6682467   -.5768925
          6  |  -.7361014   .0251901   -29.22   0.000    -.7854763   -.6867264
          7  |  -.8068052   .0271935   -29.67   0.000    -.8601068   -.7535035
          8  |  -.8806668   .0288967   -30.48   0.000     -.937307   -.8240266
          9  |   -.966635   .0311987   -30.98   0.000    -1.027787   -.9054827
         10  |  -1.025411   .0331218   -30.96   0.000    -1.090333   -.9604892
         11  |  -1.093333   .0345269   -31.67   0.000    -1.161009   -1.025657
         12  |  -1.113466   .0355602   -31.31   0.000    -1.183168   -1.043765
         13  |  -1.126642   .0364287   -30.93   0.000    -1.198045   -1.055238
         14  |  -1.158717   .0374448   -30.94   0.000    -1.232112   -1.085322
         15  |  -1.172967   .0383097   -30.62   0.000    -1.248057   -1.097876
         16  |  -1.195488   .0390068   -30.65   0.000    -1.271944   -1.119031
         17  |  -1.221277   .0397547   -30.72   0.000      -1.2992   -1.143354
         18  |  -1.285861   .0403231   -31.89   0.000    -1.364898   -1.206824
         19  |  -1.318038   .0408757   -32.25   0.000    -1.398158   -1.237918
         20  |  -1.351742   .0411926   -32.82   0.000    -1.432483   -1.271001
         21  |  -1.396736   .0419035   -33.33   0.000     -1.47887   -1.314601
         22  |  -1.429832   .0425008   -33.64   0.000    -1.513137   -1.346526
         23  |  -1.447686   .0429558   -33.70   0.000    -1.531883   -1.363489
         24  |  -1.472973   .0436934   -33.71   0.000    -1.558616    -1.38733
         25  |  -1.480072   .0441374   -33.53   0.000    -1.566585   -1.393559
         26  |   .2814024   .0590808     4.76   0.000     .1655986    .3972062
         27  |    .119387   .0572388     2.09   0.037     .0071938    .2315803
         28  |  -.0012885   .0552879    -0.02   0.981    -.1096578    .1070808
         29  |  -.1139384   .0542659    -2.10   0.036    -.2203045   -.0075722
         30  |  -.2183897   .0533087    -4.10   0.000    -.3228797   -.1138998
         31  |  -.2894326   .0526541    -5.50   0.000    -.3926394   -.1862258
         32  |  -.3449784   .0511243    -6.75   0.000    -.4451867   -.2447702
         33  |  -.4326953   .0509708    -8.49   0.000    -.5326027   -.3327879
         34  |  -.4931253   .0507211    -9.72   0.000    -.5925432   -.3937074
         35  |  -.5563603   .0509955   -10.91   0.000    -.6563161   -.4564044
         36  |  -.6162142    .051296   -12.01   0.000    -.7167591   -.5156694
         37  |  -.6682347   .0511297   -13.07   0.000    -.7684536   -.5680158
         38  |  -.7163521   .0513368   -13.95   0.000    -.8169769   -.6157273
         39  |  -.7546832   .0515951   -14.63   0.000    -.8558142   -.6535521
         40  |   -.775449   .0519088   -14.94   0.000     -.877195   -.6737031
         41  |  -.7897938   .0522288   -15.12   0.000     -.892167   -.6874206
         42  |  -.8176259   .0527407   -15.50   0.000    -.9210025   -.7142493
         43  |  -.9274787   .0535122   -17.33   0.000    -1.032367   -.8225899
         44  |  -.9436088   .0542537   -17.39   0.000    -1.049951   -.8372666
         45  |  -.9383752   .0547322   -17.14   0.000    -1.045655    -.831095
         46  |  -.9527381   .0552819   -17.23   0.000    -1.061096   -.8443806
         47  |   -.966667   .0556899   -17.36   0.000    -1.075824   -.8575097
         48  |  -.9656185   .0561323   -17.20   0.000    -1.075643   -.8555942
         49  |  -.9735616   .0569708   -17.09   0.000     -1.08523   -.8618936
         50  |  -.9860247    .057124   -17.26   0.000    -1.097993   -.8740564
             |
     age_cat |
          2  |   .4189094   .0129822    32.27   0.000      .393463    .4443558
          3  |    .693647   .0154971    44.76   0.000     .6632713    .7240227
          4  |   1.056723   .0185571    56.94   0.000      1.02035    1.093097
          5  |   1.419383   .0230889    61.47   0.000     1.374127     1.46464
          6  |   1.747285   .0288808    60.50   0.000     1.690676    1.803894
             |
       _cons |   3.223971   .0299036   107.81   0.000     3.165357    3.282585
-------------+----------------------------------------------------------------
     sigma_u |   1.000036
     sigma_e |  .77355372
         rho |  .62564821   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    203,468
Group variable: id                              Number of groups  =     18,592

R-sq:                                           Obs per group:
     within  = 0.2679                                         min =          1
     between = 0.1139                                         avg =       10.9
     overall = 0.1292                                         max =         25

                                                F(59,18591)       =     236.21
corr(u_i, Xb)  = -0.0236                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,592 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnQ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1237901   .0408912     3.03   0.002     .0436396    .2039407
         new |  -.0444346   .0110674    -4.01   0.000    -.0661276   -.0227415
        fnew |    .066843   .0431606     1.55   0.121    -.0177557    .1514417
  fnew_expat |   .1507426   .0611514     2.47   0.014     .0308802     .270605
  fold_expat |   .1575065    .077543     2.03   0.042     .0055151    .3094978
             |
    ind_year |
          2  |  -.0807804   .0171481    -4.71   0.000    -.1143923   -.0471685
          3  |  -.0635059   .0216964    -2.93   0.003    -.1060327   -.0209791
          4  |  -.0080879   .0241305    -0.34   0.737    -.0553858    .0392101
          5  |   .0522471   .0269014     1.94   0.052    -.0004821    .1049763
          6  |    .130882   .0286722     4.56   0.000      .074682    .1870821
          7  |   .1841501   .0309896     5.94   0.000     .1234077    .2448925
          8  |   .1814899   .0329727     5.50   0.000     .1168605    .2461193
          9  |   .2185931   .0355833     6.14   0.000     .1488466    .2883395
         10  |   .2739137   .0377426     7.26   0.000     .1999347    .3478927
         11  |   .2753291   .0395675     6.96   0.000     .1977732     .352885
         12  |   .2913144   .0406561     7.17   0.000     .2116248     .371004
         13  |    .323143    .041652     7.76   0.000     .2415012    .4047847
         14  |   .3341272   .0428314     7.80   0.000     .2501737    .4180807
         15  |   .3841837   .0441863     8.69   0.000     .2975745    .4707928
         16  |    .403131   .0448283     8.99   0.000     .3152634    .4909985
         17  |   .4380343   .0457431     9.58   0.000     .3483737    .5276949
         18  |   .3088424   .0465188     6.64   0.000     .2176613    .4000236
         19  |   .2980922   .0473801     6.29   0.000     .2052228    .3909616
         20  |   .3177076   .0476308     6.67   0.000     .2243468    .4110684
         21  |   .2921023   .0485186     6.02   0.000     .1970014    .3872032
         22  |    .306617   .0493312     6.22   0.000     .2099233    .4033107
         23  |   .3370739   .0502002     6.71   0.000     .2386769     .435471
         24  |   .3344099   .0507213     6.59   0.000     .2349915    .4338284
         25  |   .3336405   .0512321     6.51   0.000     .2332209    .4340601
         26  |    .115832   .0634813     1.82   0.068    -.0085972    .2402612
         27  |   .0609767   .0600972     1.01   0.310    -.0568192    .1787727
         28  |   .1179943   .0572176     2.06   0.039     .0058425     .230146
         29  |   .2258848   .0561149     4.03   0.000     .1158945     .335875
         30  |   .3042561   .0550417     5.53   0.000     .1963694    .4121428
         31  |   .3869925   .0545454     7.09   0.000     .2800784    .4939065
         32  |   .4886396   .0534901     9.14   0.000     .3837941    .5934852
         33  |   .4654676   .0535762     8.69   0.000     .3604534    .5704818
         34  |   .5502112   .0531535    10.35   0.000     .4460254     .654397
         35  |   .5747308   .0537677    10.69   0.000     .4693411    .6801205
         36  |   .5698635   .0538541    10.58   0.000     .4643046    .6754225
         37  |   .5802965    .053989    10.75   0.000     .4744731    .6861199
         38  |   .6120266   .0545265    11.22   0.000     .5051497    .7189035
         39  |   .6169829   .0551425    11.19   0.000     .5088985    .7250673
         40  |   .6962505   .0558649    12.46   0.000     .5867502    .8057509
         41  |   .7612919   .0558495    13.63   0.000     .6518218    .8707619
         42  |   .8017448   .0565781    14.17   0.000     .6908466     .912643
         43  |    .663987   .0574017    11.57   0.000     .5514743    .7764996
         44  |   .6793859   .0586139    11.59   0.000     .5644972    .7942746
         45  |   .7643336    .059282    12.89   0.000     .6481354    .8805318
         46  |   .7501559   .0600624    12.49   0.000      .632428    .8678837
         47  |   .7673606   .0606867    12.64   0.000      .648409    .8863121
         48  |   .8257109   .0612179    13.49   0.000     .7057182    .9457037
         49  |   .8099871   .0629409    12.87   0.000     .6866171    .9333571
         50  |   .8207229   .0631272    13.00   0.000     .6969878    .9444581
             |
     age_cat |
          2  |   1.041461   .0174578    59.66   0.000     1.007242     1.07568
          3  |   1.335178   .0195362    68.34   0.000     1.296886    1.373471
          4  |   1.680184   .0224609    74.80   0.000     1.636159    1.724209
          5  |   2.023989   .0271021    74.68   0.000     1.970867    2.077112
          6  |   2.338251   .0342585    68.25   0.000     2.271101    2.405401
             |
       _cons |   10.20924   .0342471   298.11   0.000     10.14212    10.27637
-------------+----------------------------------------------------------------
     sigma_u |  1.4421282
     sigma_e |  .89317851
         rho |  .72275678   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2679369246641079

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    203,468
Group variable: id                              Number of groups  =     18,592

R-sq:                                           Obs per group:
     within  = 0.2679                                         min =          1
     between = 0.1139                                         avg =       10.9
     overall = 0.1292                                         max =         25

                                                F(59,18591)       =     236.21
corr(u_i, Xb)  = -0.0236                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,592 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnQ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1237901   .0408912     3.03   0.002     .0436396    .2039407
         new |  -.0444346   .0110674    -4.01   0.000    -.0661276   -.0227415
        fnew |    .066843   .0431606     1.55   0.121    -.0177557    .1514417
  fnew_expat |   .1507426   .0611514     2.47   0.014     .0308802     .270605
  fold_expat |   .1575065    .077543     2.03   0.042     .0055151    .3094978
             |
    ind_year |
          2  |  -.0807804   .0171481    -4.71   0.000    -.1143923   -.0471685
          3  |  -.0635059   .0216964    -2.93   0.003    -.1060327   -.0209791
          4  |  -.0080879   .0241305    -0.34   0.737    -.0553858    .0392101
          5  |   .0522471   .0269014     1.94   0.052    -.0004821    .1049763
          6  |    .130882   .0286722     4.56   0.000      .074682    .1870821
          7  |   .1841501   .0309896     5.94   0.000     .1234077    .2448925
          8  |   .1814899   .0329727     5.50   0.000     .1168605    .2461193
          9  |   .2185931   .0355833     6.14   0.000     .1488466    .2883395
         10  |   .2739137   .0377426     7.26   0.000     .1999347    .3478927
         11  |   .2753291   .0395675     6.96   0.000     .1977732     .352885
         12  |   .2913144   .0406561     7.17   0.000     .2116248     .371004
         13  |    .323143    .041652     7.76   0.000     .2415012    .4047847
         14  |   .3341272   .0428314     7.80   0.000     .2501737    .4180807
         15  |   .3841837   .0441863     8.69   0.000     .2975745    .4707928
         16  |    .403131   .0448283     8.99   0.000     .3152634    .4909985
         17  |   .4380343   .0457431     9.58   0.000     .3483737    .5276949
         18  |   .3088424   .0465188     6.64   0.000     .2176613    .4000236
         19  |   .2980922   .0473801     6.29   0.000     .2052228    .3909616
         20  |   .3177076   .0476308     6.67   0.000     .2243468    .4110684
         21  |   .2921023   .0485186     6.02   0.000     .1970014    .3872032
         22  |    .306617   .0493312     6.22   0.000     .2099233    .4033107
         23  |   .3370739   .0502002     6.71   0.000     .2386769     .435471
         24  |   .3344099   .0507213     6.59   0.000     .2349915    .4338284
         25  |   .3336405   .0512321     6.51   0.000     .2332209    .4340601
         26  |    .115832   .0634813     1.82   0.068    -.0085972    .2402612
         27  |   .0609767   .0600972     1.01   0.310    -.0568192    .1787727
         28  |   .1179943   .0572176     2.06   0.039     .0058425     .230146
         29  |   .2258848   .0561149     4.03   0.000     .1158945     .335875
         30  |   .3042561   .0550417     5.53   0.000     .1963694    .4121428
         31  |   .3869925   .0545454     7.09   0.000     .2800784    .4939065
         32  |   .4886396   .0534901     9.14   0.000     .3837941    .5934852
         33  |   .4654676   .0535762     8.69   0.000     .3604534    .5704818
         34  |   .5502112   .0531535    10.35   0.000     .4460254     .654397
         35  |   .5747308   .0537677    10.69   0.000     .4693411    .6801205
         36  |   .5698635   .0538541    10.58   0.000     .4643046    .6754225
         37  |   .5802965    .053989    10.75   0.000     .4744731    .6861199
         38  |   .6120266   .0545265    11.22   0.000     .5051497    .7189035
         39  |   .6169829   .0551425    11.19   0.000     .5088985    .7250673
         40  |   .6962505   .0558649    12.46   0.000     .5867502    .8057509
         41  |   .7612919   .0558495    13.63   0.000     .6518218    .8707619
         42  |   .8017448   .0565781    14.17   0.000     .6908466     .912643
         43  |    .663987   .0574017    11.57   0.000     .5514743    .7764996
         44  |   .6793859   .0586139    11.59   0.000     .5644972    .7942746
         45  |   .7643336    .059282    12.89   0.000     .6481354    .8805318
         46  |   .7501559   .0600624    12.49   0.000      .632428    .8678837
         47  |   .7673606   .0606867    12.64   0.000      .648409    .8863121
         48  |   .8257109   .0612179    13.49   0.000     .7057182    .9457037
         49  |   .8099871   .0629409    12.87   0.000     .6866171    .9333571
         50  |   .8207229   .0631272    13.00   0.000     .6969878    .9444581
             |
     age_cat |
          2  |   1.041461   .0174578    59.66   0.000     1.007242     1.07568
          3  |   1.335178   .0195362    68.34   0.000     1.296886    1.373471
          4  |   1.680184   .0224609    74.80   0.000     1.636159    1.724209
          5  |   2.023989   .0271021    74.68   0.000     1.970867    2.077112
          6  |   2.338251   .0342585    68.25   0.000     2.271101    2.405401
             |
       _cons |   10.20924   .0342471   298.11   0.000     10.14212    10.27637
-------------+----------------------------------------------------------------
     sigma_u |  1.4421282
     sigma_e |  .89317851
         rho |  .72275678   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    178,973
Group variable: id                              Number of groups  =     16,570

R-sq:                                           Obs per group:
     within  = 0.2148                                         min =          1
     between = 0.1561                                         avg =       10.8
     overall = 0.1321                                         max =         25

                                                F(59,16569)       =     137.91
corr(u_i, Xb)  = 0.0502                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 16,570 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnK |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .077284   .0513047     1.51   0.132    -.0232786    .1778467
         new |  -.0533145   .0138138    -3.86   0.000     -.080391   -.0262379
        fnew |  -.0795114     .05306    -1.50   0.134    -.1835148     .024492
  fnew_expat |   .0825269   .0705106     1.17   0.242    -.0556814    .2207353
  fold_expat |   .0292993   .0925208     0.32   0.751    -.1520514    .2106501
             |
    ind_year |
          2  |  -.1664357   .0244237    -6.81   0.000    -.2143088   -.1185626
          3  |   .1383228   .0300371     4.61   0.000     .0794469    .1971987
          4  |   .1272198   .0336001     3.79   0.000       .06136    .1930796
          5  |   .1646534   .0368977     4.46   0.000       .09233    .2369768
          6  |   .2783106   .0394523     7.05   0.000     .2009799    .3556414
          7  |   .4297988   .0423397    10.15   0.000     .3468083    .5127892
          8  |   .4967473   .0448885    11.07   0.000     .4087611    .5847335
          9  |   .5628402   .0474175    11.87   0.000     .4698969    .6557836
         10  |   .6287444   .0495282    12.69   0.000     .5316639    .7258248
         11  |   .7129196   .0515474    13.83   0.000     .6118812    .8139581
         12  |   .7664116   .0529681    14.47   0.000     .6625885    .8702348
         13  |   .8325358     .05435    15.32   0.000      .726004    .9390677
         14  |   .8304266   .0554065    14.99   0.000     .7218239    .9390293
         15  |   .8027607   .0563724    14.24   0.000     .6922648    .9132566
         16  |   .8417412   .0570451    14.76   0.000     .7299267    .9535557
         17  |   .8568821   .0580824    14.75   0.000     .7430343    .9707298
         18  |   .8055248   .0589639    13.66   0.000     .6899492    .9211003
         19  |   .7219834     .05985    12.06   0.000     .6046711    .8392958
         20  |   .6934123   .0605442    11.45   0.000     .5747392    .8120853
         21  |     .67594   .0614366    11.00   0.000     .5555178    .7963622
         22  |    .691181   .0621839    11.12   0.000     .5692939    .8130682
         23  |   .7789508   .0633138    12.30   0.000     .6548491    .9030526
         24  |   .4814197   .0686926     7.01   0.000     .3467749    .6160645
         25  |   .5271038   .0746238     7.06   0.000     .3808331    .6733745
         26  |   .6723108   .0811364     8.29   0.000     .5132748    .8313468
         27  |   .5515073   .0768925     7.17   0.000     .4007897    .7022249
         28  |   .6452623   .0714652     9.03   0.000     .5051829    .7853416
         29  |   .5895533   .0695654     8.47   0.000     .4531978    .7259089
         30  |   .5931667   .0688993     8.61   0.000     .4581167    .7282167
         31  |   .6767108   .0677922     9.98   0.000     .5438309    .8095907
         32  |   .8071887    .065812    12.27   0.000     .6781901    .9361873
         33  |   .8351847   .0660936    12.64   0.000     .7056341    .9647353
         34  |   .8802993   .0660392    13.33   0.000     .7508554    1.009743
         35  |    .937851   .0663633    14.13   0.000     .8077717     1.06793
         36  |   1.004442   .0670945    14.97   0.000     .8729299    1.135955
         37  |    1.05684   .0680988    15.52   0.000     .9233593    1.190321
         38  |   1.094411   .0681806    16.05   0.000     .9607699    1.228052
         39  |   1.083185   .0687213    15.76   0.000     .9484838    1.217886
         40  |    1.06128   .0699075    15.18   0.000     .9242535    1.198306
         41  |   1.107113   .0707488    15.65   0.000     .9684374    1.245788
         42  |   1.160806   .0711447    16.32   0.000     1.021354    1.300257
         43  |   1.083582   .0727271    14.90   0.000     .9410294    1.226135
         44  |   1.063932   .0735208    14.47   0.000     .9198236    1.208041
         45  |   1.094243   .0739215    14.80   0.000     .9493494    1.239137
         46  |   1.079034   .0748075    14.42   0.000     .9324029    1.225664
         47  |   1.103485   .0757291    14.57   0.000     .9550481    1.251922
         48  |   1.162853   .0765997    15.18   0.000     1.012709    1.312996
         49  |   1.156204   .0824934    14.02   0.000     .9945085      1.3179
         50  |   1.270235   .0872093    14.57   0.000     1.099296    1.441175
             |
     age_cat |
          2  |    .525871   .0237937    22.10   0.000     .4792329    .5725092
          3  |   .8448631   .0268308    31.49   0.000     .7922719    .8974544
          4  |   1.252595     .03016    41.53   0.000     1.193478    1.311712
          5  |   1.616875   .0358714    45.07   0.000     1.546563    1.687187
          6  |   1.940556   .0436243    44.48   0.000     1.855048    2.026065
             |
       _cons |   7.574079    .045562   166.24   0.000     7.484773    7.663386
-------------+----------------------------------------------------------------
     sigma_u |  1.7532434
     sigma_e |   1.072743
         rho |  .72760341   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2147759343143382

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    178,973
Group variable: id                              Number of groups  =     16,570

R-sq:                                           Obs per group:
     within  = 0.2148                                         min =          1
     between = 0.1561                                         avg =       10.8
     overall = 0.1321                                         max =         25

                                                F(59,16569)       =     137.91
corr(u_i, Xb)  = 0.0502                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 16,570 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnK |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .077284   .0513047     1.51   0.132    -.0232786    .1778467
         new |  -.0533145   .0138138    -3.86   0.000     -.080391   -.0262379
        fnew |  -.0795114     .05306    -1.50   0.134    -.1835148     .024492
  fnew_expat |   .0825269   .0705106     1.17   0.242    -.0556814    .2207353
  fold_expat |   .0292993   .0925208     0.32   0.751    -.1520514    .2106501
             |
    ind_year |
          2  |  -.1664357   .0244237    -6.81   0.000    -.2143088   -.1185626
          3  |   .1383228   .0300371     4.61   0.000     .0794469    .1971987
          4  |   .1272198   .0336001     3.79   0.000       .06136    .1930796
          5  |   .1646534   .0368977     4.46   0.000       .09233    .2369768
          6  |   .2783106   .0394523     7.05   0.000     .2009799    .3556414
          7  |   .4297988   .0423397    10.15   0.000     .3468083    .5127892
          8  |   .4967473   .0448885    11.07   0.000     .4087611    .5847335
          9  |   .5628402   .0474175    11.87   0.000     .4698969    .6557836
         10  |   .6287444   .0495282    12.69   0.000     .5316639    .7258248
         11  |   .7129196   .0515474    13.83   0.000     .6118812    .8139581
         12  |   .7664116   .0529681    14.47   0.000     .6625885    .8702348
         13  |   .8325358     .05435    15.32   0.000      .726004    .9390677
         14  |   .8304266   .0554065    14.99   0.000     .7218239    .9390293
         15  |   .8027607   .0563724    14.24   0.000     .6922648    .9132566
         16  |   .8417412   .0570451    14.76   0.000     .7299267    .9535557
         17  |   .8568821   .0580824    14.75   0.000     .7430343    .9707298
         18  |   .8055248   .0589639    13.66   0.000     .6899492    .9211003
         19  |   .7219834     .05985    12.06   0.000     .6046711    .8392958
         20  |   .6934123   .0605442    11.45   0.000     .5747392    .8120853
         21  |     .67594   .0614366    11.00   0.000     .5555178    .7963622
         22  |    .691181   .0621839    11.12   0.000     .5692939    .8130682
         23  |   .7789508   .0633138    12.30   0.000     .6548491    .9030526
         24  |   .4814197   .0686926     7.01   0.000     .3467749    .6160645
         25  |   .5271038   .0746238     7.06   0.000     .3808331    .6733745
         26  |   .6723108   .0811364     8.29   0.000     .5132748    .8313468
         27  |   .5515073   .0768925     7.17   0.000     .4007897    .7022249
         28  |   .6452623   .0714652     9.03   0.000     .5051829    .7853416
         29  |   .5895533   .0695654     8.47   0.000     .4531978    .7259089
         30  |   .5931667   .0688993     8.61   0.000     .4581167    .7282167
         31  |   .6767108   .0677922     9.98   0.000     .5438309    .8095907
         32  |   .8071887    .065812    12.27   0.000     .6781901    .9361873
         33  |   .8351847   .0660936    12.64   0.000     .7056341    .9647353
         34  |   .8802993   .0660392    13.33   0.000     .7508554    1.009743
         35  |    .937851   .0663633    14.13   0.000     .8077717     1.06793
         36  |   1.004442   .0670945    14.97   0.000     .8729299    1.135955
         37  |    1.05684   .0680988    15.52   0.000     .9233593    1.190321
         38  |   1.094411   .0681806    16.05   0.000     .9607699    1.228052
         39  |   1.083185   .0687213    15.76   0.000     .9484838    1.217886
         40  |    1.06128   .0699075    15.18   0.000     .9242535    1.198306
         41  |   1.107113   .0707488    15.65   0.000     .9684374    1.245788
         42  |   1.160806   .0711447    16.32   0.000     1.021354    1.300257
         43  |   1.083582   .0727271    14.90   0.000     .9410294    1.226135
         44  |   1.063932   .0735208    14.47   0.000     .9198236    1.208041
         45  |   1.094243   .0739215    14.80   0.000     .9493494    1.239137
         46  |   1.079034   .0748075    14.42   0.000     .9324029    1.225664
         47  |   1.103485   .0757291    14.57   0.000     .9550481    1.251922
         48  |   1.162853   .0765997    15.18   0.000     1.012709    1.312996
         49  |   1.156204   .0824934    14.02   0.000     .9945085      1.3179
         50  |   1.270235   .0872093    14.57   0.000     1.099296    1.441175
             |
     age_cat |
          2  |    .525871   .0237937    22.10   0.000     .4792329    .5725092
          3  |   .8448631   .0268308    31.49   0.000     .7922719    .8974544
          4  |   1.252595     .03016    41.53   0.000     1.193478    1.311712
          5  |   1.616875   .0358714    45.07   0.000     1.546563    1.687187
          6  |   1.940556   .0436243    44.48   0.000     1.855048    2.026065
             |
       _cons |   7.574079    .045562   166.24   0.000     7.484773    7.663386
-------------+----------------------------------------------------------------
     sigma_u |  1.7532434
     sigma_e |   1.072743
         rho |  .72760341   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    203,468
Group variable: id                              Number of groups  =     18,592

R-sq:                                           Obs per group:
     within  = 0.3380                                         min =          1
     between = 0.2406                                         avg =       10.9
     overall = 0.2077                                         max =         25

                                                F(59,18591)       =     330.37
corr(u_i, Xb)  = 0.0714                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,592 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1107453   .0258558     4.28   0.000     .0600656     .161425
         new |   .0263503   .0072467     3.64   0.000      .012146    .0405545
        fnew |   .0151948   .0264296     0.57   0.565    -.0366096    .0669993
  fnew_expat |   .1378306   .0418619     3.29   0.001     .0557775    .2198837
  fold_expat |   .1428816   .0517711     2.76   0.006     .0414054    .2443577
             |
    ind_year |
          2  |   .1247575    .012892     9.68   0.000      .099488     .150027
          3  |    .318139    .015119    21.04   0.000     .2885044    .3477736
          4  |   .5168275    .016314    31.68   0.000     .4848506    .5488044
          5  |   .6748167   .0178522    37.80   0.000     .6398247    .7098086
          6  |   .8669834   .0183755    47.18   0.000     .8309657    .9030011
          7  |   .9909553   .0192554    51.46   0.000      .953213    1.028698
          8  |   1.062157   .0200656    52.93   0.000     1.022826    1.101487
          9  |   1.185228   .0212505    55.77   0.000     1.143575    1.226881
         10  |   1.299325   .0223006    58.26   0.000     1.255614    1.343036
         11  |   1.368662   .0231516    59.12   0.000     1.323283    1.414042
         12  |   1.404781   .0237703    59.10   0.000     1.358189    1.451373
         13  |   1.449785   .0243904    59.44   0.000     1.401977    1.497592
         14  |   1.492844   .0249425    59.85   0.000     1.443954    1.541734
         15  |    1.55715   .0257567    60.46   0.000     1.506665    1.607636
         16  |   1.598619    .026135    61.17   0.000     1.547392    1.649846
         17  |   1.659311   .0267936    61.93   0.000     1.606793    1.711829
         18  |   1.594703   .0271473    58.74   0.000     1.541492    1.647914
         19  |   1.616131   .0279137    57.90   0.000     1.561417    1.670844
         20  |    1.66945   .0283828    58.82   0.000     1.613817    1.725082
         21  |   1.688838   .0292444    57.75   0.000     1.631516     1.74616
         22  |   1.736449   .0295276    58.81   0.000     1.678572    1.794326
         23  |    1.78476   .0299689    59.55   0.000     1.726018    1.843502
         24  |   1.807383   .0300408    60.16   0.000       1.7485    1.866265
         25  |   1.813713   .0302062    60.04   0.000     1.754506    1.872919
         26  |  -.1655704   .0360262    -4.60   0.000     -.236185   -.0949558
         27  |  -.0584103    .035394    -1.65   0.099    -.1277858    .0109653
         28  |   .1192828   .0341594     3.49   0.000     .0523273    .1862383
         29  |   .3398231   .0331347    10.26   0.000     .2748762    .4047701
         30  |   .5226458   .0328354    15.92   0.000     .4582854    .5870062
         31  |   .6764251   .0329127    20.55   0.000     .6119131     .740937
         32  |   .8336181    .032608    25.56   0.000     .7697034    .8975327
         33  |   .8981629   .0325936    27.56   0.000     .8342764    .9620494
         34  |   1.043336   .0326038    32.00   0.000     .9794301    1.107243
         35  |   1.131091   .0326301    34.66   0.000     1.067133    1.195049
         36  |   1.186078   .0327476    36.22   0.000     1.121889    1.250266
         37  |   1.248531   .0330522    37.77   0.000     1.183746    1.313317
         38  |   1.328379   .0333155    39.87   0.000     1.263077     1.39368
         39  |   1.371666   .0336599    40.75   0.000      1.30569    1.437643
         40  |     1.4717   .0342409    42.98   0.000     1.404584    1.538815
         41  |   1.551086   .0337041    46.02   0.000     1.485023    1.617149
         42  |   1.619371   .0341409    47.43   0.000     1.552451     1.68629
         43  |   1.591466   .0344735    46.16   0.000     1.523894    1.659037
         44  |   1.622995   .0350918    46.25   0.000     1.554212    1.691778
         45  |   1.702709   .0352408    48.32   0.000     1.633634    1.771784
         46  |   1.702894   .0356247    47.80   0.000     1.633066    1.772722
         47  |   1.734028   .0357862    48.46   0.000     1.663883    1.804172
         48  |   1.791329   .0359533    49.82   0.000     1.720858    1.861801
         49  |   1.783549   .0372533    47.88   0.000     1.710529    1.856569
         50  |   1.806748   .0368518    49.03   0.000     1.734515    1.878981
             |
     age_cat |
          2  |   .6225517   .0144975    42.94   0.000     .5941353    .6509681
          3  |   .6415315   .0155915    41.15   0.000     .6109706    .6720923
          4  |   .6234606    .016783    37.15   0.000     .5905643    .6563568
          5  |    .604606   .0190127    31.80   0.000     .5673394    .6418725
          6  |   .5909657   .0224759    26.29   0.000     .5469108    .6350207
             |
       _cons |   6.985272   .0222115   314.49   0.000     6.941735    7.028808
-------------+----------------------------------------------------------------
     sigma_u |  1.2243739
     sigma_e |  .62203511
         rho |  .79484423   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .3380349415761759

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    203,468
Group variable: id                              Number of groups  =     18,592

R-sq:                                           Obs per group:
     within  = 0.3380                                         min =          1
     between = 0.2406                                         avg =       10.9
     overall = 0.2077                                         max =         25

                                                F(59,18591)       =     330.37
corr(u_i, Xb)  = 0.0714                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,592 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1107453   .0258558     4.28   0.000     .0600656     .161425
         new |   .0263503   .0072467     3.64   0.000      .012146    .0405545
        fnew |   .0151948   .0264296     0.57   0.565    -.0366096    .0669993
  fnew_expat |   .1378306   .0418619     3.29   0.001     .0557775    .2198837
  fold_expat |   .1428816   .0517711     2.76   0.006     .0414054    .2443577
             |
    ind_year |
          2  |   .1247575    .012892     9.68   0.000      .099488     .150027
          3  |    .318139    .015119    21.04   0.000     .2885044    .3477736
          4  |   .5168275    .016314    31.68   0.000     .4848506    .5488044
          5  |   .6748167   .0178522    37.80   0.000     .6398247    .7098086
          6  |   .8669834   .0183755    47.18   0.000     .8309657    .9030011
          7  |   .9909553   .0192554    51.46   0.000      .953213    1.028698
          8  |   1.062157   .0200656    52.93   0.000     1.022826    1.101487
          9  |   1.185228   .0212505    55.77   0.000     1.143575    1.226881
         10  |   1.299325   .0223006    58.26   0.000     1.255614    1.343036
         11  |   1.368662   .0231516    59.12   0.000     1.323283    1.414042
         12  |   1.404781   .0237703    59.10   0.000     1.358189    1.451373
         13  |   1.449785   .0243904    59.44   0.000     1.401977    1.497592
         14  |   1.492844   .0249425    59.85   0.000     1.443954    1.541734
         15  |    1.55715   .0257567    60.46   0.000     1.506665    1.607636
         16  |   1.598619    .026135    61.17   0.000     1.547392    1.649846
         17  |   1.659311   .0267936    61.93   0.000     1.606793    1.711829
         18  |   1.594703   .0271473    58.74   0.000     1.541492    1.647914
         19  |   1.616131   .0279137    57.90   0.000     1.561417    1.670844
         20  |    1.66945   .0283828    58.82   0.000     1.613817    1.725082
         21  |   1.688838   .0292444    57.75   0.000     1.631516     1.74616
         22  |   1.736449   .0295276    58.81   0.000     1.678572    1.794326
         23  |    1.78476   .0299689    59.55   0.000     1.726018    1.843502
         24  |   1.807383   .0300408    60.16   0.000       1.7485    1.866265
         25  |   1.813713   .0302062    60.04   0.000     1.754506    1.872919
         26  |  -.1655704   .0360262    -4.60   0.000     -.236185   -.0949558
         27  |  -.0584103    .035394    -1.65   0.099    -.1277858    .0109653
         28  |   .1192828   .0341594     3.49   0.000     .0523273    .1862383
         29  |   .3398231   .0331347    10.26   0.000     .2748762    .4047701
         30  |   .5226458   .0328354    15.92   0.000     .4582854    .5870062
         31  |   .6764251   .0329127    20.55   0.000     .6119131     .740937
         32  |   .8336181    .032608    25.56   0.000     .7697034    .8975327
         33  |   .8981629   .0325936    27.56   0.000     .8342764    .9620494
         34  |   1.043336   .0326038    32.00   0.000     .9794301    1.107243
         35  |   1.131091   .0326301    34.66   0.000     1.067133    1.195049
         36  |   1.186078   .0327476    36.22   0.000     1.121889    1.250266
         37  |   1.248531   .0330522    37.77   0.000     1.183746    1.313317
         38  |   1.328379   .0333155    39.87   0.000     1.263077     1.39368
         39  |   1.371666   .0336599    40.75   0.000      1.30569    1.437643
         40  |     1.4717   .0342409    42.98   0.000     1.404584    1.538815
         41  |   1.551086   .0337041    46.02   0.000     1.485023    1.617149
         42  |   1.619371   .0341409    47.43   0.000     1.552451     1.68629
         43  |   1.591466   .0344735    46.16   0.000     1.523894    1.659037
         44  |   1.622995   .0350918    46.25   0.000     1.554212    1.691778
         45  |   1.702709   .0352408    48.32   0.000     1.633634    1.771784
         46  |   1.702894   .0356247    47.80   0.000     1.633066    1.772722
         47  |   1.734028   .0357862    48.46   0.000     1.663883    1.804172
         48  |   1.791329   .0359533    49.82   0.000     1.720858    1.861801
         49  |   1.783549   .0372533    47.88   0.000     1.710529    1.856569
         50  |   1.806748   .0368518    49.03   0.000     1.734515    1.878981
             |
     age_cat |
          2  |   .6225517   .0144975    42.94   0.000     .5941353    .6509681
          3  |   .6415315   .0155915    41.15   0.000     .6109706    .6720923
          4  |   .6234606    .016783    37.15   0.000     .5905643    .6563568
          5  |    .604606   .0190127    31.80   0.000     .5673394    .6418725
          6  |   .5909657   .0224759    26.29   0.000     .5469108    .6350207
             |
       _cons |   6.985272   .0222115   314.49   0.000     6.941735    7.028808
-------------+----------------------------------------------------------------
     sigma_u |  1.2243739
     sigma_e |  .62203511
         rho |  .79484423   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    178,973
Group variable: id                              Number of groups  =     16,570

R-sq:                                           Obs per group:
     within  = 0.2248                                         min =          1
     between = 0.1165                                         avg =       10.8
     overall = 0.1449                                         max =         25

                                                F(59,16569)       =     157.82
corr(u_i, Xb)  = 0.0492                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 16,570 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0422728   .0416702     1.01   0.310    -.0394053    .1239508
         new |   .0285392   .0116758     2.44   0.015     .0056534    .0514251
        fnew |   -.131546   .0444918    -2.96   0.003    -.2187547   -.0443373
  fnew_expat |   .0841138   .0575443     1.46   0.144    -.0286791    .1969068
  fold_expat |   .0597229   .0745018     0.80   0.423    -.0863087    .2057545
             |
    ind_year |
          2  |   .0658488   .0204397     3.22   0.001     .0257847    .1059128
          3  |   .5542709   .0241834    22.92   0.000     .5068688     .601673
          4  |   .6881209   .0262901    26.17   0.000     .6365895    .7396523
          5  |   .8357864   .0282126    29.62   0.000     .7804867     .891086
          6  |   1.067372   .0297903    35.83   0.000     1.008979    1.125764
          7  |   1.295611   .0313461    41.33   0.000     1.234169    1.357053
          8  |    1.43185   .0332644    43.04   0.000     1.366648    1.497052
          9  |   1.568365   .0346251    45.30   0.000     1.500496    1.636234
         10  |   1.691871    .035812    47.24   0.000     1.621676    1.762067
         11  |   1.841849   .0367694    50.09   0.000     1.769778    1.913921
         12  |   1.916298   .0376981    50.83   0.000     1.842406    1.990191
         13  |   1.988521   .0386271    51.48   0.000     1.912808    2.064235
         14  |   2.015934    .039354    51.23   0.000     1.938796    2.093072
         15  |   1.991301   .0402784    49.44   0.000     1.912351    2.070251
         16  |   2.047963   .0408699    50.11   0.000     1.967853    2.128072
         17  |   2.088299   .0417974    49.96   0.000     2.006372    2.170227
         18  |   2.097949   .0426238    49.22   0.000     2.014401    2.181496
         19  |   2.051766   .0433067    47.38   0.000      1.96688    2.136651
         20  |   2.041034   .0440718    46.31   0.000     1.954648    2.127419
         21  |   2.063029    .044908    45.94   0.000     1.975004    2.151053
         22  |   2.107685   .0454953    46.33   0.000      2.01851    2.196861
         23  |   2.206438   .0466972    47.25   0.000     2.114907     2.29797
         24  |   1.737461   .0542997    32.00   0.000     1.631028    1.843894
         25  |   1.792635   .0610389    29.37   0.000     1.672992    1.912278
         26  |   .4019971   .0601927     6.68   0.000      .284013    .5199813
         27  |   .4704347   .0557973     8.43   0.000     .3610661    .5798033
         28  |    .698641   .0528017    13.23   0.000     .5951441    .8021379
         29  |   .7582121     .05136    14.76   0.000      .657541    .8588832
         30  |   .8738834   .0509574    17.15   0.000     .7740014    .9737655
         31  |   1.013494   .0507249    19.98   0.000     .9140679     1.11292
         32  |   1.211723   .0493816    24.54   0.000     1.114929    1.308516
         33  |   1.326086   .0500895    26.47   0.000     1.227905    1.424267
         34  |   1.429802   .0503717    28.39   0.000     1.331068    1.528536
         35  |   1.545289     .05083    30.40   0.000     1.445657    1.644921
         36  |   1.671295   .0513843    32.53   0.000     1.570576    1.772014
         37  |   1.780127   .0521485    34.14   0.000      1.67791    1.882343
         38  |   1.856958   .0519953    35.71   0.000     1.755041    1.958874
         39  |   1.881604   .0523946    35.91   0.000     1.778905    1.984303
         40  |   1.879473   .0532096    35.32   0.000     1.775177     1.98377
         41  |   1.933157   .0536577    36.03   0.000     1.827983    2.038332
         42  |    2.01088    .053612    37.51   0.000     1.905795    2.115966
         43  |   2.044558   .0546744    37.40   0.000      1.93739    2.151725
         44  |   2.040009   .0552751    36.91   0.000     1.931664    2.148354
         45  |   2.064287   .0555028    37.19   0.000     1.955495    2.173078
         46  |   2.065155   .0561385    36.79   0.000     1.955117    2.175193
         47  |    2.09821   .0567265    36.99   0.000      1.98702      2.2094
         48  |   2.146565   .0569831    37.67   0.000     2.034872    2.258258
         49  |   1.954078   .0620397    31.50   0.000     1.832474    2.075682
         50  |   2.019087    .066175    30.51   0.000     1.889377    2.148798
             |
     age_cat |
          2  |   .1363938   .0220301     6.19   0.000     .0932125    .1795751
          3  |   .2014169   .0243742     8.26   0.000     .1536409    .2491929
          4  |   .2674665   .0263104    10.17   0.000     .2158954    .3190376
          5  |   .2861702   .0304085     9.41   0.000     .2265664    .3457741
          6  |   .3111387   .0359122     8.66   0.000     .2407469    .3815305
             |
       _cons |   4.204354   .0348882   120.51   0.000      4.13597    4.272739
-------------+----------------------------------------------------------------
     sigma_u |  1.6571274
     sigma_e |  .93162559
         rho |  .75984316   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .22477977810908

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    178,973
Group variable: id                              Number of groups  =     16,570

R-sq:                                           Obs per group:
     within  = 0.2248                                         min =          1
     between = 0.1165                                         avg =       10.8
     overall = 0.1449                                         max =         25

                                                F(59,16569)       =     157.82
corr(u_i, Xb)  = 0.0492                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 16,570 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0422728   .0416702     1.01   0.310    -.0394053    .1239508
         new |   .0285392   .0116758     2.44   0.015     .0056534    .0514251
        fnew |   -.131546   .0444918    -2.96   0.003    -.2187547   -.0443373
  fnew_expat |   .0841138   .0575443     1.46   0.144    -.0286791    .1969068
  fold_expat |   .0597229   .0745018     0.80   0.423    -.0863087    .2057545
             |
    ind_year |
          2  |   .0658488   .0204397     3.22   0.001     .0257847    .1059128
          3  |   .5542709   .0241834    22.92   0.000     .5068688     .601673
          4  |   .6881209   .0262901    26.17   0.000     .6365895    .7396523
          5  |   .8357864   .0282126    29.62   0.000     .7804867     .891086
          6  |   1.067372   .0297903    35.83   0.000     1.008979    1.125764
          7  |   1.295611   .0313461    41.33   0.000     1.234169    1.357053
          8  |    1.43185   .0332644    43.04   0.000     1.366648    1.497052
          9  |   1.568365   .0346251    45.30   0.000     1.500496    1.636234
         10  |   1.691871    .035812    47.24   0.000     1.621676    1.762067
         11  |   1.841849   .0367694    50.09   0.000     1.769778    1.913921
         12  |   1.916298   .0376981    50.83   0.000     1.842406    1.990191
         13  |   1.988521   .0386271    51.48   0.000     1.912808    2.064235
         14  |   2.015934    .039354    51.23   0.000     1.938796    2.093072
         15  |   1.991301   .0402784    49.44   0.000     1.912351    2.070251
         16  |   2.047963   .0408699    50.11   0.000     1.967853    2.128072
         17  |   2.088299   .0417974    49.96   0.000     2.006372    2.170227
         18  |   2.097949   .0426238    49.22   0.000     2.014401    2.181496
         19  |   2.051766   .0433067    47.38   0.000      1.96688    2.136651
         20  |   2.041034   .0440718    46.31   0.000     1.954648    2.127419
         21  |   2.063029    .044908    45.94   0.000     1.975004    2.151053
         22  |   2.107685   .0454953    46.33   0.000      2.01851    2.196861
         23  |   2.206438   .0466972    47.25   0.000     2.114907     2.29797
         24  |   1.737461   .0542997    32.00   0.000     1.631028    1.843894
         25  |   1.792635   .0610389    29.37   0.000     1.672992    1.912278
         26  |   .4019971   .0601927     6.68   0.000      .284013    .5199813
         27  |   .4704347   .0557973     8.43   0.000     .3610661    .5798033
         28  |    .698641   .0528017    13.23   0.000     .5951441    .8021379
         29  |   .7582121     .05136    14.76   0.000      .657541    .8588832
         30  |   .8738834   .0509574    17.15   0.000     .7740014    .9737655
         31  |   1.013494   .0507249    19.98   0.000     .9140679     1.11292
         32  |   1.211723   .0493816    24.54   0.000     1.114929    1.308516
         33  |   1.326086   .0500895    26.47   0.000     1.227905    1.424267
         34  |   1.429802   .0503717    28.39   0.000     1.331068    1.528536
         35  |   1.545289     .05083    30.40   0.000     1.445657    1.644921
         36  |   1.671295   .0513843    32.53   0.000     1.570576    1.772014
         37  |   1.780127   .0521485    34.14   0.000      1.67791    1.882343
         38  |   1.856958   .0519953    35.71   0.000     1.755041    1.958874
         39  |   1.881604   .0523946    35.91   0.000     1.778905    1.984303
         40  |   1.879473   .0532096    35.32   0.000     1.775177     1.98377
         41  |   1.933157   .0536577    36.03   0.000     1.827983    2.038332
         42  |    2.01088    .053612    37.51   0.000     1.905795    2.115966
         43  |   2.044558   .0546744    37.40   0.000      1.93739    2.151725
         44  |   2.040009   .0552751    36.91   0.000     1.931664    2.148354
         45  |   2.064287   .0555028    37.19   0.000     1.955495    2.173078
         46  |   2.065155   .0561385    36.79   0.000     1.955117    2.175193
         47  |    2.09821   .0567265    36.99   0.000      1.98702      2.2094
         48  |   2.146565   .0569831    37.67   0.000     2.034872    2.258258
         49  |   1.954078   .0620397    31.50   0.000     1.832474    2.075682
         50  |   2.019087    .066175    30.51   0.000     1.889377    2.148798
             |
     age_cat |
          2  |   .1363938   .0220301     6.19   0.000     .0932125    .1795751
          3  |   .2014169   .0243742     8.26   0.000     .1536409    .2491929
          4  |   .2674665   .0263104    10.17   0.000     .2158954    .3190376
          5  |   .2861702   .0304085     9.41   0.000     .2265664    .3457741
          6  |   .3111387   .0359122     8.66   0.000     .2407469    .3815305
             |
       _cons |   4.204354   .0348882   120.51   0.000      4.13597    4.272739
-------------+----------------------------------------------------------------
     sigma_u |  1.6571274
     sigma_e |  .93162559
         rho |  .75984316   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    203,468
Group variable: id                              Number of groups  =     18,592

R-sq:                                           Obs per group:
     within  = 0.0433                                         min =          1
     between = 0.1406                                         avg =       10.9
     overall = 0.0902                                         max =         25

                                                F(59,18591)       =      46.58
corr(u_i, Xb)  = 0.1712                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,592 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0207925   .0109316     1.90   0.057    -.0006344    .0422195
         new |  -.0116882    .003153    -3.71   0.000    -.0178684   -.0055081
        fnew |    .006868   .0118264     0.58   0.561    -.0163128    .0300489
  fnew_expat |   .0572361   .0160949     3.56   0.000     .0256887    .0887835
  fold_expat |   .0358436   .0206319     1.74   0.082    -.0045969     .076284
             |
    ind_year |
          2  |  -.0228777   .0056263    -4.07   0.000    -.0339058   -.0118497
          3  |  -.0376553   .0067469    -5.58   0.000    -.0508798   -.0244308
          4  |  -.0500256    .007188    -6.96   0.000    -.0641147   -.0359365
          5  |   -.047901   .0075412    -6.35   0.000    -.0626825   -.0331195
          6  |  -.0549381   .0078339    -7.01   0.000    -.0702932    -.039583
          7  |  -.0543171   .0080745    -6.73   0.000    -.0701439   -.0384903
          8  |  -.0716976   .0082544    -8.69   0.000    -.0878771   -.0555182
          9  |  -.0719213   .0084283    -8.53   0.000    -.0884415   -.0554011
         10  |  -.0707642   .0087585    -8.08   0.000    -.0879317   -.0535967
         11  |  -.0759867   .0090119    -8.43   0.000    -.0936508   -.0583226
         12  |  -.0756828    .009232    -8.20   0.000    -.0937783   -.0575873
         13  |   -.071119   .0095048    -7.48   0.000    -.0897492   -.0524889
         14  |  -.0578393   .0098784    -5.86   0.000    -.0772018   -.0384769
         15  |  -.0473449   .0101383    -4.67   0.000    -.0672169   -.0274729
         16  |  -.0294007   .0103806    -2.83   0.005    -.0497476   -.0090538
         17  |  -.0137479   .0106338    -1.29   0.196    -.0345911    .0070954
         18  |  -.0020663     .01096    -0.19   0.850    -.0235489    .0194163
         19  |   .0017126   .0110112     0.16   0.876    -.0198703    .0232956
         20  |   .0142458   .0112752     1.26   0.206    -.0078547    .0363462
         21  |   .0107405   .0114893     0.93   0.350    -.0117797    .0332606
         22  |    .017337   .0115776     1.50   0.134    -.0053561    .0400301
         23  |   .0118543   .0117502     1.01   0.313    -.0111772    .0348858
         24  |  -.0804347   .0118016    -6.82   0.000    -.1035668   -.0573025
         25  |   -.108717   .0119948    -9.06   0.000    -.1322279    -.085206
         26  |    .043578   .0168385     2.59   0.010     .0105731     .076583
         27  |    .033102   .0157587     2.10   0.036     .0022135    .0639905
         28  |   .0329967    .015163     2.18   0.030     .0032759    .0627175
         29  |   .0358937   .0148071     2.42   0.015     .0068704     .064917
         30  |   .0509446   .0145713     3.50   0.000     .0223836    .0795055
         31  |   .0450772   .0142557     3.16   0.002     .0171347    .0730197
         32  |   .0518567   .0140781     3.68   0.000     .0242624     .079451
         33  |   .0413242   .0140701     2.94   0.003     .0137455    .0689029
         34  |   .0424761   .0140897     3.01   0.003      .014859    .0700932
         35  |   .0469307   .0140415     3.34   0.001     .0194081    .0744533
         36  |   .0470367   .0142465     3.30   0.001     .0191122    .0749612
         37  |   .0454551   .0142492     3.19   0.001     .0175253    .0733849
         38  |   .0458951   .0142284     3.23   0.001     .0180061     .073784
         39  |   .0525732     .01436     3.66   0.000     .0244263    .0807201
         40  |   .0655853    .014449     4.54   0.000     .0372639    .0939066
         41  |   .0848007   .0146427     5.79   0.000     .0560998    .1135017
         42  |   .0908907   .0148024     6.14   0.000     .0618766    .1199048
         43  |   .0943001    .015076     6.25   0.000     .0647498    .1238504
         44  |   .1119779   .0153482     7.30   0.000     .0818941    .1420618
         45  |     .12289   .0153043     8.03   0.000     .0928922    .1528877
         46  |   .1281011   .0155948     8.21   0.000     .0975337    .1586684
         47  |   .1442994   .0156647     9.21   0.000     .1135952    .1750036
         48  |   .1289341   .0158413     8.14   0.000     .0978837    .1599844
         49  |  -.1177734   .0163975    -7.18   0.000     -.149914   -.0856329
         50  |  -.1643744   .0165655    -9.92   0.000    -.1968442   -.1319046
             |
     age_cat |
          2  |   .0519597    .004216    12.32   0.000      .043696    .0602235
          3  |   .0711164   .0047254    15.05   0.000     .0618541    .0803787
          4  |    .104667   .0051803    20.20   0.000     .0945132    .1148209
          5  |   .1380392   .0064068    21.55   0.000     .1254813    .1505971
          6  |   .1653849   .0079515    20.80   0.000     .1497993    .1809705
             |
       _cons |   .1927151   .0080673    23.89   0.000     .1769025    .2085278
-------------+----------------------------------------------------------------
     sigma_u |  .34459704
     sigma_e |  .29657094
         rho |  .57448616   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0433305298416466

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    203,468
Group variable: id                              Number of groups  =     18,592

R-sq:                                           Obs per group:
     within  = 0.0433                                         min =          1
     between = 0.1406                                         avg =       10.9
     overall = 0.0902                                         max =         25

                                                F(59,18591)       =      46.58
corr(u_i, Xb)  = 0.1712                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,592 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0207925   .0109316     1.90   0.057    -.0006344    .0422195
         new |  -.0116882    .003153    -3.71   0.000    -.0178684   -.0055081
        fnew |    .006868   .0118264     0.58   0.561    -.0163128    .0300489
  fnew_expat |   .0572361   .0160949     3.56   0.000     .0256887    .0887835
  fold_expat |   .0358436   .0206319     1.74   0.082    -.0045969     .076284
             |
    ind_year |
          2  |  -.0228777   .0056263    -4.07   0.000    -.0339058   -.0118497
          3  |  -.0376553   .0067469    -5.58   0.000    -.0508798   -.0244308
          4  |  -.0500256    .007188    -6.96   0.000    -.0641147   -.0359365
          5  |   -.047901   .0075412    -6.35   0.000    -.0626825   -.0331195
          6  |  -.0549381   .0078339    -7.01   0.000    -.0702932    -.039583
          7  |  -.0543171   .0080745    -6.73   0.000    -.0701439   -.0384903
          8  |  -.0716976   .0082544    -8.69   0.000    -.0878771   -.0555182
          9  |  -.0719213   .0084283    -8.53   0.000    -.0884415   -.0554011
         10  |  -.0707642   .0087585    -8.08   0.000    -.0879317   -.0535967
         11  |  -.0759867   .0090119    -8.43   0.000    -.0936508   -.0583226
         12  |  -.0756828    .009232    -8.20   0.000    -.0937783   -.0575873
         13  |   -.071119   .0095048    -7.48   0.000    -.0897492   -.0524889
         14  |  -.0578393   .0098784    -5.86   0.000    -.0772018   -.0384769
         15  |  -.0473449   .0101383    -4.67   0.000    -.0672169   -.0274729
         16  |  -.0294007   .0103806    -2.83   0.005    -.0497476   -.0090538
         17  |  -.0137479   .0106338    -1.29   0.196    -.0345911    .0070954
         18  |  -.0020663     .01096    -0.19   0.850    -.0235489    .0194163
         19  |   .0017126   .0110112     0.16   0.876    -.0198703    .0232956
         20  |   .0142458   .0112752     1.26   0.206    -.0078547    .0363462
         21  |   .0107405   .0114893     0.93   0.350    -.0117797    .0332606
         22  |    .017337   .0115776     1.50   0.134    -.0053561    .0400301
         23  |   .0118543   .0117502     1.01   0.313    -.0111772    .0348858
         24  |  -.0804347   .0118016    -6.82   0.000    -.1035668   -.0573025
         25  |   -.108717   .0119948    -9.06   0.000    -.1322279    -.085206
         26  |    .043578   .0168385     2.59   0.010     .0105731     .076583
         27  |    .033102   .0157587     2.10   0.036     .0022135    .0639905
         28  |   .0329967    .015163     2.18   0.030     .0032759    .0627175
         29  |   .0358937   .0148071     2.42   0.015     .0068704     .064917
         30  |   .0509446   .0145713     3.50   0.000     .0223836    .0795055
         31  |   .0450772   .0142557     3.16   0.002     .0171347    .0730197
         32  |   .0518567   .0140781     3.68   0.000     .0242624     .079451
         33  |   .0413242   .0140701     2.94   0.003     .0137455    .0689029
         34  |   .0424761   .0140897     3.01   0.003      .014859    .0700932
         35  |   .0469307   .0140415     3.34   0.001     .0194081    .0744533
         36  |   .0470367   .0142465     3.30   0.001     .0191122    .0749612
         37  |   .0454551   .0142492     3.19   0.001     .0175253    .0733849
         38  |   .0458951   .0142284     3.23   0.001     .0180061     .073784
         39  |   .0525732     .01436     3.66   0.000     .0244263    .0807201
         40  |   .0655853    .014449     4.54   0.000     .0372639    .0939066
         41  |   .0848007   .0146427     5.79   0.000     .0560998    .1135017
         42  |   .0908907   .0148024     6.14   0.000     .0618766    .1199048
         43  |   .0943001    .015076     6.25   0.000     .0647498    .1238504
         44  |   .1119779   .0153482     7.30   0.000     .0818941    .1420618
         45  |     .12289   .0153043     8.03   0.000     .0928922    .1528877
         46  |   .1281011   .0155948     8.21   0.000     .0975337    .1586684
         47  |   .1442994   .0156647     9.21   0.000     .1135952    .1750036
         48  |   .1289341   .0158413     8.14   0.000     .0978837    .1599844
         49  |  -.1177734   .0163975    -7.18   0.000     -.149914   -.0856329
         50  |  -.1643744   .0165655    -9.92   0.000    -.1968442   -.1319046
             |
     age_cat |
          2  |   .0519597    .004216    12.32   0.000      .043696    .0602235
          3  |   .0711164   .0047254    15.05   0.000     .0618541    .0803787
          4  |    .104667   .0051803    20.20   0.000     .0945132    .1148209
          5  |   .1380392   .0064068    21.55   0.000     .1254813    .1505971
          6  |   .1653849   .0079515    20.80   0.000     .1497993    .1809705
             |
       _cons |   .1927151   .0080673    23.89   0.000     .1769025    .2085278
-------------+----------------------------------------------------------------
     sigma_u |  .34459704
     sigma_e |  .29657094
         rho |  .57448616   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    158,582
Group variable: id                              Number of groups  =     15,065

R-sq:                                           Obs per group:
     within  = 0.0404                                         min =          1
     between = 0.0001                                         avg =       10.5
     overall = 0.0229                                         max =         24

                                                F(56,15064)       =     133.76
corr(u_i, Xb)  = -0.1864                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 15,065 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0272685   .0234112     1.16   0.244    -.0186203    .0731572
         new |   .0439954   .0068423     6.43   0.000     .0305836    .0574072
        fnew |  -.0083562   .0266472    -0.31   0.754    -.0605879    .0438755
  fnew_expat |  -.0156036   .0331328    -0.47   0.638     -.080548    .0493407
  fold_expat |  -.0044275    .039137    -0.11   0.910    -.0811407    .0722858
             |
    ind_year |
          3  |  -.2395718    .023637   -10.14   0.000    -.2859032   -.1932405
          4  |  -.2615879   .0231557   -11.30   0.000    -.3069759   -.2161999
          5  |  -.2272264   .0237122    -9.58   0.000    -.2737051   -.1807477
          6  |  -.2496109   .0235849   -10.58   0.000    -.2958402   -.2033816
          7  |  -.1895196   .0236751    -8.01   0.000    -.2359258   -.1431135
          8  |  -.2364701   .0236354   -10.00   0.000    -.2827984   -.1901418
          9  |  -.3212998   .0238209   -13.49   0.000    -.3679916   -.2746081
         10  |   -.310017   .0237624   -13.05   0.000    -.3565941   -.2634398
         11  |    -.27227   .0241345   -11.28   0.000    -.3195765   -.2249635
         12  |  -.2731967   .0239655   -11.40   0.000    -.3201719   -.2262215
         13  |  -.3926453    .024104   -16.29   0.000     -.439892   -.3453986
         14  |  -.3751136   .0241399   -15.54   0.000    -.4224308   -.3277963
         15  |  -.3508222   .0243086   -14.43   0.000      -.39847   -.3031744
         16  |  -.4311989   .0246424   -17.50   0.000     -.479501   -.3828968
         17  |  -.3676335   .0249165   -14.75   0.000    -.4164728   -.3187943
         18  |  -.3778275   .0246652   -15.32   0.000    -.4261743   -.3294807
         19  |  -.3918416   .0251194   -15.60   0.000    -.4410786   -.3426046
         20  |  -.3588942   .0250951   -14.30   0.000    -.4080836   -.3097049
         21  |  -.4377603   .0251953   -17.37   0.000    -.4871462   -.3883745
         22  |   -.318593   .0255261   -12.48   0.000    -.3686273   -.2685587
         23  |  -.4040536   .0258608   -15.62   0.000     -.454744   -.3533632
         24  |  -.9477906   .0269996   -35.10   0.000    -1.000713   -.8948681
         25  |  -.6251501   .0322408   -19.39   0.000    -.6883459   -.5619543
         27  |  -.1800782   .0370061    -4.87   0.000    -.2526146   -.1075418
         28  |   -.431998   .0340862   -12.67   0.000    -.4988111    -.365185
         29  |  -.3756149   .0322912   -11.63   0.000    -.4389097   -.3123201
         30  |  -.3792308   .0322487   -11.76   0.000    -.4424422   -.3160193
         31  |  -.3926364   .0317745   -12.36   0.000    -.4549184   -.3303545
         32  |   -.401583   .0315621   -12.72   0.000    -.4634486   -.3397173
         33  |  -.3517372   .0310403   -11.33   0.000    -.4125801   -.2908944
         34  |  -.4151344   .0310668   -13.36   0.000    -.4760292   -.3542396
         35  |    -.43747   .0310121   -14.11   0.000    -.4982576   -.3766825
         36  |   -.346236   .0310516   -11.15   0.000    -.4071009   -.2853711
         37  |   -.422355   .0311835   -13.54   0.000    -.4834786   -.3612315
         38  |  -.4457264   .0311461   -14.31   0.000    -.5067764   -.3846763
         39  |  -.4823113   .0315268   -15.30   0.000    -.5441077   -.4205149
         40  |  -.4828335   .0311961   -15.48   0.000    -.5439817   -.4216853
         41  |  -.5835374   .0317659   -18.37   0.000    -.6458025   -.5212722
         42  |  -.4406927   .0325368   -13.54   0.000    -.5044688   -.3769166
         43  |  -.4392207     .03187   -13.78   0.000    -.5016896   -.3767517
         44  |  -.5352541   .0325119   -16.46   0.000    -.5989814   -.4715268
         45  |  -.6370856   .0318807   -19.98   0.000    -.6995757   -.5745955
         46  |  -.5622775   .0324812   -17.31   0.000    -.6259446   -.4986104
         47  |  -.4175696   .0332704   -12.55   0.000    -.4827837   -.3523555
         48  |   -.604504   .0329838   -18.33   0.000    -.6691562   -.5398517
         49  |  -1.245951   .0316283   -39.39   0.000    -1.307947   -1.183956
         50  |   -.790042   .0432836   -18.25   0.000    -.8748831   -.7052009
             |
     age_cat |
          3  |  -.1467223   .0169182    -8.67   0.000    -.1798841   -.1135606
          4  |  -.3146049   .0157923   -19.92   0.000    -.3455598   -.2836499
          5  |  -.4107704    .016744   -24.53   0.000    -.4435906   -.3779502
          6  |   -.455678   .0179007   -25.46   0.000    -.4907656   -.4205905
             |
       _cons |   .6112935   .0240357    25.43   0.000     .5641806    .6584065
-------------+----------------------------------------------------------------
     sigma_u |  .49240053
     sigma_e |  .86025155
         rho |  .24677913   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0404153204066265

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    158,582
Group variable: id                              Number of groups  =     15,065

R-sq:                                           Obs per group:
     within  = 0.0404                                         min =          1
     between = 0.0001                                         avg =       10.5
     overall = 0.0229                                         max =         24

                                                F(56,15064)       =     133.76
corr(u_i, Xb)  = -0.1864                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 15,065 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0272685   .0234112     1.16   0.244    -.0186203    .0731572
         new |   .0439954   .0068423     6.43   0.000     .0305836    .0574072
        fnew |  -.0083562   .0266472    -0.31   0.754    -.0605879    .0438755
  fnew_expat |  -.0156036   .0331328    -0.47   0.638     -.080548    .0493407
  fold_expat |  -.0044275    .039137    -0.11   0.910    -.0811407    .0722858
             |
    ind_year |
          3  |  -.2395718    .023637   -10.14   0.000    -.2859032   -.1932405
          4  |  -.2615879   .0231557   -11.30   0.000    -.3069759   -.2161999
          5  |  -.2272264   .0237122    -9.58   0.000    -.2737051   -.1807477
          6  |  -.2496109   .0235849   -10.58   0.000    -.2958402   -.2033816
          7  |  -.1895196   .0236751    -8.01   0.000    -.2359258   -.1431135
          8  |  -.2364701   .0236354   -10.00   0.000    -.2827984   -.1901418
          9  |  -.3212998   .0238209   -13.49   0.000    -.3679916   -.2746081
         10  |   -.310017   .0237624   -13.05   0.000    -.3565941   -.2634398
         11  |    -.27227   .0241345   -11.28   0.000    -.3195765   -.2249635
         12  |  -.2731967   .0239655   -11.40   0.000    -.3201719   -.2262215
         13  |  -.3926453    .024104   -16.29   0.000     -.439892   -.3453986
         14  |  -.3751136   .0241399   -15.54   0.000    -.4224308   -.3277963
         15  |  -.3508222   .0243086   -14.43   0.000      -.39847   -.3031744
         16  |  -.4311989   .0246424   -17.50   0.000     -.479501   -.3828968
         17  |  -.3676335   .0249165   -14.75   0.000    -.4164728   -.3187943
         18  |  -.3778275   .0246652   -15.32   0.000    -.4261743   -.3294807
         19  |  -.3918416   .0251194   -15.60   0.000    -.4410786   -.3426046
         20  |  -.3588942   .0250951   -14.30   0.000    -.4080836   -.3097049
         21  |  -.4377603   .0251953   -17.37   0.000    -.4871462   -.3883745
         22  |   -.318593   .0255261   -12.48   0.000    -.3686273   -.2685587
         23  |  -.4040536   .0258608   -15.62   0.000     -.454744   -.3533632
         24  |  -.9477906   .0269996   -35.10   0.000    -1.000713   -.8948681
         25  |  -.6251501   .0322408   -19.39   0.000    -.6883459   -.5619543
         27  |  -.1800782   .0370061    -4.87   0.000    -.2526146   -.1075418
         28  |   -.431998   .0340862   -12.67   0.000    -.4988111    -.365185
         29  |  -.3756149   .0322912   -11.63   0.000    -.4389097   -.3123201
         30  |  -.3792308   .0322487   -11.76   0.000    -.4424422   -.3160193
         31  |  -.3926364   .0317745   -12.36   0.000    -.4549184   -.3303545
         32  |   -.401583   .0315621   -12.72   0.000    -.4634486   -.3397173
         33  |  -.3517372   .0310403   -11.33   0.000    -.4125801   -.2908944
         34  |  -.4151344   .0310668   -13.36   0.000    -.4760292   -.3542396
         35  |    -.43747   .0310121   -14.11   0.000    -.4982576   -.3766825
         36  |   -.346236   .0310516   -11.15   0.000    -.4071009   -.2853711
         37  |   -.422355   .0311835   -13.54   0.000    -.4834786   -.3612315
         38  |  -.4457264   .0311461   -14.31   0.000    -.5067764   -.3846763
         39  |  -.4823113   .0315268   -15.30   0.000    -.5441077   -.4205149
         40  |  -.4828335   .0311961   -15.48   0.000    -.5439817   -.4216853
         41  |  -.5835374   .0317659   -18.37   0.000    -.6458025   -.5212722
         42  |  -.4406927   .0325368   -13.54   0.000    -.5044688   -.3769166
         43  |  -.4392207     .03187   -13.78   0.000    -.5016896   -.3767517
         44  |  -.5352541   .0325119   -16.46   0.000    -.5989814   -.4715268
         45  |  -.6370856   .0318807   -19.98   0.000    -.6995757   -.5745955
         46  |  -.5622775   .0324812   -17.31   0.000    -.6259446   -.4986104
         47  |  -.4175696   .0332704   -12.55   0.000    -.4827837   -.3523555
         48  |   -.604504   .0329838   -18.33   0.000    -.6691562   -.5398517
         49  |  -1.245951   .0316283   -39.39   0.000    -1.307947   -1.183956
         50  |   -.790042   .0432836   -18.25   0.000    -.8748831   -.7052009
             |
     age_cat |
          3  |  -.1467223   .0169182    -8.67   0.000    -.1798841   -.1135606
          4  |  -.3146049   .0157923   -19.92   0.000    -.3455598   -.2836499
          5  |  -.4107704    .016744   -24.53   0.000    -.4435906   -.3779502
          6  |   -.455678   .0179007   -25.46   0.000    -.4907656   -.4205905
             |
       _cons |   .6112935   .0240357    25.43   0.000     .5641806    .6584065
-------------+----------------------------------------------------------------
     sigma_u |  .49240053
     sigma_e |  .86025155
         rho |  .24677913   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     59,007
Group variable: id                              Number of groups  =      5,839

R-sq:                                           Obs per group:
     within  = 0.0814                                         min =          1
     between = 0.0277                                         avg =       10.1
     overall = 0.0370                                         max =         25

                                                F(34,5838)        =      29.45
corr(u_i, Xb)  = -0.1076                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,839 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |  -.0437626   .0434558    -1.01   0.314    -.1289521     .041427
         new |  -.0765745   .0160734    -4.76   0.000    -.1080842   -.0450647
        fnew |   .0233079   .0556841     0.42   0.676    -.0858536    .1324693
  fnew_expat |   .0224096    .080167     0.28   0.780    -.1347474    .1795665
  fold_expat |   .0678541   .0896013     0.76   0.449    -.1077976    .2435058
             |
    ind_year |
         27  |  -.1396227   .0178411    -7.83   0.000    -.1745979   -.1046476
         28  |  -.2430255   .0237554   -10.23   0.000    -.2895949   -.1964561
         29  |  -.3222721   .0278638   -11.57   0.000    -.3768954   -.2676489
         30  |  -.3941264   .0314638   -12.53   0.000    -.4558071   -.3324456
         31  |  -.4394062   .0350469   -12.54   0.000    -.5081111   -.3707013
         32  |  -.4692077   .0374867   -12.52   0.000    -.5426955   -.3957199
         33  |  -.5250876   .0404564   -12.98   0.000    -.6043971    -.445778
         34  |  -.5655974     .04327   -13.07   0.000    -.6504227   -.4807722
         35  |  -.6105024   .0454739   -13.43   0.000    -.6996481   -.5213567
         36  |  -.6493267   .0474424   -13.69   0.000    -.7423314   -.5563221
         37  |  -.6883358   .0491584   -14.00   0.000    -.7847045   -.5919671
         38  |  -.7288642   .0511083   -14.26   0.000    -.8290555    -.628673
         39  |  -.7612284   .0528498   -14.40   0.000    -.8648336   -.6576232
         40  |  -.7640884   .0546206   -13.99   0.000    -.8711651   -.6570118
         41  |  -.7549824   .0554555   -13.61   0.000    -.8636957   -.6462692
         42  |  -.7747941   .0566788   -13.67   0.000    -.8859055   -.6636828
         43  |  -.8880292   .0575138   -15.44   0.000    -1.000778   -.7752808
         44  |  -.8954246   .0587339   -15.25   0.000    -1.010565   -.7802845
         45  |  -.8804882   .0594345   -14.81   0.000    -.9970018   -.7639745
         46  |  -.8860659   .0603594   -14.68   0.000    -1.004393   -.7677391
         47  |  -.8944024   .0609212   -14.68   0.000     -1.01383   -.7749743
         48  |  -.8782291   .0613338   -14.32   0.000    -.9984661   -.7579922
         49  |  -.8758879   .0628796   -13.93   0.000    -.9991552   -.7526205
         50  |  -.8750921   .0628551   -13.92   0.000    -.9983115   -.7518727
             |
     age_cat |
          2  |   .3665633   .0227315    16.13   0.000     .3220012    .4111254
          3  |   .5916711   .0273599    21.63   0.000     .5380357    .6453066
          4  |   .8743111   .0330155    26.48   0.000     .8095885    .9390337
          5  |   1.134767   .0409226    27.73   0.000     1.054544    1.214991
          6  |   1.341335   .0496489    27.02   0.000     1.244005    1.438665
             |
       _cons |   3.423225   .0346752    98.72   0.000     3.355249    3.491201
-------------+----------------------------------------------------------------
     sigma_u |  .98007476
     sigma_e |  .65221674
         rho |  .69306842   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0814469110631771

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     59,007
Group variable: id                              Number of groups  =      5,839

R-sq:                                           Obs per group:
     within  = 0.0814                                         min =          1
     between = 0.0277                                         avg =       10.1
     overall = 0.0370                                         max =         25

                                                F(34,5838)        =      29.45
corr(u_i, Xb)  = -0.1076                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,839 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |  -.0437626   .0434558    -1.01   0.314    -.1289521     .041427
         new |  -.0765745   .0160734    -4.76   0.000    -.1080842   -.0450647
        fnew |   .0233079   .0556841     0.42   0.676    -.0858536    .1324693
  fnew_expat |   .0224096    .080167     0.28   0.780    -.1347474    .1795665
  fold_expat |   .0678541   .0896013     0.76   0.449    -.1077976    .2435058
             |
    ind_year |
         27  |  -.1396227   .0178411    -7.83   0.000    -.1745979   -.1046476
         28  |  -.2430255   .0237554   -10.23   0.000    -.2895949   -.1964561
         29  |  -.3222721   .0278638   -11.57   0.000    -.3768954   -.2676489
         30  |  -.3941264   .0314638   -12.53   0.000    -.4558071   -.3324456
         31  |  -.4394062   .0350469   -12.54   0.000    -.5081111   -.3707013
         32  |  -.4692077   .0374867   -12.52   0.000    -.5426955   -.3957199
         33  |  -.5250876   .0404564   -12.98   0.000    -.6043971    -.445778
         34  |  -.5655974     .04327   -13.07   0.000    -.6504227   -.4807722
         35  |  -.6105024   .0454739   -13.43   0.000    -.6996481   -.5213567
         36  |  -.6493267   .0474424   -13.69   0.000    -.7423314   -.5563221
         37  |  -.6883358   .0491584   -14.00   0.000    -.7847045   -.5919671
         38  |  -.7288642   .0511083   -14.26   0.000    -.8290555    -.628673
         39  |  -.7612284   .0528498   -14.40   0.000    -.8648336   -.6576232
         40  |  -.7640884   .0546206   -13.99   0.000    -.8711651   -.6570118
         41  |  -.7549824   .0554555   -13.61   0.000    -.8636957   -.6462692
         42  |  -.7747941   .0566788   -13.67   0.000    -.8859055   -.6636828
         43  |  -.8880292   .0575138   -15.44   0.000    -1.000778   -.7752808
         44  |  -.8954246   .0587339   -15.25   0.000    -1.010565   -.7802845
         45  |  -.8804882   .0594345   -14.81   0.000    -.9970018   -.7639745
         46  |  -.8860659   .0603594   -14.68   0.000    -1.004393   -.7677391
         47  |  -.8944024   .0609212   -14.68   0.000     -1.01383   -.7749743
         48  |  -.8782291   .0613338   -14.32   0.000    -.9984661   -.7579922
         49  |  -.8758879   .0628796   -13.93   0.000    -.9991552   -.7526205
         50  |  -.8750921   .0628551   -13.92   0.000    -.9983115   -.7518727
             |
     age_cat |
          2  |   .3665633   .0227315    16.13   0.000     .3220012    .4111254
          3  |   .5916711   .0273599    21.63   0.000     .5380357    .6453066
          4  |   .8743111   .0330155    26.48   0.000     .8095885    .9390337
          5  |   1.134767   .0409226    27.73   0.000     1.054544    1.214991
          6  |   1.341335   .0496489    27.02   0.000     1.244005    1.438665
             |
       _cons |   3.423225   .0346752    98.72   0.000     3.355249    3.491201
-------------+----------------------------------------------------------------
     sigma_u |  .98007476
     sigma_e |  .65221674
         rho |  .69306842   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     59,007
Group variable: id                              Number of groups  =      5,839

R-sq:                                           Obs per group:
     within  = 0.3280                                         min =          1
     between = 0.1935                                         avg =       10.1
     overall = 0.1770                                         max =         25

                                                F(34,5838)        =     146.04
corr(u_i, Xb)  = 0.0604                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,839 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnQ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0967509    .054794     1.77   0.077    -.0106657    .2041675
         new |  -.0796644   .0180432    -4.42   0.000    -.1150358   -.0442929
        fnew |   .0461362    .068641     0.67   0.502    -.0884256    .1806981
  fnew_expat |    .237462   .0968866     2.45   0.014     .0475284    .4273957
  fold_expat |   .1452608   .1014904     1.43   0.152     -.053698    .3442197
             |
    ind_year |
         27  |  -.0299015   .0238604    -1.25   0.210    -.0766768    .0168737
         28  |   .0415589   .0296485     1.40   0.161    -.0165631    .0996808
         29  |   .1817197   .0338519     5.37   0.000     .1153574    .2480819
         30  |   .2766361   .0370565     7.47   0.000     .2039916    .3492805
         31  |   .3747791   .0409985     9.14   0.000     .2944069    .4551513
         32  |   .4904807   .0438631    11.18   0.000     .4044927    .5764687
         33  |   .4802392   .0474698    10.12   0.000     .3871809    .5732975
         34  |   .5802125   .0502186    11.55   0.000     .4817654    .6786596
         35  |   .6247757   .0531505    11.75   0.000      .520581    .7289704
         36  |   .6261242   .0553171    11.32   0.000     .5176823    .7345661
         37  |   .6409135   .0575154    11.14   0.000      .528162     .753665
         38  |    .673646   .0600046    11.23   0.000     .5560147    .7912774
         39  |   .6709626   .0621712    10.79   0.000     .5490842    .7928411
         40  |   .7682987   .0645383    11.90   0.000     .6417798    .8948177
         41  |   .8492819   .0647281    13.12   0.000     .7223909    .9761729
         42  |   .8935512   .0664121    13.45   0.000      .763359    1.023743
         43  |   .7418872   .0674444    11.00   0.000     .6096712    .8741032
         44  |   .7648139   .0691305    11.06   0.000     .6292926    .9003352
         45  |   .8650704   .0700028    12.36   0.000     .7278389    1.002302
         46  |   .8539507   .0715574    11.93   0.000     .7136717    .9942297
         47  |   .8843915   .0721109    12.26   0.000     .7430274    1.025756
         48  |   .9607408   .0731408    13.14   0.000     .8173578    1.104124
         49  |   .9549132   .0757823    12.60   0.000     .8063518    1.103475
         50  |   .9880181   .0751739    13.14   0.000     .8406495    1.135387
             |
     age_cat |
          2  |   .9695516    .030636    31.65   0.000     .9094937     1.02961
          3  |   1.210473   .0339985    35.60   0.000     1.143824    1.277123
          4  |   1.500695   .0395986    37.90   0.000     1.423068    1.578323
          5  |   1.783953   .0479224    37.23   0.000     1.690007    1.877899
          6  |   2.021424   .0583588    34.64   0.000     1.907019    2.135829
             |
       _cons |   10.15709   .0416731   243.73   0.000      10.0754    10.23879
-------------+----------------------------------------------------------------
     sigma_u |  1.4464212
     sigma_e |   .7671149
         rho |  .78047252   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .3279953770235672

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     59,007
Group variable: id                              Number of groups  =      5,839

R-sq:                                           Obs per group:
     within  = 0.3280                                         min =          1
     between = 0.1935                                         avg =       10.1
     overall = 0.1770                                         max =         25

                                                F(34,5838)        =     146.04
corr(u_i, Xb)  = 0.0604                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,839 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnQ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0967509    .054794     1.77   0.077    -.0106657    .2041675
         new |  -.0796644   .0180432    -4.42   0.000    -.1150358   -.0442929
        fnew |   .0461362    .068641     0.67   0.502    -.0884256    .1806981
  fnew_expat |    .237462   .0968866     2.45   0.014     .0475284    .4273957
  fold_expat |   .1452608   .1014904     1.43   0.152     -.053698    .3442197
             |
    ind_year |
         27  |  -.0299015   .0238604    -1.25   0.210    -.0766768    .0168737
         28  |   .0415589   .0296485     1.40   0.161    -.0165631    .0996808
         29  |   .1817197   .0338519     5.37   0.000     .1153574    .2480819
         30  |   .2766361   .0370565     7.47   0.000     .2039916    .3492805
         31  |   .3747791   .0409985     9.14   0.000     .2944069    .4551513
         32  |   .4904807   .0438631    11.18   0.000     .4044927    .5764687
         33  |   .4802392   .0474698    10.12   0.000     .3871809    .5732975
         34  |   .5802125   .0502186    11.55   0.000     .4817654    .6786596
         35  |   .6247757   .0531505    11.75   0.000      .520581    .7289704
         36  |   .6261242   .0553171    11.32   0.000     .5176823    .7345661
         37  |   .6409135   .0575154    11.14   0.000      .528162     .753665
         38  |    .673646   .0600046    11.23   0.000     .5560147    .7912774
         39  |   .6709626   .0621712    10.79   0.000     .5490842    .7928411
         40  |   .7682987   .0645383    11.90   0.000     .6417798    .8948177
         41  |   .8492819   .0647281    13.12   0.000     .7223909    .9761729
         42  |   .8935512   .0664121    13.45   0.000      .763359    1.023743
         43  |   .7418872   .0674444    11.00   0.000     .6096712    .8741032
         44  |   .7648139   .0691305    11.06   0.000     .6292926    .9003352
         45  |   .8650704   .0700028    12.36   0.000     .7278389    1.002302
         46  |   .8539507   .0715574    11.93   0.000     .7136717    .9942297
         47  |   .8843915   .0721109    12.26   0.000     .7430274    1.025756
         48  |   .9607408   .0731408    13.14   0.000     .8173578    1.104124
         49  |   .9549132   .0757823    12.60   0.000     .8063518    1.103475
         50  |   .9880181   .0751739    13.14   0.000     .8406495    1.135387
             |
     age_cat |
          2  |   .9695516    .030636    31.65   0.000     .9094937     1.02961
          3  |   1.210473   .0339985    35.60   0.000     1.143824    1.277123
          4  |   1.500695   .0395986    37.90   0.000     1.423068    1.578323
          5  |   1.783953   .0479224    37.23   0.000     1.690007    1.877899
          6  |   2.021424   .0583588    34.64   0.000     1.907019    2.135829
             |
       _cons |   10.15709   .0416731   243.73   0.000      10.0754    10.23879
-------------+----------------------------------------------------------------
     sigma_u |  1.4464212
     sigma_e |   .7671149
         rho |  .78047252   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     52,499
Group variable: id                              Number of groups  =      5,345

R-sq:                                           Obs per group:
     within  = 0.2069                                         min =          1
     between = 0.1090                                         avg =        9.8
     overall = 0.1150                                         max =         25

                                                F(34,5344)        =      61.18
corr(u_i, Xb)  = 0.0613                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,345 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnK |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .083589   .0758711     1.10   0.271    -.0651492    .2323273
         new |  -.0977034   .0255817    -3.82   0.000    -.1478541   -.0475528
        fnew |  -.1112095   .0783997    -1.42   0.156    -.2649049    .0424859
  fnew_expat |   .1860775   .1052376     1.77   0.077    -.0202311    .3923861
  fold_expat |   .1260291   .1169686     1.08   0.281    -.1032772    .3553354
             |
    ind_year |
         27  |  -.1321196   .0344345    -3.84   0.000    -.1996252   -.0646139
         28  |  -.0465164   .0414797    -1.12   0.262    -.1278336    .0348008
         29  |  -.1025576   .0475268    -2.16   0.031    -.1957295   -.0093856
         30  |  -.0876987   .0534163    -1.64   0.101    -.1924164     .017019
         31  |    .012103   .0580739     0.21   0.835    -.1017455    .1259516
         32  |   .1590114   .0625433     2.54   0.011     .0364009    .2816218
         33  |   .1918983   .0678439     2.83   0.005     .0588967       .3249
         34  |   .2446052   .0710942     3.44   0.001     .1052316    .3839787
         35  |   .3071222   .0742968     4.13   0.000     .1614703    .4527742
         36  |   .3757246   .0778672     4.83   0.000      .223073    .5283762
         37  |   .4268079   .0811191     5.26   0.000     .2677814    .5858345
         38  |   .4619339    .082837     5.58   0.000     .2995396    .6243282
         39  |   .4574957   .0851239     5.37   0.000     .2906181    .6243733
         40  |   .4352162   .0880542     4.94   0.000      .262594    .6078384
         41  |   .4877178   .0900607     5.42   0.000      .311162    .6642735
         42  |    .546555   .0921582     5.93   0.000     .3658873    .7272227
         43  |   .4617416   .0938166     4.92   0.000     .2778228    .6456603
         44  |   .4493636   .0955806     4.70   0.000     .2619867    .6367404
         45  |   .4826858   .0966536     4.99   0.000     .2932053    .6721662
         46  |   .4646891   .0976979     4.76   0.000     .2731614    .6562167
         47  |   .5094339    .098509     5.17   0.000      .316316    .7025518
         48  |   .5790289   .0993943     5.83   0.000     .3841755    .7738824
         49  |   .6029334   .1044604     5.77   0.000     .3981484    .8077184
         50  |   .7328022   .1080285     6.78   0.000     .5210222    .9445822
             |
     age_cat |
          2  |   .5491151   .0442575    12.41   0.000     .4623525    .6358778
          3  |   .8980585     .05069    17.72   0.000     .7986854    .9974317
          4  |   1.254435   .0578936    21.67   0.000     1.140939     1.36793
          5  |   1.566163   .0690812    22.67   0.000     1.430736    1.701591
          6  |   1.844733    .081207    22.72   0.000     1.685534    2.003932
             |
       _cons |   8.194319   .0603254   135.84   0.000     8.076057    8.312581
-------------+----------------------------------------------------------------
     sigma_u |  1.8352089
     sigma_e |  .97955674
         rho |  .77827238   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2068861715256699

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     52,499
Group variable: id                              Number of groups  =      5,345

R-sq:                                           Obs per group:
     within  = 0.2069                                         min =          1
     between = 0.1090                                         avg =        9.8
     overall = 0.1150                                         max =         25

                                                F(34,5344)        =      61.18
corr(u_i, Xb)  = 0.0613                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,345 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnK |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .083589   .0758711     1.10   0.271    -.0651492    .2323273
         new |  -.0977034   .0255817    -3.82   0.000    -.1478541   -.0475528
        fnew |  -.1112095   .0783997    -1.42   0.156    -.2649049    .0424859
  fnew_expat |   .1860775   .1052376     1.77   0.077    -.0202311    .3923861
  fold_expat |   .1260291   .1169686     1.08   0.281    -.1032772    .3553354
             |
    ind_year |
         27  |  -.1321196   .0344345    -3.84   0.000    -.1996252   -.0646139
         28  |  -.0465164   .0414797    -1.12   0.262    -.1278336    .0348008
         29  |  -.1025576   .0475268    -2.16   0.031    -.1957295   -.0093856
         30  |  -.0876987   .0534163    -1.64   0.101    -.1924164     .017019
         31  |    .012103   .0580739     0.21   0.835    -.1017455    .1259516
         32  |   .1590114   .0625433     2.54   0.011     .0364009    .2816218
         33  |   .1918983   .0678439     2.83   0.005     .0588967       .3249
         34  |   .2446052   .0710942     3.44   0.001     .1052316    .3839787
         35  |   .3071222   .0742968     4.13   0.000     .1614703    .4527742
         36  |   .3757246   .0778672     4.83   0.000      .223073    .5283762
         37  |   .4268079   .0811191     5.26   0.000     .2677814    .5858345
         38  |   .4619339    .082837     5.58   0.000     .2995396    .6243282
         39  |   .4574957   .0851239     5.37   0.000     .2906181    .6243733
         40  |   .4352162   .0880542     4.94   0.000      .262594    .6078384
         41  |   .4877178   .0900607     5.42   0.000      .311162    .6642735
         42  |    .546555   .0921582     5.93   0.000     .3658873    .7272227
         43  |   .4617416   .0938166     4.92   0.000     .2778228    .6456603
         44  |   .4493636   .0955806     4.70   0.000     .2619867    .6367404
         45  |   .4826858   .0966536     4.99   0.000     .2932053    .6721662
         46  |   .4646891   .0976979     4.76   0.000     .2731614    .6562167
         47  |   .5094339    .098509     5.17   0.000      .316316    .7025518
         48  |   .5790289   .0993943     5.83   0.000     .3841755    .7738824
         49  |   .6029334   .1044604     5.77   0.000     .3981484    .8077184
         50  |   .7328022   .1080285     6.78   0.000     .5210222    .9445822
             |
     age_cat |
          2  |   .5491151   .0442575    12.41   0.000     .4623525    .6358778
          3  |   .8980585     .05069    17.72   0.000     .7986854    .9974317
          4  |   1.254435   .0578936    21.67   0.000     1.140939     1.36793
          5  |   1.566163   .0690812    22.67   0.000     1.430736    1.701591
          6  |   1.844733    .081207    22.72   0.000     1.685534    2.003932
             |
       _cons |   8.194319   .0603254   135.84   0.000     8.076057    8.312581
-------------+----------------------------------------------------------------
     sigma_u |  1.8352089
     sigma_e |  .97955674
         rho |  .77827238   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     59,007
Group variable: id                              Number of groups  =      5,839

R-sq:                                           Obs per group:
     within  = 0.4396                                         min =          1
     between = 0.3479                                         avg =       10.1
     overall = 0.3003                                         max =         25

                                                F(34,5838)        =     251.94
corr(u_i, Xb)  = 0.1256                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,839 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1405135   .0339021     4.14   0.000     .0740528    .2069742
         new |  -.0030899   .0111337    -0.28   0.781    -.0249162    .0187364
        fnew |   .0228283   .0356544     0.64   0.522    -.0470675    .0927242
  fnew_expat |   .2150525   .0574565     3.74   0.000     .1024164    .3276886
  fold_expat |   .0774067   .0565066     1.37   0.171    -.0333671    .1881805
             |
    ind_year |
         27  |   .1097212   .0178874     6.13   0.000     .0746553    .1447871
         28  |   .2845843   .0200158    14.22   0.000     .2453459    .3238227
         29  |   .5039918   .0217594    23.16   0.000     .4613353    .5466483
         30  |   .6707624   .0229281    29.25   0.000     .6258148    .7157101
         31  |   .8141853   .0244859    33.25   0.000     .7661839    .8621867
         32  |   .9596884   .0254329    37.73   0.000     .9098305    1.009546
         33  |   1.005327   .0268453    37.45   0.000     .9527001    1.057953
         34  |    1.14581   .0281686    40.68   0.000     1.090589    1.201031
         35  |   1.235278   .0295249    41.84   0.000     1.177398    1.293158
         36  |   1.275451   .0304866    41.84   0.000     1.215686    1.335216
         37  |   1.329249   .0318451    41.74   0.000     1.266821    1.391677
         38  |    1.40251   .0333092    42.11   0.000     1.337212    1.467809
         39  |   1.432191   .0346433    41.34   0.000     1.364277    1.500105
         40  |   1.532387    .036062    42.49   0.000     1.461692    1.603082
         41  |   1.604264   .0359084    44.68   0.000     1.533871    1.674658
         42  |   1.668345   .0370947    44.98   0.000     1.595626    1.741065
         43  |   1.629916   .0372243    43.79   0.000     1.556943     1.70289
         44  |   1.660239   .0383961    43.24   0.000     1.584968    1.735509
         45  |   1.745559   .0386659    45.14   0.000     1.669759    1.821358
         46  |   1.740017   .0393393    44.23   0.000     1.662897    1.817136
         47  |   1.778794   .0399744    44.50   0.000     1.700429    1.857158
         48  |    1.83897   .0400282    45.94   0.000       1.7605     1.91744
         49  |   1.830801   .0418667    43.73   0.000     1.748727    1.912875
         50  |    1.86311   .0409831    45.46   0.000     1.782768    1.943452
             |
     age_cat |
          2  |   .6029883   .0255336    23.62   0.000      .552933    .6530436
          3  |    .618802   .0275309    22.48   0.000     .5648313    .6727727
          4  |   .6263843   .0298707    20.97   0.000     .5678266    .6849419
          5  |   .6491859   .0330812    19.62   0.000     .5843344    .7140374
          6  |   .6800887   .0374584    18.16   0.000     .6066564     .753521
             |
       _cons |    6.73387   .0291762   230.80   0.000     6.676673    6.791066
-------------+----------------------------------------------------------------
     sigma_u |  1.1320815
     sigma_e |  .51681741
         rho |   .8275336   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .4395945513787743

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     59,007
Group variable: id                              Number of groups  =      5,839

R-sq:                                           Obs per group:
     within  = 0.4396                                         min =          1
     between = 0.3479                                         avg =       10.1
     overall = 0.3003                                         max =         25

                                                F(34,5838)        =     251.94
corr(u_i, Xb)  = 0.1256                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,839 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1405135   .0339021     4.14   0.000     .0740528    .2069742
         new |  -.0030899   .0111337    -0.28   0.781    -.0249162    .0187364
        fnew |   .0228283   .0356544     0.64   0.522    -.0470675    .0927242
  fnew_expat |   .2150525   .0574565     3.74   0.000     .1024164    .3276886
  fold_expat |   .0774067   .0565066     1.37   0.171    -.0333671    .1881805
             |
    ind_year |
         27  |   .1097212   .0178874     6.13   0.000     .0746553    .1447871
         28  |   .2845843   .0200158    14.22   0.000     .2453459    .3238227
         29  |   .5039918   .0217594    23.16   0.000     .4613353    .5466483
         30  |   .6707624   .0229281    29.25   0.000     .6258148    .7157101
         31  |   .8141853   .0244859    33.25   0.000     .7661839    .8621867
         32  |   .9596884   .0254329    37.73   0.000     .9098305    1.009546
         33  |   1.005327   .0268453    37.45   0.000     .9527001    1.057953
         34  |    1.14581   .0281686    40.68   0.000     1.090589    1.201031
         35  |   1.235278   .0295249    41.84   0.000     1.177398    1.293158
         36  |   1.275451   .0304866    41.84   0.000     1.215686    1.335216
         37  |   1.329249   .0318451    41.74   0.000     1.266821    1.391677
         38  |    1.40251   .0333092    42.11   0.000     1.337212    1.467809
         39  |   1.432191   .0346433    41.34   0.000     1.364277    1.500105
         40  |   1.532387    .036062    42.49   0.000     1.461692    1.603082
         41  |   1.604264   .0359084    44.68   0.000     1.533871    1.674658
         42  |   1.668345   .0370947    44.98   0.000     1.595626    1.741065
         43  |   1.629916   .0372243    43.79   0.000     1.556943     1.70289
         44  |   1.660239   .0383961    43.24   0.000     1.584968    1.735509
         45  |   1.745559   .0386659    45.14   0.000     1.669759    1.821358
         46  |   1.740017   .0393393    44.23   0.000     1.662897    1.817136
         47  |   1.778794   .0399744    44.50   0.000     1.700429    1.857158
         48  |    1.83897   .0400282    45.94   0.000       1.7605     1.91744
         49  |   1.830801   .0418667    43.73   0.000     1.748727    1.912875
         50  |    1.86311   .0409831    45.46   0.000     1.782768    1.943452
             |
     age_cat |
          2  |   .6029883   .0255336    23.62   0.000      .552933    .6530436
          3  |    .618802   .0275309    22.48   0.000     .5648313    .6727727
          4  |   .6263843   .0298707    20.97   0.000     .5678266    .6849419
          5  |   .6491859   .0330812    19.62   0.000     .5843344    .7140374
          6  |   .6800887   .0374584    18.16   0.000     .6066564     .753521
             |
       _cons |    6.73387   .0291762   230.80   0.000     6.676673    6.791066
-------------+----------------------------------------------------------------
     sigma_u |  1.1320815
     sigma_e |  .51681741
         rho |   .8275336   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     52,499
Group variable: id                              Number of groups  =      5,345

R-sq:                                           Obs per group:
     within  = 0.2032                                         min =          1
     between = 0.1635                                         avg =        9.8
     overall = 0.1639                                         max =         25

                                                F(34,5344)        =      62.16
corr(u_i, Xb)  = 0.1287                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,345 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0949442   .0638923     1.49   0.137    -.0303109    .2201993
         new |  -.0204492   .0207206    -0.99   0.324      -.06107    .0201716
        fnew |  -.1397855   .0679798    -2.06   0.040    -.2730536   -.0065175
  fnew_expat |   .1955876   .0769485     2.54   0.011     .0447372    .3464381
  fold_expat |   .1015258   .0891963     1.14   0.255    -.0733354    .2763869
             |
    ind_year |
         27  |   .0391009   .0295589     1.32   0.186    -.0188466    .0970484
         28  |   .2413439   .0351577     6.86   0.000     .1724204    .3102674
         29  |   .2736917   .0391805     6.99   0.000     .1968819    .3505015
         30  |   .3635621   .0432508     8.41   0.000     .2787728    .4483514
         31  |   .4969101   .0465506    10.67   0.000     .4056519    .5881683
         32  |   .6855219   .0497482    13.78   0.000     .5879951    .7830486
         33  |   .7774453   .0534504    14.55   0.000     .6726607    .8822298
         34  |   .8665693   .0563942    15.37   0.000     .7560137    .9771249
         35  |   .9710202   .0587162    16.54   0.000     .8559126    1.086128
         36  |   1.080723    .061455    17.59   0.000     .9602459      1.2012
         37  |   1.175136   .0640056    18.36   0.000     1.049659    1.300613
         38  |   1.240399   .0649144    19.11   0.000      1.11314    1.367658
         39  |   1.264864   .0662262    19.10   0.000     1.135033    1.394694
         40  |   1.244904   .0681154    18.28   0.000      1.11137    1.378438
         41  |   1.287724   .0692803    18.59   0.000     1.151906    1.423541
         42  |   1.360481    .071025    19.15   0.000     1.221243    1.499719
         43  |   1.389327   .0727964    19.09   0.000     1.246617    1.532038
         44  |   1.382365   .0740724    18.66   0.000     1.237153    1.527577
         45  |   1.400174   .0745477    18.78   0.000     1.254031    1.546318
         46  |    1.38964   .0754396    18.42   0.000     1.241747    1.537532
         47  |   1.443435   .0755788    19.10   0.000     1.295269      1.5916
         48  |   1.487158   .0757311    19.64   0.000     1.338694    1.635622
         49  |   1.309955   .0806303    16.25   0.000     1.151887    1.468023
         50  |   1.397718   .0833407    16.77   0.000     1.234336    1.561099
             |
     age_cat |
          2  |   .2090083    .041685     5.01   0.000     .1272888    .2907279
          3  |   .3269329   .0466315     7.01   0.000     .2355161    .4183496
          4  |   .4191923   .0509576     8.23   0.000     .3192945    .5190901
          5  |   .4704438   .0586443     8.02   0.000     .3554771    .5854104
          6  |   .5657833   .0674767     8.38   0.000     .4335014    .6980652
             |
       _cons |   4.629622   .0516668    89.61   0.000     4.528335     4.73091
-------------+----------------------------------------------------------------
     sigma_u |  1.5936776
     sigma_e |  .84503007
         rho |  .78054662   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2031532669822999

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     52,499
Group variable: id                              Number of groups  =      5,345

R-sq:                                           Obs per group:
     within  = 0.2032                                         min =          1
     between = 0.1635                                         avg =        9.8
     overall = 0.1639                                         max =         25

                                                F(34,5344)        =      62.16
corr(u_i, Xb)  = 0.1287                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,345 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0949442   .0638923     1.49   0.137    -.0303109    .2201993
         new |  -.0204492   .0207206    -0.99   0.324      -.06107    .0201716
        fnew |  -.1397855   .0679798    -2.06   0.040    -.2730536   -.0065175
  fnew_expat |   .1955876   .0769485     2.54   0.011     .0447372    .3464381
  fold_expat |   .1015258   .0891963     1.14   0.255    -.0733354    .2763869
             |
    ind_year |
         27  |   .0391009   .0295589     1.32   0.186    -.0188466    .0970484
         28  |   .2413439   .0351577     6.86   0.000     .1724204    .3102674
         29  |   .2736917   .0391805     6.99   0.000     .1968819    .3505015
         30  |   .3635621   .0432508     8.41   0.000     .2787728    .4483514
         31  |   .4969101   .0465506    10.67   0.000     .4056519    .5881683
         32  |   .6855219   .0497482    13.78   0.000     .5879951    .7830486
         33  |   .7774453   .0534504    14.55   0.000     .6726607    .8822298
         34  |   .8665693   .0563942    15.37   0.000     .7560137    .9771249
         35  |   .9710202   .0587162    16.54   0.000     .8559126    1.086128
         36  |   1.080723    .061455    17.59   0.000     .9602459      1.2012
         37  |   1.175136   .0640056    18.36   0.000     1.049659    1.300613
         38  |   1.240399   .0649144    19.11   0.000      1.11314    1.367658
         39  |   1.264864   .0662262    19.10   0.000     1.135033    1.394694
         40  |   1.244904   .0681154    18.28   0.000      1.11137    1.378438
         41  |   1.287724   .0692803    18.59   0.000     1.151906    1.423541
         42  |   1.360481    .071025    19.15   0.000     1.221243    1.499719
         43  |   1.389327   .0727964    19.09   0.000     1.246617    1.532038
         44  |   1.382365   .0740724    18.66   0.000     1.237153    1.527577
         45  |   1.400174   .0745477    18.78   0.000     1.254031    1.546318
         46  |    1.38964   .0754396    18.42   0.000     1.241747    1.537532
         47  |   1.443435   .0755788    19.10   0.000     1.295269      1.5916
         48  |   1.487158   .0757311    19.64   0.000     1.338694    1.635622
         49  |   1.309955   .0806303    16.25   0.000     1.151887    1.468023
         50  |   1.397718   .0833407    16.77   0.000     1.234336    1.561099
             |
     age_cat |
          2  |   .2090083    .041685     5.01   0.000     .1272888    .2907279
          3  |   .3269329   .0466315     7.01   0.000     .2355161    .4183496
          4  |   .4191923   .0509576     8.23   0.000     .3192945    .5190901
          5  |   .4704438   .0586443     8.02   0.000     .3554771    .5854104
          6  |   .5657833   .0674767     8.38   0.000     .4335014    .6980652
             |
       _cons |   4.629622   .0516668    89.61   0.000     4.528335     4.73091
-------------+----------------------------------------------------------------
     sigma_u |  1.5936776
     sigma_e |  .84503007
         rho |  .78054662   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     59,007
Group variable: id                              Number of groups  =      5,839

R-sq:                                           Obs per group:
     within  = 0.0644                                         min =          1
     between = 0.0607                                         avg =       10.1
     overall = 0.0479                                         max =         25

                                                F(34,5838)        =      39.30
corr(u_i, Xb)  = 0.0404                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,839 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .004992     .01632     0.31   0.760    -.0270013    .0369852
         new |  -.0227495   .0067706    -3.36   0.001    -.0360223   -.0094766
        fnew |   .0158015    .018759     0.84   0.400    -.0209731     .052576
  fnew_expat |   .0248881   .0207339     1.20   0.230     -.015758    .0655342
  fold_expat |   .0139135   .0251758     0.55   0.581    -.0354404    .0632675
             |
    ind_year |
         27  |  -.0111501   .0095026    -1.17   0.241    -.0297787    .0074784
         28  |  -.0141649   .0110817    -1.28   0.201    -.0358892    .0075593
         29  |  -.0135094   .0122957    -1.10   0.272    -.0376135    .0105946
         30  |   .0004937   .0135754     0.04   0.971    -.0261191    .0271065
         31  |  -.0080573   .0143898    -0.56   0.576    -.0362666     .020152
         32  |  -.0040131   .0151523    -0.26   0.791    -.0337172    .0256911
         33  |  -.0193532   .0160582    -1.21   0.228    -.0508331    .0121267
         34  |  -.0211089   .0170601    -1.24   0.216     -.054553    .0123352
         35  |  -.0159124   .0176504    -0.90   0.367    -.0505138     .018689
         36  |  -.0180276    .018436    -0.98   0.328    -.0541689    .0181137
         37  |  -.0218075   .0189049    -1.15   0.249    -.0588681     .015253
         38  |  -.0225083   .0193908    -1.16   0.246    -.0605215    .0155049
         39  |  -.0145654   .0199062    -0.73   0.464     -.053589    .0244581
         40  |  -.0037356    .020359    -0.18   0.854    -.0436468    .0361756
         41  |   .0138819   .0206736     0.67   0.502    -.0266459    .0544098
         42  |   .0197326   .0209153     0.94   0.345    -.0212691    .0607344
         43  |   .0235066   .0213996     1.10   0.272    -.0184445    .0654577
         44  |   .0383574   .0218539     1.76   0.079    -.0044844    .0811991
         45  |   .0480192   .0218489     2.20   0.028     .0051872    .0908513
         46  |   .0528672   .0223235     2.37   0.018     .0091049    .0966294
         47  |   .0684392   .0224717     3.05   0.002     .0243864    .1124921
         48  |   .0516385   .0227255     2.27   0.023     .0070881    .0961888
         49  |  -.2171229   .0234416    -9.26   0.000    -.2630772   -.1711686
         50  |  -.2724799   .0235935   -11.55   0.000    -.3187319   -.2262279
             |
     age_cat |
          2  |   .0783111   .0098696     7.93   0.000      .058963    .0976593
          3  |   .1060418   .0110218     9.62   0.000      .084435    .1276485
          4  |   .1487338   .0119855    12.41   0.000     .1252379    .1722297
          5  |    .200065   .0146566    13.65   0.000     .1713327    .2287973
          6  |   .2465647   .0176662    13.96   0.000     .2119324    .2811971
             |
       _cons |   .3710559   .0134208    27.65   0.000     .3447462    .3973656
-------------+----------------------------------------------------------------
     sigma_u |  .40201012
     sigma_e |  .32451765
         rho |   .6054616   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .064406569675018

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     59,007
Group variable: id                              Number of groups  =      5,839

R-sq:                                           Obs per group:
     within  = 0.0644                                         min =          1
     between = 0.0607                                         avg =       10.1
     overall = 0.0479                                         max =         25

                                                F(34,5838)        =      39.30
corr(u_i, Xb)  = 0.0404                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 5,839 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .004992     .01632     0.31   0.760    -.0270013    .0369852
         new |  -.0227495   .0067706    -3.36   0.001    -.0360223   -.0094766
        fnew |   .0158015    .018759     0.84   0.400    -.0209731     .052576
  fnew_expat |   .0248881   .0207339     1.20   0.230     -.015758    .0655342
  fold_expat |   .0139135   .0251758     0.55   0.581    -.0354404    .0632675
             |
    ind_year |
         27  |  -.0111501   .0095026    -1.17   0.241    -.0297787    .0074784
         28  |  -.0141649   .0110817    -1.28   0.201    -.0358892    .0075593
         29  |  -.0135094   .0122957    -1.10   0.272    -.0376135    .0105946
         30  |   .0004937   .0135754     0.04   0.971    -.0261191    .0271065
         31  |  -.0080573   .0143898    -0.56   0.576    -.0362666     .020152
         32  |  -.0040131   .0151523    -0.26   0.791    -.0337172    .0256911
         33  |  -.0193532   .0160582    -1.21   0.228    -.0508331    .0121267
         34  |  -.0211089   .0170601    -1.24   0.216     -.054553    .0123352
         35  |  -.0159124   .0176504    -0.90   0.367    -.0505138     .018689
         36  |  -.0180276    .018436    -0.98   0.328    -.0541689    .0181137
         37  |  -.0218075   .0189049    -1.15   0.249    -.0588681     .015253
         38  |  -.0225083   .0193908    -1.16   0.246    -.0605215    .0155049
         39  |  -.0145654   .0199062    -0.73   0.464     -.053589    .0244581
         40  |  -.0037356    .020359    -0.18   0.854    -.0436468    .0361756
         41  |   .0138819   .0206736     0.67   0.502    -.0266459    .0544098
         42  |   .0197326   .0209153     0.94   0.345    -.0212691    .0607344
         43  |   .0235066   .0213996     1.10   0.272    -.0184445    .0654577
         44  |   .0383574   .0218539     1.76   0.079    -.0044844    .0811991
         45  |   .0480192   .0218489     2.20   0.028     .0051872    .0908513
         46  |   .0528672   .0223235     2.37   0.018     .0091049    .0966294
         47  |   .0684392   .0224717     3.05   0.002     .0243864    .1124921
         48  |   .0516385   .0227255     2.27   0.023     .0070881    .0961888
         49  |  -.2171229   .0234416    -9.26   0.000    -.2630772   -.1711686
         50  |  -.2724799   .0235935   -11.55   0.000    -.3187319   -.2262279
             |
     age_cat |
          2  |   .0783111   .0098696     7.93   0.000      .058963    .0976593
          3  |   .1060418   .0110218     9.62   0.000      .084435    .1276485
          4  |   .1487338   .0119855    12.41   0.000     .1252379    .1722297
          5  |    .200065   .0146566    13.65   0.000     .1713327    .2287973
          6  |   .2465647   .0176662    13.96   0.000     .2119324    .2811971
             |
       _cons |   .3710559   .0134208    27.65   0.000     .3447462    .3973656
-------------+----------------------------------------------------------------
     sigma_u |  .40201012
     sigma_e |  .32451765
         rho |   .6054616   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     46,841
Group variable: id                              Number of groups  =      4,860

R-sq:                                           Obs per group:
     within  = 0.0452                                         min =          1
     between = 0.0020                                         avg =        9.6
     overall = 0.0268                                         max =         24

                                                F(32,4859)        =      92.56
corr(u_i, Xb)  = -0.1720                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 4,860 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1441607    .037621     3.83   0.000     .0704066    .2179148
         new |     .03374   .0128809     2.62   0.009     .0084875    .0589925
        fnew |  -.0244366   .0430249    -0.57   0.570    -.1087849    .0599117
  fnew_expat |   .0064582   .0512029     0.13   0.900    -.0939226     .106839
  fold_expat |  -.0072216   .0619585    -0.12   0.907    -.1286883    .1142451
             |
    ind_year |
         28  |  -.2454582   .0337968    -7.26   0.000    -.3117152   -.1792012
         29  |  -.1758416   .0333048    -5.28   0.000    -.2411342   -.1105491
         30  |   -.149231   .0341712    -4.37   0.000    -.2162221     -.08224
         31  |  -.2059853   .0353315    -5.83   0.000     -.275251   -.1367197
         32  |  -.1894279   .0357257    -5.30   0.000    -.2594664   -.1193895
         33  |  -.1447243   .0357173    -4.05   0.000    -.2147464   -.0747022
         34  |  -.2123647   .0360734    -5.89   0.000    -.2830848   -.1416446
         35  |  -.2417554   .0366342    -6.60   0.000     -.313575   -.1699358
         36  |  -.1113139   .0369414    -3.01   0.003    -.1837358   -.0388921
         37  |  -.2168854   .0370222    -5.86   0.000    -.2894657    -.144305
         38  |  -.2240727   .0382836    -5.85   0.000    -.2991258   -.1490196
         39  |  -.2499648   .0384051    -6.51   0.000    -.3252561   -.1746734
         40  |  -.2608926   .0381169    -6.84   0.000    -.3356189   -.1861663
         41  |  -.3520672   .0393032    -8.96   0.000    -.4291193   -.2750152
         42  |   -.246908   .0403632    -6.12   0.000    -.3260382   -.1677778
         43  |  -.2144646   .0400129    -5.36   0.000     -.292908   -.1360211
         44  |  -.3456729    .040077    -8.63   0.000     -.424242   -.2671038
         45  |  -.4042373   .0403727   -10.01   0.000     -.483386   -.3250886
         46  |  -.3562148   .0407069    -8.75   0.000    -.4360186   -.2764109
         47  |   -.229811   .0416002    -5.52   0.000    -.3113663   -.1482557
         48  |  -.3728157   .0420055    -8.88   0.000    -.4551654    -.290466
         49  |  -1.019722   .0401202   -25.42   0.000    -1.098375   -.9410678
         50  |  -.5323525   .0518117   -10.27   0.000    -.6339268   -.4307782
             |
     age_cat |
          3  |  -.1827958   .0311487    -5.87   0.000    -.2438613   -.1217303
          4  |  -.3490663   .0285195   -12.24   0.000    -.4049775   -.2931551
          5  |  -.4697966   .0309398   -15.18   0.000    -.5304525   -.4091406
          6  |  -.5153361   .0334949   -15.39   0.000    -.5810011    -.449671
             |
       _cons |   .5004677   .0351621    14.23   0.000     .4315341    .5694014
-------------+----------------------------------------------------------------
     sigma_u |  .49759111
     sigma_e |   .8474977
         rho |   .2563515   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0452193881983107

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     46,841
Group variable: id                              Number of groups  =      4,860

R-sq:                                           Obs per group:
     within  = 0.0452                                         min =          1
     between = 0.0020                                         avg =        9.6
     overall = 0.0268                                         max =         24

                                                F(32,4859)        =      92.56
corr(u_i, Xb)  = -0.1720                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 4,860 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1441607    .037621     3.83   0.000     .0704066    .2179148
         new |     .03374   .0128809     2.62   0.009     .0084875    .0589925
        fnew |  -.0244366   .0430249    -0.57   0.570    -.1087849    .0599117
  fnew_expat |   .0064582   .0512029     0.13   0.900    -.0939226     .106839
  fold_expat |  -.0072216   .0619585    -0.12   0.907    -.1286883    .1142451
             |
    ind_year |
         28  |  -.2454582   .0337968    -7.26   0.000    -.3117152   -.1792012
         29  |  -.1758416   .0333048    -5.28   0.000    -.2411342   -.1105491
         30  |   -.149231   .0341712    -4.37   0.000    -.2162221     -.08224
         31  |  -.2059853   .0353315    -5.83   0.000     -.275251   -.1367197
         32  |  -.1894279   .0357257    -5.30   0.000    -.2594664   -.1193895
         33  |  -.1447243   .0357173    -4.05   0.000    -.2147464   -.0747022
         34  |  -.2123647   .0360734    -5.89   0.000    -.2830848   -.1416446
         35  |  -.2417554   .0366342    -6.60   0.000     -.313575   -.1699358
         36  |  -.1113139   .0369414    -3.01   0.003    -.1837358   -.0388921
         37  |  -.2168854   .0370222    -5.86   0.000    -.2894657    -.144305
         38  |  -.2240727   .0382836    -5.85   0.000    -.2991258   -.1490196
         39  |  -.2499648   .0384051    -6.51   0.000    -.3252561   -.1746734
         40  |  -.2608926   .0381169    -6.84   0.000    -.3356189   -.1861663
         41  |  -.3520672   .0393032    -8.96   0.000    -.4291193   -.2750152
         42  |   -.246908   .0403632    -6.12   0.000    -.3260382   -.1677778
         43  |  -.2144646   .0400129    -5.36   0.000     -.292908   -.1360211
         44  |  -.3456729    .040077    -8.63   0.000     -.424242   -.2671038
         45  |  -.4042373   .0403727   -10.01   0.000     -.483386   -.3250886
         46  |  -.3562148   .0407069    -8.75   0.000    -.4360186   -.2764109
         47  |   -.229811   .0416002    -5.52   0.000    -.3113663   -.1482557
         48  |  -.3728157   .0420055    -8.88   0.000    -.4551654    -.290466
         49  |  -1.019722   .0401202   -25.42   0.000    -1.098375   -.9410678
         50  |  -.5323525   .0518117   -10.27   0.000    -.6339268   -.4307782
             |
     age_cat |
          3  |  -.1827958   .0311487    -5.87   0.000    -.2438613   -.1217303
          4  |  -.3490663   .0285195   -12.24   0.000    -.4049775   -.2931551
          5  |  -.4697966   .0309398   -15.18   0.000    -.5304525   -.4091406
          6  |  -.5153361   .0334949   -15.39   0.000    -.5810011    -.449671
             |
       _cons |   .5004677   .0351621    14.23   0.000     .4315341    .5694014
-------------+----------------------------------------------------------------
     sigma_u |  .49759111
     sigma_e |   .8474977
         rho |   .2563515   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     21,343
Group variable: id                              Number of groups  =      1,495

R-sq:                                           Obs per group:
     within  = 0.1009                                         min =          1
     between = 0.1050                                         avg =       14.3
     overall = 0.1098                                         max =         25

                                                F(59,1494)        =       7.94
corr(u_i, Xb)  = -0.0147                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,495 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |  -.0189021   .0380644    -0.50   0.620    -.0935675    .0557633
         new |  -.0303844    .040597    -0.75   0.454    -.1100177    .0492488
        fnew |   .0021414   .0507006     0.04   0.966    -.0973106    .1015933
  fnew_expat |   .0185598    .055651     0.33   0.739    -.0906026    .1277223
  fold_expat |  -.0035397   .0744465    -0.05   0.962    -.1495705     .142491
             |
    ind_year |
          2  |  -.1276358   .0652706    -1.96   0.051    -.2556675    .0003959
          3  |  -.2678709   .0769217    -3.48   0.001     -.418757   -.1169848
          4  |  -.3188582   .0804428    -3.96   0.000     -.476651   -.1610654
          5  |  -.3668881   .0889893    -4.12   0.000    -.5414454   -.1923308
          6  |  -.4757037   .0966654    -4.92   0.000    -.6653181   -.2860893
          7  |  -.5608385   .1027906    -5.46   0.000    -.7624677   -.3592092
          8  |  -.5929428   .1062063    -5.58   0.000    -.8012722   -.3846135
          9  |  -.6579491   .1128572    -5.83   0.000    -.8793245   -.4365737
         10  |  -.6944505   .1177113    -5.90   0.000    -.9253475   -.4635534
         11  |  -.7712755   .1208815    -6.38   0.000    -1.008391   -.5341599
         12  |  -.7858167   .1246855    -6.30   0.000    -1.030394   -.5412395
         13  |   -.801542   .1287942    -6.22   0.000    -1.054179   -.5489054
         14  |   -.828919   .1335258    -6.21   0.000    -1.090837    -.567001
         15  |  -.7997802   .1356516    -5.90   0.000    -1.065868   -.5336925
         16  |  -.7527173   .1384997    -5.43   0.000    -1.024392   -.4810428
         17  |  -.7594787   .1436381    -5.29   0.000    -1.041233    -.477725
         18  |   -.819135   .1447542    -5.66   0.000    -1.103078   -.5351918
         19  |  -.7763263   .1463358    -5.31   0.000    -1.063372   -.4892809
         20  |  -.8232822   .1484914    -5.54   0.000    -1.114556   -.5320085
         21  |  -.9075493   .1516505    -5.98   0.000     -1.20502   -.6100788
         22  |  -.9518415   .1520212    -6.26   0.000    -1.250039   -.6536439
         23  |  -.9430787    .156205    -6.04   0.000    -1.249483   -.6366742
         24  |  -.9743419   .1581856    -6.16   0.000    -1.284631   -.6640524
         25  |  -.9877155   .1589671    -6.21   0.000    -1.299538    -.675893
         26  |   .8226624   .1907459     4.31   0.000     .4485042    1.196821
         27  |   .6310668   .1822843     3.46   0.001     .2735065    .9886271
         28  |   .5689062   .1752731     3.25   0.001     .2250988    .9127136
         29  |   .4223724   .1780199     2.37   0.018     .0731769    .7715679
         30  |   .3488028   .1766873     1.97   0.049     .0022213    .6953842
         31  |   .2409075    .177262     1.36   0.174    -.1068013    .5886163
         32  |   .1564628   .1743442     0.90   0.370    -.1855226    .4984481
         33  |   .0441514   .1727456     0.26   0.798    -.2946982     .383001
         34  |   .0067879   .1735555     0.04   0.969    -.3336504    .3472262
         35  |  -.0855722   .1748098    -0.49   0.625     -.428471    .2573265
         36  |  -.1421823   .1759438    -0.81   0.419    -.4873054    .2029408
         37  |  -.2638397   .1767771    -1.49   0.136    -.6105974    .0829179
         38  |  -.3035794     .17678    -1.72   0.086    -.6503427    .0431839
         39  |  -.3244942   .1778577    -1.82   0.068    -.6733715    .0243832
         40  |  -.3522724   .1762774    -2.00   0.046    -.6980499   -.0064949
         41  |  -.3868105   .1784785    -2.17   0.030    -.7369056   -.0367155
         42  |  -.4406513   .1837151    -2.40   0.017    -.8010182   -.0802844
         43  |  -.5187085   .1866793    -2.78   0.006    -.8848899   -.1525271
         44  |  -.5721673   .1897666    -3.02   0.003    -.9444045   -.1999301
         45  |  -.5954402   .1915236    -3.11   0.002    -.9711239   -.2197564
         46  |  -.5653511   .1937031    -2.92   0.004      -.94531   -.1853921
         47  |  -.5522903   .1969585    -2.80   0.005    -.9386348   -.1659458
         48  |  -.5183851   .1958107    -2.65   0.008    -.9024781    -.134292
         49  |  -.5003812   .1988228    -2.52   0.012    -.8903826   -.1103797
         50  |  -.5030554   .2006399    -2.51   0.012    -.8966213   -.1094895
             |
     age_cat |
          2  |   .4306297   .0507723     8.48   0.000     .3310371    .5302223
          3  |   .7203312   .0595926    12.09   0.000      .603437    .8372253
          4  |   1.100556   .0709496    15.51   0.000     .9613843    1.239727
          5  |   1.461256   .0873382    16.73   0.000     1.289937    1.632574
          6  |   1.735844   .1060279    16.37   0.000     1.527864    1.943823
             |
       _cons |   3.127064   .1078249    29.00   0.000      2.91556    3.338568
-------------+----------------------------------------------------------------
     sigma_u |  1.0286707
     sigma_e |  .85831733
         rho |  .58954812   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1008725654384387

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     21,343
Group variable: id                              Number of groups  =      1,495

R-sq:                                           Obs per group:
     within  = 0.1009                                         min =          1
     between = 0.1050                                         avg =       14.3
     overall = 0.1098                                         max =         25

                                                F(59,1494)        =       7.94
corr(u_i, Xb)  = -0.0147                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,495 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |  -.0189021   .0380644    -0.50   0.620    -.0935675    .0557633
         new |  -.0303844    .040597    -0.75   0.454    -.1100177    .0492488
        fnew |   .0021414   .0507006     0.04   0.966    -.0973106    .1015933
  fnew_expat |   .0185598    .055651     0.33   0.739    -.0906026    .1277223
  fold_expat |  -.0035397   .0744465    -0.05   0.962    -.1495705     .142491
             |
    ind_year |
          2  |  -.1276358   .0652706    -1.96   0.051    -.2556675    .0003959
          3  |  -.2678709   .0769217    -3.48   0.001     -.418757   -.1169848
          4  |  -.3188582   .0804428    -3.96   0.000     -.476651   -.1610654
          5  |  -.3668881   .0889893    -4.12   0.000    -.5414454   -.1923308
          6  |  -.4757037   .0966654    -4.92   0.000    -.6653181   -.2860893
          7  |  -.5608385   .1027906    -5.46   0.000    -.7624677   -.3592092
          8  |  -.5929428   .1062063    -5.58   0.000    -.8012722   -.3846135
          9  |  -.6579491   .1128572    -5.83   0.000    -.8793245   -.4365737
         10  |  -.6944505   .1177113    -5.90   0.000    -.9253475   -.4635534
         11  |  -.7712755   .1208815    -6.38   0.000    -1.008391   -.5341599
         12  |  -.7858167   .1246855    -6.30   0.000    -1.030394   -.5412395
         13  |   -.801542   .1287942    -6.22   0.000    -1.054179   -.5489054
         14  |   -.828919   .1335258    -6.21   0.000    -1.090837    -.567001
         15  |  -.7997802   .1356516    -5.90   0.000    -1.065868   -.5336925
         16  |  -.7527173   .1384997    -5.43   0.000    -1.024392   -.4810428
         17  |  -.7594787   .1436381    -5.29   0.000    -1.041233    -.477725
         18  |   -.819135   .1447542    -5.66   0.000    -1.103078   -.5351918
         19  |  -.7763263   .1463358    -5.31   0.000    -1.063372   -.4892809
         20  |  -.8232822   .1484914    -5.54   0.000    -1.114556   -.5320085
         21  |  -.9075493   .1516505    -5.98   0.000     -1.20502   -.6100788
         22  |  -.9518415   .1520212    -6.26   0.000    -1.250039   -.6536439
         23  |  -.9430787    .156205    -6.04   0.000    -1.249483   -.6366742
         24  |  -.9743419   .1581856    -6.16   0.000    -1.284631   -.6640524
         25  |  -.9877155   .1589671    -6.21   0.000    -1.299538    -.675893
         26  |   .8226624   .1907459     4.31   0.000     .4485042    1.196821
         27  |   .6310668   .1822843     3.46   0.001     .2735065    .9886271
         28  |   .5689062   .1752731     3.25   0.001     .2250988    .9127136
         29  |   .4223724   .1780199     2.37   0.018     .0731769    .7715679
         30  |   .3488028   .1766873     1.97   0.049     .0022213    .6953842
         31  |   .2409075    .177262     1.36   0.174    -.1068013    .5886163
         32  |   .1564628   .1743442     0.90   0.370    -.1855226    .4984481
         33  |   .0441514   .1727456     0.26   0.798    -.2946982     .383001
         34  |   .0067879   .1735555     0.04   0.969    -.3336504    .3472262
         35  |  -.0855722   .1748098    -0.49   0.625     -.428471    .2573265
         36  |  -.1421823   .1759438    -0.81   0.419    -.4873054    .2029408
         37  |  -.2638397   .1767771    -1.49   0.136    -.6105974    .0829179
         38  |  -.3035794     .17678    -1.72   0.086    -.6503427    .0431839
         39  |  -.3244942   .1778577    -1.82   0.068    -.6733715    .0243832
         40  |  -.3522724   .1762774    -2.00   0.046    -.6980499   -.0064949
         41  |  -.3868105   .1784785    -2.17   0.030    -.7369056   -.0367155
         42  |  -.4406513   .1837151    -2.40   0.017    -.8010182   -.0802844
         43  |  -.5187085   .1866793    -2.78   0.006    -.8848899   -.1525271
         44  |  -.5721673   .1897666    -3.02   0.003    -.9444045   -.1999301
         45  |  -.5954402   .1915236    -3.11   0.002    -.9711239   -.2197564
         46  |  -.5653511   .1937031    -2.92   0.004      -.94531   -.1853921
         47  |  -.5522903   .1969585    -2.80   0.005    -.9386348   -.1659458
         48  |  -.5183851   .1958107    -2.65   0.008    -.9024781    -.134292
         49  |  -.5003812   .1988228    -2.52   0.012    -.8903826   -.1103797
         50  |  -.5030554   .2006399    -2.51   0.012    -.8966213   -.1094895
             |
     age_cat |
          2  |   .4306297   .0507723     8.48   0.000     .3310371    .5302223
          3  |   .7203312   .0595926    12.09   0.000      .603437    .8372253
          4  |   1.100556   .0709496    15.51   0.000     .9613843    1.239727
          5  |   1.461256   .0873382    16.73   0.000     1.289937    1.632574
          6  |   1.735844   .1060279    16.37   0.000     1.527864    1.943823
             |
       _cons |   3.127064   .1078249    29.00   0.000      2.91556    3.338568
-------------+----------------------------------------------------------------
     sigma_u |  1.0286707
     sigma_e |  .85831733
         rho |  .58954812   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     21,343
Group variable: id                              Number of groups  =      1,495

R-sq:                                           Obs per group:
     within  = 0.2931                                         min =          1
     between = 0.0858                                         avg =       14.3
     overall = 0.1458                                         max =         25

                                                F(59,1494)        =      32.47
corr(u_i, Xb)  = 0.0187                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,495 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnQ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0329266   .0420004     0.78   0.433    -.0494594    .1153126
         new |  -.0459037   .0456707    -1.01   0.315    -.1354892    .0436819
        fnew |    .036946   .0580459     0.64   0.525    -.0769141    .1508062
  fnew_expat |   .1418022   .0629117     2.25   0.024     .0183977    .2652068
  fold_expat |   .1412405   .0785988     1.80   0.073    -.0129353    .2954163
             |
    ind_year |
          2  |   .0042738   .0783481     0.05   0.957    -.1494102    .1579578
          3  |   .0940475   .0892214     1.05   0.292    -.0809651      .26906
          4  |   .2305267   .0936636     2.46   0.014     .0468007    .4142528
          5  |   .3888508   .0982383     3.96   0.000     .1961512    .5815504
          6  |   .4747757   .1066326     4.45   0.000     .2656101    .6839413
          7  |   .5342347   .1143303     4.67   0.000     .3099696    .7584997
          8  |   .6039184   .1209918     4.99   0.000     .3665865    .8412503
          9  |   .6596368    .127745     5.16   0.000     .4090583    .9102154
         10  |   .7336054     .13074     5.61   0.000     .4771519    .9900589
         11  |   .7661007   .1346636     5.69   0.000     .5019509    1.030251
         12  |   .8437963   .1377224     6.13   0.000     .5736466    1.113946
         13  |    .898807   .1425371     6.31   0.000     .6192129    1.178401
         14  |    .910487   .1497054     6.08   0.000     .6168318    1.204142
         15  |   .9580806   .1520809     6.30   0.000     .6597659    1.256395
         16  |   1.008682   .1584042     6.37   0.000     .6979633      1.3194
         17  |   1.055486    .165221     6.39   0.000     .7313968    1.379576
         18  |   .8934843   .1707568     5.23   0.000     .5585358    1.228433
         19  |   .9897479   .1736693     5.70   0.000     .6490863    1.330409
         20  |   .9770011   .1740052     5.61   0.000     .6356807    1.318321
         21  |    .880832   .1792854     4.91   0.000     .5291542     1.23251
         22  |   .9364023   .1785974     5.24   0.000     .5860739    1.286731
         23  |   .9929992   .1898576     5.23   0.000     .6205834    1.365415
         24  |   .9693074   .1897245     5.11   0.000     .5971528    1.341462
         25  |   .9687665   .1914506     5.06   0.000     .5932259    1.344307
         26  |   .3238412   .2110869     1.53   0.125    -.0902171    .7378994
         27  |   .3450707   .1989994     1.73   0.083    -.0452772    .7354186
         28  |   .4931302   .1892332     2.61   0.009     .1219391    .8643212
         29  |   .6518732   .1844556     3.53   0.000     .2900538    1.013693
         30  |   .7755378   .1816247     4.27   0.000     .4192713    1.131804
         31  |   .8664889   .1814439     4.78   0.000     .5105771    1.222401
         32  |   .9757698   .1799256     5.42   0.000     .6228361    1.328704
         33  |   .9765608   .1781981     5.48   0.000     .6270157    1.326106
         34  |   1.099255   .1777542     6.18   0.000     .7505805    1.447929
         35  |   1.099542   .1802703     6.10   0.000     .7459326    1.453152
         36  |   1.086938   .1827589     5.95   0.000     .7284465    1.445429
         37  |    1.07889   .1844286     5.85   0.000     .7171232    1.440656
         38  |   1.087799   .1893271     5.75   0.000     .7164238    1.459174
         39  |   1.141515   .1893287     6.03   0.000     .7701362    1.512893
         40  |   1.275814   .1873022     6.81   0.000     .9084107    1.643217
         41  |   1.322141   .1888129     7.00   0.000     .9517748    1.692508
         42  |   1.291139   .1960224     6.59   0.000     .9066309    1.675648
         43  |   1.212529   .1946946     6.23   0.000     .8306252    1.594433
         44  |   1.201265   .2021371     5.94   0.000     .8047625    1.597768
         45  |   1.332115   .2016617     6.61   0.000     .9365453    1.727685
         46  |   1.333098   .2058815     6.48   0.000     .9292501    1.736945
         47  |   1.386474   .2113502     6.56   0.000     .9718995    1.801049
         48  |   1.467586   .2127464     6.90   0.000     1.050272    1.884899
         49  |   1.536906    .214057     7.18   0.000     1.117021     1.95679
         50  |   1.496887   .2230904     6.71   0.000     1.059283    1.934491
             |
     age_cat |
          2  |   1.153932   .0692031    16.67   0.000     1.018186    1.289677
          3  |   1.466375   .0759551    19.31   0.000     1.317385    1.615365
          4  |   1.857639   .0886811    20.95   0.000     1.683687    2.031592
          5  |   2.186418   .1070874    20.42   0.000     1.976361    2.396476
          6  |   2.416538   .1347053    17.94   0.000     2.152306     2.68077
             |
       _cons |   10.46532    .120748    86.67   0.000     10.22847    10.70217
-------------+----------------------------------------------------------------
     sigma_u |  1.4851505
     sigma_e |  1.0268115
         rho |  .67658365   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2931025743778689

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     21,343
Group variable: id                              Number of groups  =      1,495

R-sq:                                           Obs per group:
     within  = 0.2931                                         min =          1
     between = 0.0858                                         avg =       14.3
     overall = 0.1458                                         max =         25

                                                F(59,1494)        =      32.47
corr(u_i, Xb)  = 0.0187                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,495 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnQ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0329266   .0420004     0.78   0.433    -.0494594    .1153126
         new |  -.0459037   .0456707    -1.01   0.315    -.1354892    .0436819
        fnew |    .036946   .0580459     0.64   0.525    -.0769141    .1508062
  fnew_expat |   .1418022   .0629117     2.25   0.024     .0183977    .2652068
  fold_expat |   .1412405   .0785988     1.80   0.073    -.0129353    .2954163
             |
    ind_year |
          2  |   .0042738   .0783481     0.05   0.957    -.1494102    .1579578
          3  |   .0940475   .0892214     1.05   0.292    -.0809651      .26906
          4  |   .2305267   .0936636     2.46   0.014     .0468007    .4142528
          5  |   .3888508   .0982383     3.96   0.000     .1961512    .5815504
          6  |   .4747757   .1066326     4.45   0.000     .2656101    .6839413
          7  |   .5342347   .1143303     4.67   0.000     .3099696    .7584997
          8  |   .6039184   .1209918     4.99   0.000     .3665865    .8412503
          9  |   .6596368    .127745     5.16   0.000     .4090583    .9102154
         10  |   .7336054     .13074     5.61   0.000     .4771519    .9900589
         11  |   .7661007   .1346636     5.69   0.000     .5019509    1.030251
         12  |   .8437963   .1377224     6.13   0.000     .5736466    1.113946
         13  |    .898807   .1425371     6.31   0.000     .6192129    1.178401
         14  |    .910487   .1497054     6.08   0.000     .6168318    1.204142
         15  |   .9580806   .1520809     6.30   0.000     .6597659    1.256395
         16  |   1.008682   .1584042     6.37   0.000     .6979633      1.3194
         17  |   1.055486    .165221     6.39   0.000     .7313968    1.379576
         18  |   .8934843   .1707568     5.23   0.000     .5585358    1.228433
         19  |   .9897479   .1736693     5.70   0.000     .6490863    1.330409
         20  |   .9770011   .1740052     5.61   0.000     .6356807    1.318321
         21  |    .880832   .1792854     4.91   0.000     .5291542     1.23251
         22  |   .9364023   .1785974     5.24   0.000     .5860739    1.286731
         23  |   .9929992   .1898576     5.23   0.000     .6205834    1.365415
         24  |   .9693074   .1897245     5.11   0.000     .5971528    1.341462
         25  |   .9687665   .1914506     5.06   0.000     .5932259    1.344307
         26  |   .3238412   .2110869     1.53   0.125    -.0902171    .7378994
         27  |   .3450707   .1989994     1.73   0.083    -.0452772    .7354186
         28  |   .4931302   .1892332     2.61   0.009     .1219391    .8643212
         29  |   .6518732   .1844556     3.53   0.000     .2900538    1.013693
         30  |   .7755378   .1816247     4.27   0.000     .4192713    1.131804
         31  |   .8664889   .1814439     4.78   0.000     .5105771    1.222401
         32  |   .9757698   .1799256     5.42   0.000     .6228361    1.328704
         33  |   .9765608   .1781981     5.48   0.000     .6270157    1.326106
         34  |   1.099255   .1777542     6.18   0.000     .7505805    1.447929
         35  |   1.099542   .1802703     6.10   0.000     .7459326    1.453152
         36  |   1.086938   .1827589     5.95   0.000     .7284465    1.445429
         37  |    1.07889   .1844286     5.85   0.000     .7171232    1.440656
         38  |   1.087799   .1893271     5.75   0.000     .7164238    1.459174
         39  |   1.141515   .1893287     6.03   0.000     .7701362    1.512893
         40  |   1.275814   .1873022     6.81   0.000     .9084107    1.643217
         41  |   1.322141   .1888129     7.00   0.000     .9517748    1.692508
         42  |   1.291139   .1960224     6.59   0.000     .9066309    1.675648
         43  |   1.212529   .1946946     6.23   0.000     .8306252    1.594433
         44  |   1.201265   .2021371     5.94   0.000     .8047625    1.597768
         45  |   1.332115   .2016617     6.61   0.000     .9365453    1.727685
         46  |   1.333098   .2058815     6.48   0.000     .9292501    1.736945
         47  |   1.386474   .2113502     6.56   0.000     .9718995    1.801049
         48  |   1.467586   .2127464     6.90   0.000     1.050272    1.884899
         49  |   1.536906    .214057     7.18   0.000     1.117021     1.95679
         50  |   1.496887   .2230904     6.71   0.000     1.059283    1.934491
             |
     age_cat |
          2  |   1.153932   .0692031    16.67   0.000     1.018186    1.289677
          3  |   1.466375   .0759551    19.31   0.000     1.317385    1.615365
          4  |   1.857639   .0886811    20.95   0.000     1.683687    2.031592
          5  |   2.186418   .1070874    20.42   0.000     1.976361    2.396476
          6  |   2.416538   .1347053    17.94   0.000     2.152306     2.68077
             |
       _cons |   10.46532    .120748    86.67   0.000     10.22847    10.70217
-------------+----------------------------------------------------------------
     sigma_u |  1.4851505
     sigma_e |  1.0268115
         rho |  .67658365   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     19,550
Group variable: id                              Number of groups  =      1,460

R-sq:                                           Obs per group:
     within  = 0.1938                                         min =          1
     between = 0.1443                                         avg =       13.4
     overall = 0.1278                                         max =         25

                                                F(59,1459)        =      14.72
corr(u_i, Xb)  = 0.0859                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,460 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnK |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0896738    .054131     1.66   0.098    -.0165091    .1958567
         new |  -.0885498   .0522428    -1.69   0.090    -.1910289    .0139293
        fnew |  -.0235907   .0671987    -0.35   0.726     -.155407    .1082256
  fnew_expat |   .0980941    .070211     1.40   0.163    -.0396312    .2358194
  fold_expat |   .0465756   .0928977     0.50   0.616    -.1356517    .2288029
             |
    ind_year |
          2  |   .0638918   .1081228     0.59   0.555    -.1482009    .2759846
          3  |   .5312552   .1252467     4.24   0.000     .2855723     .776938
          4  |   .6158191   .1344255     4.58   0.000     .3521312    .8795069
          5  |   .8349344   .1396414     5.98   0.000      .561015    1.108854
          6  |   .9215644   .1499069     6.15   0.000     .6275084     1.21562
          7  |    1.08302   .1623807     6.67   0.000     .7644953    1.401544
          8  |   1.236329   .1660423     7.45   0.000     .9106221    1.562036
          9  |   1.298107    .171792     7.56   0.000     .9611211    1.635092
         10  |   1.384534   .1756118     7.88   0.000     1.040055    1.729012
         11  |   1.476773   .1795856     8.22   0.000     1.124499    1.829046
         12  |    1.45034   .1857576     7.81   0.000      1.08596    1.814721
         13  |   1.522206   .1888044     8.06   0.000     1.151849    1.892564
         14  |    1.54532   .1932376     8.00   0.000     1.166266    1.924373
         15  |   1.503758    .196019     7.67   0.000     1.119249    1.888267
         16  |   1.555037   .1995844     7.79   0.000     1.163534     1.94654
         17  |   1.629501   .2042558     7.98   0.000     1.228835    2.030167
         18  |    1.57288   .2091635     7.52   0.000     1.162587    1.983174
         19  |   1.519287    .211026     7.20   0.000      1.10534    1.933234
         20  |   1.453913   .2150135     6.76   0.000     1.032144    1.875681
         21  |   1.402194   .2160334     6.49   0.000     .9784252    1.825964
         22  |   1.341632   .2240149     5.99   0.000     .9022059    1.781057
         23  |   1.389487   .2281742     6.09   0.000     .9419021    1.837071
         24  |   .9299402   .2428814     3.83   0.000     .4535061    1.406374
         25  |   .9611151   .2618439     3.67   0.000     .4474844    1.474746
         26  |   1.543955   .2508329     6.16   0.000     1.051923    2.035986
         27  |    1.35206   .2451896     5.51   0.000     .8710981    1.833022
         28  |    1.45018   .2276687     6.37   0.000     1.003587    1.896773
         29  |   1.448783    .228776     6.33   0.000     1.000018    1.897548
         30  |     1.5285   .2283438     6.69   0.000     1.080583    1.976417
         31  |   1.583135   .2269317     6.98   0.000     1.137988    2.028282
         32  |   1.705161   .2226536     7.66   0.000     1.268405    2.141916
         33  |   1.754998   .2229667     7.87   0.000     1.317629    2.192367
         34  |   1.792265   .2237333     8.01   0.000     1.353392    2.231139
         35  |   1.823975   .2259449     8.07   0.000     1.380763    2.267186
         36  |   1.813532   .2284377     7.94   0.000     1.365431    2.261634
         37  |   1.841671   .2309823     7.97   0.000     1.388579    2.294764
         38  |   1.884657   .2340317     8.05   0.000     1.425583    2.343732
         39  |   1.911724   .2346185     8.15   0.000     1.451499     2.37195
         40  |   1.900388   .2392635     7.94   0.000     1.431051    2.369725
         41  |   1.913037   .2432027     7.87   0.000     1.435973    2.390102
         42  |   1.988973   .2418945     8.22   0.000     1.514475    2.463472
         43  |   1.946248   .2448036     7.95   0.000     1.466044    2.426453
         44  |   1.877791   .2485471     7.56   0.000     1.390244    2.365339
         45  |   1.909486   .2485187     7.68   0.000     1.421994    2.396978
         46  |   1.883587   .2504017     7.52   0.000     1.392401    2.374773
         47  |   1.909488   .2553961     7.48   0.000     1.408505    2.410471
         48  |   1.938592   .2552951     7.59   0.000     1.437808    2.439377
         49  |   1.943174   .2575069     7.55   0.000     1.438051    2.448297
         50  |    1.99768   .2744085     7.28   0.000     1.459403    2.535957
             |
     age_cat |
          2  |   .4219016   .0839605     5.03   0.000     .2572054    .5865977
          3  |   .7608999   .0946492     8.04   0.000     .5752368    .9465629
          4  |   1.094823   .1080071    10.14   0.000     .8829573    1.306689
          5  |    1.38519   .1274773    10.87   0.000     1.135131    1.635248
          6  |   1.584837   .1500184    10.56   0.000     1.290562    1.879112
             |
       _cons |   8.005255   .1646652    48.62   0.000      7.68225    8.328261
-------------+----------------------------------------------------------------
     sigma_u |  1.9378482
     sigma_e |  1.1671333
         rho |  .73381302   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1937953413580037

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     19,550
Group variable: id                              Number of groups  =      1,460

R-sq:                                           Obs per group:
     within  = 0.1938                                         min =          1
     between = 0.1443                                         avg =       13.4
     overall = 0.1278                                         max =         25

                                                F(59,1459)        =      14.72
corr(u_i, Xb)  = 0.0859                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,460 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnK |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0896738    .054131     1.66   0.098    -.0165091    .1958567
         new |  -.0885498   .0522428    -1.69   0.090    -.1910289    .0139293
        fnew |  -.0235907   .0671987    -0.35   0.726     -.155407    .1082256
  fnew_expat |   .0980941    .070211     1.40   0.163    -.0396312    .2358194
  fold_expat |   .0465756   .0928977     0.50   0.616    -.1356517    .2288029
             |
    ind_year |
          2  |   .0638918   .1081228     0.59   0.555    -.1482009    .2759846
          3  |   .5312552   .1252467     4.24   0.000     .2855723     .776938
          4  |   .6158191   .1344255     4.58   0.000     .3521312    .8795069
          5  |   .8349344   .1396414     5.98   0.000      .561015    1.108854
          6  |   .9215644   .1499069     6.15   0.000     .6275084     1.21562
          7  |    1.08302   .1623807     6.67   0.000     .7644953    1.401544
          8  |   1.236329   .1660423     7.45   0.000     .9106221    1.562036
          9  |   1.298107    .171792     7.56   0.000     .9611211    1.635092
         10  |   1.384534   .1756118     7.88   0.000     1.040055    1.729012
         11  |   1.476773   .1795856     8.22   0.000     1.124499    1.829046
         12  |    1.45034   .1857576     7.81   0.000      1.08596    1.814721
         13  |   1.522206   .1888044     8.06   0.000     1.151849    1.892564
         14  |    1.54532   .1932376     8.00   0.000     1.166266    1.924373
         15  |   1.503758    .196019     7.67   0.000     1.119249    1.888267
         16  |   1.555037   .1995844     7.79   0.000     1.163534     1.94654
         17  |   1.629501   .2042558     7.98   0.000     1.228835    2.030167
         18  |    1.57288   .2091635     7.52   0.000     1.162587    1.983174
         19  |   1.519287    .211026     7.20   0.000      1.10534    1.933234
         20  |   1.453913   .2150135     6.76   0.000     1.032144    1.875681
         21  |   1.402194   .2160334     6.49   0.000     .9784252    1.825964
         22  |   1.341632   .2240149     5.99   0.000     .9022059    1.781057
         23  |   1.389487   .2281742     6.09   0.000     .9419021    1.837071
         24  |   .9299402   .2428814     3.83   0.000     .4535061    1.406374
         25  |   .9611151   .2618439     3.67   0.000     .4474844    1.474746
         26  |   1.543955   .2508329     6.16   0.000     1.051923    2.035986
         27  |    1.35206   .2451896     5.51   0.000     .8710981    1.833022
         28  |    1.45018   .2276687     6.37   0.000     1.003587    1.896773
         29  |   1.448783    .228776     6.33   0.000     1.000018    1.897548
         30  |     1.5285   .2283438     6.69   0.000     1.080583    1.976417
         31  |   1.583135   .2269317     6.98   0.000     1.137988    2.028282
         32  |   1.705161   .2226536     7.66   0.000     1.268405    2.141916
         33  |   1.754998   .2229667     7.87   0.000     1.317629    2.192367
         34  |   1.792265   .2237333     8.01   0.000     1.353392    2.231139
         35  |   1.823975   .2259449     8.07   0.000     1.380763    2.267186
         36  |   1.813532   .2284377     7.94   0.000     1.365431    2.261634
         37  |   1.841671   .2309823     7.97   0.000     1.388579    2.294764
         38  |   1.884657   .2340317     8.05   0.000     1.425583    2.343732
         39  |   1.911724   .2346185     8.15   0.000     1.451499     2.37195
         40  |   1.900388   .2392635     7.94   0.000     1.431051    2.369725
         41  |   1.913037   .2432027     7.87   0.000     1.435973    2.390102
         42  |   1.988973   .2418945     8.22   0.000     1.514475    2.463472
         43  |   1.946248   .2448036     7.95   0.000     1.466044    2.426453
         44  |   1.877791   .2485471     7.56   0.000     1.390244    2.365339
         45  |   1.909486   .2485187     7.68   0.000     1.421994    2.396978
         46  |   1.883587   .2504017     7.52   0.000     1.392401    2.374773
         47  |   1.909488   .2553961     7.48   0.000     1.408505    2.410471
         48  |   1.938592   .2552951     7.59   0.000     1.437808    2.439377
         49  |   1.943174   .2575069     7.55   0.000     1.438051    2.448297
         50  |    1.99768   .2744085     7.28   0.000     1.459403    2.535957
             |
     age_cat |
          2  |   .4219016   .0839605     5.03   0.000     .2572054    .5865977
          3  |   .7608999   .0946492     8.04   0.000     .5752368    .9465629
          4  |   1.094823   .1080071    10.14   0.000     .8829573    1.306689
          5  |    1.38519   .1274773    10.87   0.000     1.135131    1.635248
          6  |   1.584837   .1500184    10.56   0.000     1.290562    1.879112
             |
       _cons |   8.005255   .1646652    48.62   0.000      7.68225    8.328261
-------------+----------------------------------------------------------------
     sigma_u |  1.9378482
     sigma_e |  1.1671333
         rho |  .73381302   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     21,343
Group variable: id                              Number of groups  =      1,495

R-sq:                                           Obs per group:
     within  = 0.3721                                         min =          1
     between = 0.0867                                         avg =       14.3
     overall = 0.2012                                         max =         25

                                                F(59,1494)        =      51.72
corr(u_i, Xb)  = -0.0042                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,495 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0518288   .0267361     1.94   0.053    -.0006155     .104273
         new |  -.0155192     .02982    -0.52   0.603    -.0740128    .0429743
        fnew |   .0348047   .0370183     0.94   0.347    -.0378086     .107418
  fnew_expat |   .1232424   .0419363     2.94   0.003     .0409821    .2055027
  fold_expat |   .1447803   .0510182     2.84   0.005     .0447055    .2448551
             |
    ind_year |
          2  |   .1319096   .0622669     2.12   0.034     .0097697    .2540495
          3  |   .3619183   .0685317     5.28   0.000     .2274897    .4963469
          4  |   .5493849   .0718334     7.65   0.000     .4084798      .69029
          5  |   .7557389   .0737198    10.25   0.000     .6111335    .9003442
          6  |   .9504794   .0776346    12.24   0.000     .7981949    1.102764
          7  |   1.095073   .0822016    13.32   0.000     .9338303    1.256316
          8  |   1.196861    .085206    14.05   0.000     1.029725    1.363997
          9  |   1.317586   .0882129    14.94   0.000     1.144552     1.49062
         10  |   1.428056   .0899677    15.87   0.000      1.25158    1.604532
         11  |   1.537376   .0923565    16.65   0.000     1.356214    1.718538
         12  |   1.629613   .0950617    17.14   0.000     1.443144    1.816082
         13  |   1.700349   .0970556    17.52   0.000     1.509969    1.890729
         14  |   1.739406   .1005263    17.30   0.000     1.542218    1.936594
         15  |   1.757861   .1019439    17.24   0.000     1.557892    1.957829
         16  |   1.761399   .1070977    16.45   0.000     1.551321    1.971477
         17  |   1.814965   .1093888    16.59   0.000     1.600393    2.029537
         18  |   1.712619   .1107116    15.47   0.000     1.495452    1.929786
         19  |   1.766074   .1135635    15.55   0.000     1.543313    1.988835
         20  |   1.800283    .113969    15.80   0.000     1.576727     2.02384
         21  |   1.788381   .1189699    15.03   0.000     1.555015    2.021747
         22  |   1.888244   .1169468    16.15   0.000     1.658846    2.117641
         23  |   1.936078   .1220244    15.87   0.000      1.69672    2.175435
         24  |   1.943649   .1237834    15.70   0.000     1.700842    2.186457
         25  |   1.956482   .1220563    16.03   0.000     1.717062    2.195902
         26  |  -.4988212   .1194308    -4.18   0.000     -.733091   -.2645514
         27  |  -.2859961   .1201437    -2.38   0.017    -.5216643   -.0503278
         28  |  -.0757761   .1177046    -0.64   0.520    -.3066598    .1551077
         29  |   .2295007   .1124345     2.04   0.041     .0089545    .4500469
         30  |    .426735   .1134995     3.76   0.000     .2040996    .6493703
         31  |   .6255814   .1134981     5.51   0.000     .4029489    .8482139
         32  |    .819307   .1178533     6.95   0.000     .5881315    1.050483
         33  |   .9324094   .1157918     8.05   0.000     .7052777    1.159541
         34  |   1.092467   .1165755     9.37   0.000     .8637978    1.321136
         35  |   1.185115   .1168587    10.14   0.000     .9558902    1.414339
         36  |    1.22912   .1185292    10.37   0.000     .9966188    1.461621
         37  |   1.342729   .1210307    11.09   0.000     1.105321    1.580137
         38  |   1.391378   .1211689    11.48   0.000     1.153699    1.629058
         39  |   1.466009   .1213882    12.08   0.000     1.227899    1.704118
         40  |   1.628086   .1211909    13.43   0.000     1.390364    1.865809
         41  |   1.708952    .121318    14.09   0.000      1.47098    1.946923
         42  |    1.73179   .1273962    13.59   0.000     1.481896    1.981685
         43  |   1.731237   .1255987    13.78   0.000     1.484869    1.977606
         44  |   1.773432   .1282672    13.83   0.000      1.52183    2.025035
         45  |   1.927556   .1259267    15.31   0.000     1.680544    2.174567
         46  |   1.898449   .1271023    14.94   0.000     1.649131    2.147767
         47  |   1.938765   .1293054    14.99   0.000     1.685125    2.192404
         48  |   1.985971   .1301713    15.26   0.000     1.730633    2.241309
         49  |   2.037287   .1305763    15.60   0.000     1.781155    2.293419
         50  |   1.999942   .1323612    15.11   0.000     1.740309    2.259576
             |
     age_cat |
          2  |   .7233018   .0550445    13.14   0.000     .6153291    .8312745
          3  |   .7460435   .0583681    12.78   0.000     .6315514    .8605356
          4  |   .7570836   .0641127    11.81   0.000     .6313232     .882844
          5  |   .7251629   .0732467     9.90   0.000     .5814856    .8688401
          6  |   .6806944   .0885585     7.69   0.000     .5069822    .8544066
             |
       _cons |   7.338257   .0884526    82.96   0.000     7.164753    7.511762
-------------+----------------------------------------------------------------
     sigma_u |  1.1251256
     sigma_e |  .71834693
         rho |  .71041379   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .3721258103597594

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     21,343
Group variable: id                              Number of groups  =      1,495

R-sq:                                           Obs per group:
     within  = 0.3721                                         min =          1
     between = 0.0867                                         avg =       14.3
     overall = 0.2012                                         max =         25

                                                F(59,1494)        =      51.72
corr(u_i, Xb)  = -0.0042                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,495 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0518288   .0267361     1.94   0.053    -.0006155     .104273
         new |  -.0155192     .02982    -0.52   0.603    -.0740128    .0429743
        fnew |   .0348047   .0370183     0.94   0.347    -.0378086     .107418
  fnew_expat |   .1232424   .0419363     2.94   0.003     .0409821    .2055027
  fold_expat |   .1447803   .0510182     2.84   0.005     .0447055    .2448551
             |
    ind_year |
          2  |   .1319096   .0622669     2.12   0.034     .0097697    .2540495
          3  |   .3619183   .0685317     5.28   0.000     .2274897    .4963469
          4  |   .5493849   .0718334     7.65   0.000     .4084798      .69029
          5  |   .7557389   .0737198    10.25   0.000     .6111335    .9003442
          6  |   .9504794   .0776346    12.24   0.000     .7981949    1.102764
          7  |   1.095073   .0822016    13.32   0.000     .9338303    1.256316
          8  |   1.196861    .085206    14.05   0.000     1.029725    1.363997
          9  |   1.317586   .0882129    14.94   0.000     1.144552     1.49062
         10  |   1.428056   .0899677    15.87   0.000      1.25158    1.604532
         11  |   1.537376   .0923565    16.65   0.000     1.356214    1.718538
         12  |   1.629613   .0950617    17.14   0.000     1.443144    1.816082
         13  |   1.700349   .0970556    17.52   0.000     1.509969    1.890729
         14  |   1.739406   .1005263    17.30   0.000     1.542218    1.936594
         15  |   1.757861   .1019439    17.24   0.000     1.557892    1.957829
         16  |   1.761399   .1070977    16.45   0.000     1.551321    1.971477
         17  |   1.814965   .1093888    16.59   0.000     1.600393    2.029537
         18  |   1.712619   .1107116    15.47   0.000     1.495452    1.929786
         19  |   1.766074   .1135635    15.55   0.000     1.543313    1.988835
         20  |   1.800283    .113969    15.80   0.000     1.576727     2.02384
         21  |   1.788381   .1189699    15.03   0.000     1.555015    2.021747
         22  |   1.888244   .1169468    16.15   0.000     1.658846    2.117641
         23  |   1.936078   .1220244    15.87   0.000      1.69672    2.175435
         24  |   1.943649   .1237834    15.70   0.000     1.700842    2.186457
         25  |   1.956482   .1220563    16.03   0.000     1.717062    2.195902
         26  |  -.4988212   .1194308    -4.18   0.000     -.733091   -.2645514
         27  |  -.2859961   .1201437    -2.38   0.017    -.5216643   -.0503278
         28  |  -.0757761   .1177046    -0.64   0.520    -.3066598    .1551077
         29  |   .2295007   .1124345     2.04   0.041     .0089545    .4500469
         30  |    .426735   .1134995     3.76   0.000     .2040996    .6493703
         31  |   .6255814   .1134981     5.51   0.000     .4029489    .8482139
         32  |    .819307   .1178533     6.95   0.000     .5881315    1.050483
         33  |   .9324094   .1157918     8.05   0.000     .7052777    1.159541
         34  |   1.092467   .1165755     9.37   0.000     .8637978    1.321136
         35  |   1.185115   .1168587    10.14   0.000     .9558902    1.414339
         36  |    1.22912   .1185292    10.37   0.000     .9966188    1.461621
         37  |   1.342729   .1210307    11.09   0.000     1.105321    1.580137
         38  |   1.391378   .1211689    11.48   0.000     1.153699    1.629058
         39  |   1.466009   .1213882    12.08   0.000     1.227899    1.704118
         40  |   1.628086   .1211909    13.43   0.000     1.390364    1.865809
         41  |   1.708952    .121318    14.09   0.000      1.47098    1.946923
         42  |    1.73179   .1273962    13.59   0.000     1.481896    1.981685
         43  |   1.731237   .1255987    13.78   0.000     1.484869    1.977606
         44  |   1.773432   .1282672    13.83   0.000      1.52183    2.025035
         45  |   1.927556   .1259267    15.31   0.000     1.680544    2.174567
         46  |   1.898449   .1271023    14.94   0.000     1.649131    2.147767
         47  |   1.938765   .1293054    14.99   0.000     1.685125    2.192404
         48  |   1.985971   .1301713    15.26   0.000     1.730633    2.241309
         49  |   2.037287   .1305763    15.60   0.000     1.781155    2.293419
         50  |   1.999942   .1323612    15.11   0.000     1.740309    2.259576
             |
     age_cat |
          2  |   .7233018   .0550445    13.14   0.000     .6153291    .8312745
          3  |   .7460435   .0583681    12.78   0.000     .6315514    .8605356
          4  |   .7570836   .0641127    11.81   0.000     .6313232     .882844
          5  |   .7251629   .0732467     9.90   0.000     .5814856    .8688401
          6  |   .6806944   .0885585     7.69   0.000     .5069822    .8544066
             |
       _cons |   7.338257   .0884526    82.96   0.000     7.164753    7.511762
-------------+----------------------------------------------------------------
     sigma_u |  1.1251256
     sigma_e |  .71834693
         rho |  .71041379   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     19,550
Group variable: id                              Number of groups  =      1,460

R-sq:                                           Obs per group:
     within  = 0.1909                                         min =          1
     between = 0.0045                                         avg =       13.4
     overall = 0.0864                                         max =         25

                                                F(59,1459)        =      16.52
corr(u_i, Xb)  = -0.0194                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,460 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0983538     .04463     2.20   0.028      .010808    .1858996
         new |  -.0534199   .0443776    -1.20   0.229    -.1404706    .0336307
        fnew |  -.0138244   .0558318    -0.25   0.804    -.1233435    .0956947
  fnew_expat |   .0908207   .0578022     1.57   0.116    -.0225635     .204205
  fold_expat |   .0943911   .0746457     1.26   0.206    -.0520333    .2408154
             |
    ind_year |
          2  |   .2214314   .0888492     2.49   0.013     .0471456    .3957172
          3  |   .8451691   .1086109     7.78   0.000      .632119    1.058219
          4  |   .9658375   .1152491     8.38   0.000     .7397659    1.191909
          5  |   1.205115   .1189699    10.13   0.000     .9717443    1.438485
          6  |   1.387001   .1257117    11.03   0.000     1.140406    1.633596
          7  |   1.660976   .1344625    12.35   0.000     1.397215    1.924736
          8  |   1.846794   .1364851    13.53   0.000     1.579066    2.114522
          9  |   1.945085    .139661    13.93   0.000     1.671127    2.219043
         10  |   2.073943   .1421549    14.59   0.000     1.795093    2.352793
         11  |   2.239411   .1454418    15.40   0.000     1.954114    2.524708
         12  |   2.228882    .149768    14.88   0.000     1.935099    2.522666
         13  |   2.293152   .1540697    14.88   0.000      1.99093    2.595374
         14  |   2.343987    .156914    14.94   0.000     2.036186    2.651788
         15  |   2.263375   .1593729    14.20   0.000      1.95075    2.575999
         16  |   2.263891   .1614459    14.02   0.000       1.9472    2.580582
         17  |   2.308734   .1646356    14.02   0.000     1.985786    2.631681
         18  |   2.312563   .1668313    13.86   0.000     1.985309    2.639818
         19  |    2.27283   .1666756    13.64   0.000     1.945881     2.59978
         20  |   2.203947   .1699668    12.97   0.000     1.870541    2.537352
         21  |    2.21375   .1731155    12.79   0.000     1.874168    2.553332
         22  |   2.222856   .1781383    12.48   0.000     1.873422    2.572291
         23  |    2.24417   .1812153    12.38   0.000       1.8887     2.59964
         24  |   1.611577   .1985855     8.12   0.000     1.222034    2.001121
         25  |   1.635779   .2244437     7.29   0.000     1.195513    2.076046
         26  |   .7530542   .1878233     4.01   0.000     .3846217    1.121487
         27  |   .8044472   .1796919     4.48   0.000     .4519652    1.156929
         28  |   .9699214   .1720546     5.64   0.000     .6324206    1.307422
         29  |   1.100707   .1745061     6.31   0.000     .7583969    1.443016
         30  |   1.250401   .1782954     7.01   0.000      .900658    1.600143
         31  |   1.391773    .177274     7.85   0.000     1.044034    1.739512
         32  |   1.604373   .1760065     9.12   0.000      1.25912    1.949625
         33  |   1.743902   .1837818     9.49   0.000     1.383398    2.104407
         34  |   1.813712   .1836455     9.88   0.000     1.453474    2.173949
         35  |   1.928102   .1864881    10.34   0.000     1.562289    2.293916
         36  |    1.96404   .1890477    10.39   0.000     1.593206    2.334875
         37  |   2.119517   .1909786    11.10   0.000     1.744896    2.494139
         38  |   2.171661   .1919862    11.31   0.000     1.795062    2.548259
         39  |    2.22405   .1932224    11.51   0.000     1.845026    2.603073
         40  |   2.265145   .1966903    11.52   0.000     1.879319    2.650971
         41  |   2.286645   .1991571    11.48   0.000      1.89598     2.67731
         42  |   2.404697   .1959057    12.27   0.000      2.02041    2.788984
         43  |   2.478406   .1976327    12.54   0.000     2.090731     2.86608
         44  |   2.402463    .199592    12.04   0.000     2.010945    2.793981
         45  |   2.474209   .1994196    12.41   0.000     2.083029    2.865389
         46  |   2.445618   .2006738    12.19   0.000     2.051979    2.839258
         47  |   2.454373   .2037986    12.04   0.000     2.054603    2.854142
         48  |   2.434931   .2060424    11.82   0.000      2.03076    2.839101
         49  |   2.321836   .2020533    11.49   0.000      1.92549    2.718182
         50  |   2.346485   .2134542    10.99   0.000     1.927775    2.765195
             |
     age_cat |
          2  |   .0573335   .0758393     0.76   0.450    -.0914322    .2060993
          3  |    .108757   .0840513     1.29   0.196    -.0561173    .2736313
          4  |   .1135715   .0915238     1.24   0.215    -.0659607    .2931037
          5  |   .0669917   .1063514     0.63   0.529    -.1416262    .2756096
          6  |    .015913   .1253167     0.13   0.899    -.2299073    .2617332
             |
       _cons |   4.702086   .1338721    35.12   0.000     4.439484    4.964688
-------------+----------------------------------------------------------------
     sigma_u |  1.7283482
     sigma_e |  .99604437
         rho |  .75068318   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1909248647922553

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     19,550
Group variable: id                              Number of groups  =      1,460

R-sq:                                           Obs per group:
     within  = 0.1909                                         min =          1
     between = 0.0045                                         avg =       13.4
     overall = 0.0864                                         max =         25

                                                F(59,1459)        =      16.52
corr(u_i, Xb)  = -0.0194                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,460 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0983538     .04463     2.20   0.028      .010808    .1858996
         new |  -.0534199   .0443776    -1.20   0.229    -.1404706    .0336307
        fnew |  -.0138244   .0558318    -0.25   0.804    -.1233435    .0956947
  fnew_expat |   .0908207   .0578022     1.57   0.116    -.0225635     .204205
  fold_expat |   .0943911   .0746457     1.26   0.206    -.0520333    .2408154
             |
    ind_year |
          2  |   .2214314   .0888492     2.49   0.013     .0471456    .3957172
          3  |   .8451691   .1086109     7.78   0.000      .632119    1.058219
          4  |   .9658375   .1152491     8.38   0.000     .7397659    1.191909
          5  |   1.205115   .1189699    10.13   0.000     .9717443    1.438485
          6  |   1.387001   .1257117    11.03   0.000     1.140406    1.633596
          7  |   1.660976   .1344625    12.35   0.000     1.397215    1.924736
          8  |   1.846794   .1364851    13.53   0.000     1.579066    2.114522
          9  |   1.945085    .139661    13.93   0.000     1.671127    2.219043
         10  |   2.073943   .1421549    14.59   0.000     1.795093    2.352793
         11  |   2.239411   .1454418    15.40   0.000     1.954114    2.524708
         12  |   2.228882    .149768    14.88   0.000     1.935099    2.522666
         13  |   2.293152   .1540697    14.88   0.000      1.99093    2.595374
         14  |   2.343987    .156914    14.94   0.000     2.036186    2.651788
         15  |   2.263375   .1593729    14.20   0.000      1.95075    2.575999
         16  |   2.263891   .1614459    14.02   0.000       1.9472    2.580582
         17  |   2.308734   .1646356    14.02   0.000     1.985786    2.631681
         18  |   2.312563   .1668313    13.86   0.000     1.985309    2.639818
         19  |    2.27283   .1666756    13.64   0.000     1.945881     2.59978
         20  |   2.203947   .1699668    12.97   0.000     1.870541    2.537352
         21  |    2.21375   .1731155    12.79   0.000     1.874168    2.553332
         22  |   2.222856   .1781383    12.48   0.000     1.873422    2.572291
         23  |    2.24417   .1812153    12.38   0.000       1.8887     2.59964
         24  |   1.611577   .1985855     8.12   0.000     1.222034    2.001121
         25  |   1.635779   .2244437     7.29   0.000     1.195513    2.076046
         26  |   .7530542   .1878233     4.01   0.000     .3846217    1.121487
         27  |   .8044472   .1796919     4.48   0.000     .4519652    1.156929
         28  |   .9699214   .1720546     5.64   0.000     .6324206    1.307422
         29  |   1.100707   .1745061     6.31   0.000     .7583969    1.443016
         30  |   1.250401   .1782954     7.01   0.000      .900658    1.600143
         31  |   1.391773    .177274     7.85   0.000     1.044034    1.739512
         32  |   1.604373   .1760065     9.12   0.000      1.25912    1.949625
         33  |   1.743902   .1837818     9.49   0.000     1.383398    2.104407
         34  |   1.813712   .1836455     9.88   0.000     1.453474    2.173949
         35  |   1.928102   .1864881    10.34   0.000     1.562289    2.293916
         36  |    1.96404   .1890477    10.39   0.000     1.593206    2.334875
         37  |   2.119517   .1909786    11.10   0.000     1.744896    2.494139
         38  |   2.171661   .1919862    11.31   0.000     1.795062    2.548259
         39  |    2.22405   .1932224    11.51   0.000     1.845026    2.603073
         40  |   2.265145   .1966903    11.52   0.000     1.879319    2.650971
         41  |   2.286645   .1991571    11.48   0.000      1.89598     2.67731
         42  |   2.404697   .1959057    12.27   0.000      2.02041    2.788984
         43  |   2.478406   .1976327    12.54   0.000     2.090731     2.86608
         44  |   2.402463    .199592    12.04   0.000     2.010945    2.793981
         45  |   2.474209   .1994196    12.41   0.000     2.083029    2.865389
         46  |   2.445618   .2006738    12.19   0.000     2.051979    2.839258
         47  |   2.454373   .2037986    12.04   0.000     2.054603    2.854142
         48  |   2.434931   .2060424    11.82   0.000      2.03076    2.839101
         49  |   2.321836   .2020533    11.49   0.000      1.92549    2.718182
         50  |   2.346485   .2134542    10.99   0.000     1.927775    2.765195
             |
     age_cat |
          2  |   .0573335   .0758393     0.76   0.450    -.0914322    .2060993
          3  |    .108757   .0840513     1.29   0.196    -.0561173    .2736313
          4  |   .1135715   .0915238     1.24   0.215    -.0659607    .2931037
          5  |   .0669917   .1063514     0.63   0.529    -.1416262    .2756096
          6  |    .015913   .1253167     0.13   0.899    -.2299073    .2617332
             |
       _cons |   4.702086   .1338721    35.12   0.000     4.439484    4.964688
-------------+----------------------------------------------------------------
     sigma_u |  1.7283482
     sigma_e |  .99604437
         rho |  .75068318   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     21,343
Group variable: id                              Number of groups  =      1,495

R-sq:                                           Obs per group:
     within  = 0.0536                                         min =          1
     between = 0.2173                                         avg =       14.3
     overall = 0.1199                                         max =         25

                                                F(59,1494)        =       6.92
corr(u_i, Xb)  = 0.1988                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,495 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0247972   .0118682     2.09   0.037      .001517    .0480774
         new |   .0166379   .0135752     1.23   0.221    -.0099906    .0432664
        fnew |  -.0211957   .0165237    -1.28   0.200    -.0536078    .0112164
  fnew_expat |   .0517227   .0161566     3.20   0.001     .0200307    .0834146
  fold_expat |   .0234721   .0207475     1.13   0.258    -.0172251    .0641694
             |
    ind_year |
          2  |   .0220726   .0288028     0.77   0.444    -.0344256    .0785708
          3  |   -.053793   .0314707    -1.71   0.088    -.1155245    .0079385
          4  |   -.086471   .0320934    -2.69   0.007     -.149424   -.0235181
          5  |  -.0581068   .0325847    -1.78   0.075    -.1220234    .0058098
          6  |  -.0804643   .0344738    -2.33   0.020    -.1480865   -.0128421
          7  |  -.0751225   .0367488    -2.04   0.041    -.1472072   -.0030377
          8  |  -.0857604   .0374026    -2.29   0.022    -.1591275   -.0123932
          9  |  -.1093975   .0372659    -2.94   0.003    -.1824966   -.0362984
         10  |  -.1005037   .0379528    -2.65   0.008      -.17495   -.0260573
         11  |  -.1039464   .0389947    -2.67   0.008    -.1804367   -.0274562
         12  |  -.0923643   .0401768    -2.30   0.022    -.1711731   -.0135554
         13  |    -.09307   .0412402    -2.26   0.024    -.1739649   -.0121752
         14  |  -.0754989   .0415369    -1.82   0.069    -.1569758    .0059781
         15  |  -.0534629   .0418941    -1.28   0.202    -.1356405    .0287146
         16  |  -.0400586   .0430137    -0.93   0.352    -.1244323    .0443151
         17  |  -.0269113   .0442418    -0.61   0.543    -.1136939    .0598713
         18  |   .0013336   .0452741     0.03   0.977    -.0874739    .0901412
         19  |   .0140627   .0455282     0.31   0.757    -.0752433    .1033688
         20  |   .0550724   .0464431     1.19   0.236    -.0360283    .1461731
         21  |   .0248101   .0467951     0.53   0.596    -.0669811    .1166012
         22  |   .0401927   .0471979     0.85   0.395    -.0523886     .132774
         23  |   .0283756   .0475588     0.60   0.551    -.0649135    .1216647
         24  |  -.0382889   .0468835    -0.82   0.414    -.1302534    .0536756
         25  |  -.0821965   .0480543    -1.71   0.087    -.1764576    .0120646
         26  |   .0812061   .0508464     1.60   0.110    -.0185318     .180944
         27  |   .0746766   .0474992     1.57   0.116    -.0184956    .1678488
         28  |   .1027229   .0468251     2.19   0.028      .010873    .1945729
         29  |   .0860076   .0472028     1.82   0.069    -.0065832    .1785984
         30  |   .1108658   .0466291     2.38   0.018     .0194005    .2023312
         31  |   .1021221    .046745     2.18   0.029     .0104293    .1938149
         32  |   .1161433   .0470868     2.47   0.014       .02378    .2085066
         33  |   .0720019   .0475301     1.51   0.130     -.021231    .1652347
         34  |   .0570893   .0489888     1.17   0.244    -.0390048    .1531833
         35  |   .0704336   .0491913     1.43   0.152    -.0260578    .1669249
         36  |   .0549115   .0496562     1.11   0.269    -.0424917    .1523147
         37  |   .0608179   .0492741     1.23   0.217    -.0358359    .1574717
         38  |   .0541649   .0494174     1.10   0.273    -.0427701    .1510998
         39  |   .0851274   .0496046     1.72   0.086    -.0121746    .1824293
         40  |    .085878   .0501574     1.71   0.087    -.0125084    .1842645
         41  |   .0889239   .0503867     1.76   0.078    -.0099123    .1877601
         42  |   .0893393   .0510395     1.75   0.080    -.0107774     .189456
         43  |   .1248962   .0521409     2.40   0.017     .0226191    .2271734
         44  |   .0765312   .0539407     1.42   0.156    -.0292763    .1823388
         45  |     .08306   .0533606     1.56   0.120    -.0216095    .1877296
         46  |   .0998414   .0529377     1.89   0.059    -.0039987    .2036814
         47  |   .1332103   .0536582     2.48   0.013      .027957    .2384637
         48  |    .111031   .0542177     2.05   0.041     .0046801    .2173819
         49  |   .0089356   .0553444     0.16   0.872    -.0996254    .1174966
         50  |  -.0323969   .0558703    -0.58   0.562    -.1419895    .0771958
             |
     age_cat |
          2  |    .117269   .0180126     6.51   0.000     .0819362    .1526017
          3  |   .1195604   .0194466     6.15   0.000     .0814148    .1577059
          4  |   .1661944   .0210957     7.88   0.000      .124814    .2075748
          5  |   .1980267   .0246604     8.03   0.000     .1496541    .2463994
          6  |   .2309591   .0291588     7.92   0.000     .1737626    .2881556
             |
       _cons |   .3170173   .0356492     8.89   0.000     .2470895    .3869452
-------------+----------------------------------------------------------------
     sigma_u |   .3705947
     sigma_e |  .31598707
         rho |  .57903555   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0535874250533009

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     21,343
Group variable: id                              Number of groups  =      1,495

R-sq:                                           Obs per group:
     within  = 0.0536                                         min =          1
     between = 0.2173                                         avg =       14.3
     overall = 0.1199                                         max =         25

                                                F(59,1494)        =       6.92
corr(u_i, Xb)  = 0.1988                         Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,495 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0247972   .0118682     2.09   0.037      .001517    .0480774
         new |   .0166379   .0135752     1.23   0.221    -.0099906    .0432664
        fnew |  -.0211957   .0165237    -1.28   0.200    -.0536078    .0112164
  fnew_expat |   .0517227   .0161566     3.20   0.001     .0200307    .0834146
  fold_expat |   .0234721   .0207475     1.13   0.258    -.0172251    .0641694
             |
    ind_year |
          2  |   .0220726   .0288028     0.77   0.444    -.0344256    .0785708
          3  |   -.053793   .0314707    -1.71   0.088    -.1155245    .0079385
          4  |   -.086471   .0320934    -2.69   0.007     -.149424   -.0235181
          5  |  -.0581068   .0325847    -1.78   0.075    -.1220234    .0058098
          6  |  -.0804643   .0344738    -2.33   0.020    -.1480865   -.0128421
          7  |  -.0751225   .0367488    -2.04   0.041    -.1472072   -.0030377
          8  |  -.0857604   .0374026    -2.29   0.022    -.1591275   -.0123932
          9  |  -.1093975   .0372659    -2.94   0.003    -.1824966   -.0362984
         10  |  -.1005037   .0379528    -2.65   0.008      -.17495   -.0260573
         11  |  -.1039464   .0389947    -2.67   0.008    -.1804367   -.0274562
         12  |  -.0923643   .0401768    -2.30   0.022    -.1711731   -.0135554
         13  |    -.09307   .0412402    -2.26   0.024    -.1739649   -.0121752
         14  |  -.0754989   .0415369    -1.82   0.069    -.1569758    .0059781
         15  |  -.0534629   .0418941    -1.28   0.202    -.1356405    .0287146
         16  |  -.0400586   .0430137    -0.93   0.352    -.1244323    .0443151
         17  |  -.0269113   .0442418    -0.61   0.543    -.1136939    .0598713
         18  |   .0013336   .0452741     0.03   0.977    -.0874739    .0901412
         19  |   .0140627   .0455282     0.31   0.757    -.0752433    .1033688
         20  |   .0550724   .0464431     1.19   0.236    -.0360283    .1461731
         21  |   .0248101   .0467951     0.53   0.596    -.0669811    .1166012
         22  |   .0401927   .0471979     0.85   0.395    -.0523886     .132774
         23  |   .0283756   .0475588     0.60   0.551    -.0649135    .1216647
         24  |  -.0382889   .0468835    -0.82   0.414    -.1302534    .0536756
         25  |  -.0821965   .0480543    -1.71   0.087    -.1764576    .0120646
         26  |   .0812061   .0508464     1.60   0.110    -.0185318     .180944
         27  |   .0746766   .0474992     1.57   0.116    -.0184956    .1678488
         28  |   .1027229   .0468251     2.19   0.028      .010873    .1945729
         29  |   .0860076   .0472028     1.82   0.069    -.0065832    .1785984
         30  |   .1108658   .0466291     2.38   0.018     .0194005    .2023312
         31  |   .1021221    .046745     2.18   0.029     .0104293    .1938149
         32  |   .1161433   .0470868     2.47   0.014       .02378    .2085066
         33  |   .0720019   .0475301     1.51   0.130     -.021231    .1652347
         34  |   .0570893   .0489888     1.17   0.244    -.0390048    .1531833
         35  |   .0704336   .0491913     1.43   0.152    -.0260578    .1669249
         36  |   .0549115   .0496562     1.11   0.269    -.0424917    .1523147
         37  |   .0608179   .0492741     1.23   0.217    -.0358359    .1574717
         38  |   .0541649   .0494174     1.10   0.273    -.0427701    .1510998
         39  |   .0851274   .0496046     1.72   0.086    -.0121746    .1824293
         40  |    .085878   .0501574     1.71   0.087    -.0125084    .1842645
         41  |   .0889239   .0503867     1.76   0.078    -.0099123    .1877601
         42  |   .0893393   .0510395     1.75   0.080    -.0107774     .189456
         43  |   .1248962   .0521409     2.40   0.017     .0226191    .2271734
         44  |   .0765312   .0539407     1.42   0.156    -.0292763    .1823388
         45  |     .08306   .0533606     1.56   0.120    -.0216095    .1877296
         46  |   .0998414   .0529377     1.89   0.059    -.0039987    .2036814
         47  |   .1332103   .0536582     2.48   0.013      .027957    .2384637
         48  |    .111031   .0542177     2.05   0.041     .0046801    .2173819
         49  |   .0089356   .0553444     0.16   0.872    -.0996254    .1174966
         50  |  -.0323969   .0558703    -0.58   0.562    -.1419895    .0771958
             |
     age_cat |
          2  |    .117269   .0180126     6.51   0.000     .0819362    .1526017
          3  |   .1195604   .0194466     6.15   0.000     .0814148    .1577059
          4  |   .1661944   .0210957     7.88   0.000      .124814    .2075748
          5  |   .1980267   .0246604     8.03   0.000     .1496541    .2463994
          6  |   .2309591   .0291588     7.92   0.000     .1737626    .2881556
             |
       _cons |   .3170173   .0356492     8.89   0.000     .2470895    .3869452
-------------+----------------------------------------------------------------
     sigma_u |   .3705947
     sigma_e |  .31598707
         rho |  .57903555   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =     17,521
Group variable: id                              Number of groups  =      1,415

R-sq:                                           Obs per group:
     within  = 0.0461                                         min =          1
     between = 0.0024                                         avg =       12.4
     overall = 0.0344                                         max =         24

                                                F(56,1414)        =      18.30
corr(u_i, Xb)  = -0.1355                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,415 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0031976   .0248804     0.13   0.898    -.0456089     .052004
         new |  -.0464898   .0284881    -1.63   0.103    -.1023732    .0093936
        fnew |   .0696603   .0369436     1.89   0.060    -.0028098    .1421304
  fnew_expat |  -.0243114   .0330915    -0.73   0.463    -.0892252    .0406024
  fold_expat |  -.0019408   .0396701    -0.05   0.961    -.0797594    .0758777
             |
    ind_year |
          3  |  -.1747699   .0841292    -2.08   0.038    -.3398013   -.0097385
          4  |  -.1816176   .0856116    -2.12   0.034     -.349557   -.0136781
          5  |  -.0318298    .084772    -0.38   0.707    -.1981223    .1344627
          6  |  -.1881535   .0867338    -2.17   0.030    -.3582942   -.0180127
          7  |  -.0392866    .085606    -0.46   0.646     -.207215    .1286417
          8  |   -.097342   .0847426    -1.15   0.251    -.2635768    .0688929
          9  |  -.1547633   .0885757    -1.75   0.081    -.3285173    .0189907
         10  |  -.1577482   .0857459    -1.84   0.066    -.3259511    .0104547
         11  |  -.1001206   .0874669    -1.14   0.253    -.2716995    .0714584
         12  |  -.1745366    .086958    -2.01   0.045    -.3451171    -.003956
         13  |  -.2624874   .0884033    -2.97   0.003    -.4359031   -.0890717
         14  |  -.2062512    .085944    -2.40   0.017    -.3748426   -.0376597
         15  |  -.1388029   .0889521    -1.56   0.119    -.3132953    .0356894
         16  |  -.2060305   .0869322    -2.37   0.018    -.3765605   -.0355006
         17  |  -.2113164   .0904117    -2.34   0.020     -.388672   -.0339608
         18  |  -.1964606   .0893655    -2.20   0.028    -.3717639   -.0211573
         19  |   -.262572   .0918782    -2.86   0.004    -.4428042   -.0823397
         20  |  -.2360143   .0932315    -2.53   0.011    -.4189012   -.0531274
         21  |  -.3489097   .0923742    -3.78   0.000    -.5301148   -.1677046
         22  |  -.2271397   .0950819    -2.39   0.017    -.4136565   -.0406228
         23  |  -.3502943   .0962887    -3.64   0.000    -.5391784   -.1614102
         24  |  -.7788254   .0940519    -8.28   0.000    -.9633217    -.594329
         25  |   -.440377   .1016332    -4.33   0.000     -.639745    -.241009
         27  |  -.0519809   .1113215    -0.47   0.641     -.270354    .1663922
         28  |  -.6105599   .1014275    -6.02   0.000    -.8095245   -.4115953
         29  |  -.2317151   .0998306    -2.32   0.020    -.4275471   -.0358831
         30  |  -.2492454   .1006114    -2.48   0.013     -.446609   -.0518817
         31  |  -.3318333   .1005736    -3.30   0.001    -.5291229   -.1345437
         32  |  -.3356999   .0990368    -3.39   0.001    -.5299749    -.141425
         33  |  -.3206951   .1011738    -3.17   0.002    -.5191621   -.1222281
         34  |  -.3468471   .1012274    -3.43   0.001    -.5454191   -.1482752
         35  |  -.2611329   .1026151    -2.54   0.011    -.4624271   -.0598387
         36  |  -.3204358   .1022018    -3.14   0.002    -.5209192   -.1199524
         37  |  -.2404503   .1051513    -2.29   0.022    -.4467197   -.0341809
         38  |  -.3043237   .1027382    -2.96   0.003    -.5058593   -.1027881
         39  |  -.3654045   .1054083    -3.47   0.001    -.5721779   -.1586311
         40  |  -.2271795   .1045434    -2.17   0.030    -.4322563   -.0221027
         41  |  -.4313746   .1055574    -4.09   0.000    -.6384406   -.2243086
         42  |  -.2970578   .1080164    -2.75   0.006    -.5089474   -.0851681
         43  |  -.2305938   .1089513    -2.12   0.034    -.4443174   -.0168701
         44  |  -.3461726   .1105057    -3.13   0.002    -.5629453   -.1293999
         45  |  -.4347387   .1099178    -3.96   0.000    -.6503582   -.2191192
         46  |  -.3484202   .1078175    -3.23   0.001    -.5599197   -.1369207
         47  |  -.1605531   .1102345    -1.46   0.145    -.3767938    .0556877
         48  |  -.5131252     .10883    -4.71   0.000    -.7266107   -.2996396
         49  |  -1.003566   .1012402    -9.91   0.000    -1.202163   -.8049692
         50  |   -.534651   .1186493    -4.51   0.000    -.7673986   -.3019033
             |
     age_cat |
          3  |  -.1137619   .0535632    -2.12   0.034    -.2188337   -.0086901
          4  |  -.2891085   .0490221    -5.90   0.000    -.3852724   -.1929446
          5  |  -.4095956   .0517161    -7.92   0.000     -.511044   -.3081471
          6  |  -.4513307   .0565069    -7.99   0.000    -.5621772   -.3404843
             |
       _cons |    .484562   .0848383     5.71   0.000     .3181394    .6509845
-------------+----------------------------------------------------------------
     sigma_u |  .40017663
     sigma_e |  .85270316
         rho |    .180493   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0460595214435708

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =     17,521
Group variable: id                              Number of groups  =      1,415

R-sq:                                           Obs per group:
     within  = 0.0461                                         min =          1
     between = 0.0024                                         avg =       12.4
     overall = 0.0344                                         max =         24

                                                F(56,1414)        =      18.30
corr(u_i, Xb)  = -0.1355                        Prob > F          =     0.0000

                                 (Std. Err. adjusted for 1,415 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0031976   .0248804     0.13   0.898    -.0456089     .052004
         new |  -.0464898   .0284881    -1.63   0.103    -.1023732    .0093936
        fnew |   .0696603   .0369436     1.89   0.060    -.0028098    .1421304
  fnew_expat |  -.0243114   .0330915    -0.73   0.463    -.0892252    .0406024
  fold_expat |  -.0019408   .0396701    -0.05   0.961    -.0797594    .0758777
             |
    ind_year |
          3  |  -.1747699   .0841292    -2.08   0.038    -.3398013   -.0097385
          4  |  -.1816176   .0856116    -2.12   0.034     -.349557   -.0136781
          5  |  -.0318298    .084772    -0.38   0.707    -.1981223    .1344627
          6  |  -.1881535   .0867338    -2.17   0.030    -.3582942   -.0180127
          7  |  -.0392866    .085606    -0.46   0.646     -.207215    .1286417
          8  |   -.097342   .0847426    -1.15   0.251    -.2635768    .0688929
          9  |  -.1547633   .0885757    -1.75   0.081    -.3285173    .0189907
         10  |  -.1577482   .0857459    -1.84   0.066    -.3259511    .0104547
         11  |  -.1001206   .0874669    -1.14   0.253    -.2716995    .0714584
         12  |  -.1745366    .086958    -2.01   0.045    -.3451171    -.003956
         13  |  -.2624874   .0884033    -2.97   0.003    -.4359031   -.0890717
         14  |  -.2062512    .085944    -2.40   0.017    -.3748426   -.0376597
         15  |  -.1388029   .0889521    -1.56   0.119    -.3132953    .0356894
         16  |  -.2060305   .0869322    -2.37   0.018    -.3765605   -.0355006
         17  |  -.2113164   .0904117    -2.34   0.020     -.388672   -.0339608
         18  |  -.1964606   .0893655    -2.20   0.028    -.3717639   -.0211573
         19  |   -.262572   .0918782    -2.86   0.004    -.4428042   -.0823397
         20  |  -.2360143   .0932315    -2.53   0.011    -.4189012   -.0531274
         21  |  -.3489097   .0923742    -3.78   0.000    -.5301148   -.1677046
         22  |  -.2271397   .0950819    -2.39   0.017    -.4136565   -.0406228
         23  |  -.3502943   .0962887    -3.64   0.000    -.5391784   -.1614102
         24  |  -.7788254   .0940519    -8.28   0.000    -.9633217    -.594329
         25  |   -.440377   .1016332    -4.33   0.000     -.639745    -.241009
         27  |  -.0519809   .1113215    -0.47   0.641     -.270354    .1663922
         28  |  -.6105599   .1014275    -6.02   0.000    -.8095245   -.4115953
         29  |  -.2317151   .0998306    -2.32   0.020    -.4275471   -.0358831
         30  |  -.2492454   .1006114    -2.48   0.013     -.446609   -.0518817
         31  |  -.3318333   .1005736    -3.30   0.001    -.5291229   -.1345437
         32  |  -.3356999   .0990368    -3.39   0.001    -.5299749    -.141425
         33  |  -.3206951   .1011738    -3.17   0.002    -.5191621   -.1222281
         34  |  -.3468471   .1012274    -3.43   0.001    -.5454191   -.1482752
         35  |  -.2611329   .1026151    -2.54   0.011    -.4624271   -.0598387
         36  |  -.3204358   .1022018    -3.14   0.002    -.5209192   -.1199524
         37  |  -.2404503   .1051513    -2.29   0.022    -.4467197   -.0341809
         38  |  -.3043237   .1027382    -2.96   0.003    -.5058593   -.1027881
         39  |  -.3654045   .1054083    -3.47   0.001    -.5721779   -.1586311
         40  |  -.2271795   .1045434    -2.17   0.030    -.4322563   -.0221027
         41  |  -.4313746   .1055574    -4.09   0.000    -.6384406   -.2243086
         42  |  -.2970578   .1080164    -2.75   0.006    -.5089474   -.0851681
         43  |  -.2305938   .1089513    -2.12   0.034    -.4443174   -.0168701
         44  |  -.3461726   .1105057    -3.13   0.002    -.5629453   -.1293999
         45  |  -.4347387   .1099178    -3.96   0.000    -.6503582   -.2191192
         46  |  -.3484202   .1078175    -3.23   0.001    -.5599197   -.1369207
         47  |  -.1605531   .1102345    -1.46   0.145    -.3767938    .0556877
         48  |  -.5131252     .10883    -4.71   0.000    -.7266107   -.2996396
         49  |  -1.003566   .1012402    -9.91   0.000    -1.202163   -.8049692
         50  |   -.534651   .1186493    -4.51   0.000    -.7673986   -.3019033
             |
     age_cat |
          3  |  -.1137619   .0535632    -2.12   0.034    -.2188337   -.0086901
          4  |  -.2891085   .0490221    -5.90   0.000    -.3852724   -.1929446
          5  |  -.4095956   .0517161    -7.92   0.000     -.511044   -.3081471
          6  |  -.4513307   .0565069    -7.99   0.000    -.5621772   -.3404843
             |
       _cons |    .484562   .0848383     5.71   0.000     .3181394    .6509845
-------------+----------------------------------------------------------------
     sigma_u |  .40017663
     sigma_e |  .85270316
         rho |    .180493   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
. *Szelekci az akviczis mintban
. xtset id year
       panel variable:  id (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. areg f1.expat lnL lnQ lnK exporter if ever_forein==1&greenfield!=1, a(industry_y
> ear) cluster(frame_id)
ever_forein not found
r(111);

end of do-file

r(111);

. keep if ever_foreign==1&greenfield!=1
(243,154 observations deleted)

. clonevar tenure_foreign = age_since_foreign

. 
. areg f1.expat lnL lnQ lnK exporter if ever_foreign==1&greenfield!=1, a(industry_
> year) cluster(frame_id)

Linear regression, absorbing indicators         Number of obs     =     18,405
Absorbed variable: industry_year                No. of categories =      1,658
                                                F(   4,   1445)   =      17.63
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1296
                                                Adj R-squared     =     0.0433
                                                Root MSE          =     0.3926

                           (Std. Err. adjusted for 1,446 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
     F.expat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |    -.01102   .0097475    -1.13   0.258    -.0301408    .0081008
         lnQ |   .0140834   .0080519     1.75   0.080    -.0017113    .0298782
         lnK |    .015037   .0052786     2.85   0.004     .0046824    .0253917
    exporter |   .0840832   .0152058     5.53   0.000     .0542554    .1139111
       _cons |  -.1550996   .0811714    -1.91   0.056     -.314326    .0041269
------------------------------------------------------------------------------

. do regram output/regression/selection 1 1

. args tablefile specname speclabel

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression, absorbing indicators         Number of obs     =     18,405
Absorbed variable: industry_year                No. of categories =      1,658
                                                F(   4,   1445)   =      17.63
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1296
                                                Adj R-squared     =     0.0433
                                                Root MSE          =     0.3926

                           (Std. Err. adjusted for 1,446 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
     F.expat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |    -.01102   .0097475    -1.13   0.258    -.0301408    .0081008
         lnQ |   .0140834   .0080519     1.75   0.080    -.0017113    .0298782
         lnK |    .015037   .0052786     2.85   0.004     .0046824    .0253917
    exporter |   .0840832   .0152058     5.53   0.000     .0542554    .1139111
       _cons |  -.1550996   .0811714    -1.91   0.056     -.314326    .0041269
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce
(note: file output/regression/selection/columns/1.yaml not found)

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b')) _newline
  6.         file write `output' ("   standard_error: " + string(`se')) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se')) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")])) _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
. tab tenure_foreign , miss

tenure_fore |
        ign |      Freq.     Percent        Cum.
------------+-----------------------------------
        -22 |          9        0.04        0.04
        -21 |         14        0.07        0.11
        -20 |         22        0.10        0.21
        -19 |         31        0.15        0.36
        -18 |         37        0.17        0.53
        -17 |         53        0.25        0.78
        -16 |         76        0.36        1.13
        -15 |        110        0.52        1.65
        -14 |        139        0.65        2.30
        -13 |        182        0.85        3.15
        -12 |        209        0.98        4.13
        -11 |        234        1.10        5.23
        -10 |        271        1.27        6.50
         -9 |        327        1.53        8.03
         -8 |        372        1.74        9.77
         -7 |        426        2.00       11.77
         -6 |        487        2.28       14.05
         -5 |        574        2.69       16.74
         -4 |        658        3.08       19.82
         -3 |        788        3.69       23.52
         -2 |        930        4.36       27.87
         -1 |      1,238        5.80       33.67
          0 |      1,405        6.58       40.26
          1 |      1,288        6.03       46.29
          2 |      1,192        5.58       51.88
          3 |      1,076        5.04       56.92
          4 |        999        4.68       61.60
          5 |        940        4.40       66.00
          6 |        870        4.08       70.08
          7 |        817        3.83       73.91
          8 |        725        3.40       77.30
          9 |        634        2.97       80.27
         10 |        555        2.60       82.87
         11 |        494        2.31       85.19
         12 |        450        2.11       87.30
         13 |        414        1.94       89.24
         14 |        374        1.75       90.99
         15 |        337        1.58       92.57
         16 |        306        1.43       94.00
         17 |        271        1.27       95.27
         18 |        252        1.18       96.45
         19 |        217        1.02       97.47
         20 |        185        0.87       98.34
         21 |        160        0.75       99.09
         22 |        118        0.55       99.64
         23 |         77        0.36      100.00
------------+-----------------------------------
      Total |     21,343      100.00

. table tenure_foreign , c(mean tenure_expat )

--------------------------
tenure_fo |
reign     | mean(tenure~t)
----------+---------------
      -22 |               
      -21 |               
      -20 |               
      -19 |               
      -18 |               
      -17 |               
      -16 |               
      -15 |               
      -14 |               
      -13 |               
      -12 |               
      -11 |               
      -10 |               
       -9 |               
       -8 |               
       -7 |               
       -6 |               
       -5 |               
       -4 |               
       -3 |               
       -2 |               
       -1 |               
        0 |        .118497
        1 |        .748603
        2 |        1.39308
        3 |        1.90357
        4 |        2.29478
        5 |          2.564
        6 |         2.9863
        7 |        3.05238
        8 |        3.27885
        9 |        3.63158
       10 |        3.48315
       11 |         3.7381
       12 |         4.1227
       13 |        4.16552
       14 |        4.20155
       15 |        4.19298
       16 |        4.08491
       17 |        4.35052
       18 |        4.62222
       19 |        4.74648
       20 |        4.37705
       21 |        4.98077
       22 |        5.40541
       23 |        5.36364
--------------------------

. table tenure_foreign , c(mean tenure_domestic mean tenure_expat )

------------------------------------------
tenure_fo |
reign     | mean(tenure~c)  mean(tenure~t)
----------+-------------------------------
      -22 |            .75                
      -21 |            2.1                
      -20 |           1.25                
      -19 |        1.94737                
      -18 |        2.47826                
      -17 |        2.40541                
      -16 |        2.42105                
      -15 |        2.56627                
      -14 |        3.01887                
      -13 |        2.97794                
      -12 |        3.16867                
      -11 |        3.46114                
      -10 |        3.57727                
       -9 |          3.603                
       -8 |        4.03974                
       -7 |        4.01425                
       -6 |        4.18546                
       -5 |        3.86013                
       -4 |        3.84838                
       -3 |        3.71775                
       -2 |        3.64119                
       -1 |        3.27188                
        0 |        2.91375         .118497
        1 |          3.136         .748603
        2 |        3.59263         1.39308
        3 |        3.96442         1.90357
        4 |        4.13386         2.29478
        5 |        4.38781           2.564
        6 |        4.78797          2.9863
        7 |        5.35131         3.05238
        8 |        5.59489         3.27885
        9 |        5.94549         3.63158
       10 |        5.84726         3.48315
       11 |        5.75462          3.7381
       12 |        6.03188          4.1227
       13 |        6.66134         4.16552
       14 |        6.39024         4.20155
       15 |        6.59091         4.19298
       16 |        6.59917         4.08491
       17 |          6.723         4.35052
       18 |        7.08629         4.62222
       19 |        7.34356         4.74648
       20 |        7.73571         4.37705
       21 |        8.27273         4.98077
       22 |        8.52174         5.40541
       23 |        8.86667         5.36364
------------------------------------------

